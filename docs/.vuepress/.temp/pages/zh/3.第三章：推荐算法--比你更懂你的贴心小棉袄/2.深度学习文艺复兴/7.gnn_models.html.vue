<template><div><p>åœ¨æ¨èç³»ç»Ÿçš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¯»æ‰¾èƒ½æ›´æ·±åˆ»ç†è§£ç”¨æˆ·ä¸ç‰©å“ä¹‹é—´å¤æ‚å…³ç³»çš„æ–¹æ³•ã€‚ä¼ ç»Ÿçš„ååŒè¿‡æ»¤å…³æ³¨å…±ç°å…³ç³»ï¼Œè€Œæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆå¦‚DINã€BSTï¼‰åˆ™ç²¾äºæ•æ‰åºåˆ—ä¾èµ–ã€‚ç„¶è€Œï¼Œå®ƒä»¬åœ¨æŸç§ç¨‹åº¦ä¸Šéƒ½å°†ç”¨æˆ·å’Œç‰©å“è§†ä¸ºç‹¬ç«‹çš„ä¸ªä½“ï¼Œå¿½ç•¥äº†ä¸€ä¸ªè‡³å…³é‡è¦çš„ä¿¡æ¯ç»´åº¦â€”â€”<strong>è¿æ¥ï¼ˆConnectionsï¼‰</strong>ã€‚</p>
<p><strong>å›¾ç¥ç»ç½‘ç»œï¼ˆGraph Neural Network, GNNï¼‰</strong> ä¸ºæ¨èç³»ç»Ÿå¸¦æ¥äº†å…¨æ–°çš„ä¸–ç•Œè§‚ã€‚å®ƒä¸å†å°†ç³»ç»Ÿè§†ä¸ºç”¨æˆ·çš„é›†åˆå’Œç‰©å“çš„é›†åˆï¼Œè€Œæ˜¯çœ‹ä½œä¸€ä¸ªç”±ç”¨æˆ·ã€ç‰©å“ä»¥åŠå®ƒä»¬ä¹‹é—´çº·ç¹å¤æ‚çš„äº¤äº’å…³ç³»å…±åŒæ„æˆçš„å·¨å¤§<strong>å›¾ï¼ˆGraphï¼‰</strong>ã€‚åœ¨è¿™ä¸ªè§†è§’ä¸‹ï¼Œç”¨æˆ·çš„å…´è¶£ä¸å†ä»…ä»…ç”±å…¶å†å²è¡Œä¸ºåºåˆ—å®šä¹‰ï¼Œæ›´ç”±å…¶åœ¨æ•´ä¸ª&quot;ä¿¡æ¯ç”Ÿæ€&quot;ä¸­çš„ä½ç½®æ‰€å†³å®šã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§"><span>ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§ï¼Ÿ</span></a></h3>
<ol>
<li><strong>è¶…è¶Šä¸€é˜¶å…³ç³»</strong>ï¼šä½ çš„å…´è¶£ä¸ä»…å’Œä½ ç›´æ¥ç‚¹å‡»è¿‡çš„ç‰©å“ï¼ˆä¸€é˜¶é‚»å±…ï¼‰æœ‰å…³ï¼Œä¹Ÿå’Œ&quot;ç‚¹å‡»è¿‡åŒæ ·ç‰©å“çš„å…¶ä»–äºº&quot;ï¼ˆäºŒé˜¶é‚»å±…ï¼‰ä»¥åŠ&quot;é‚£äº›äººè¿˜å–œæ¬¢çš„å…¶ä»–ç‰©å“&quot;ï¼ˆä¸‰é˜¶é‚»å±…ï¼‰æœ‰å…³ã€‚GNNé€šè¿‡åœ¨å›¾ä¸Šä¼ æ’­ä¿¡æ¯ï¼Œèƒ½å¤Ÿè‡ªç„¶åœ°æ•æ‰è¿™ç§<strong>é«˜é˜¶ä¾èµ–ï¼ˆHigh-order Proximityï¼‰</strong>ï¼Œå‘æ˜å‡ºæ›´æ·±å±‚æ¬¡çš„å…³è”ã€‚</li>
<li><strong>ç»“æ„åŒ–ä¿¡æ¯çš„åŠ›é‡</strong>ï¼šå›¾æœ¬èº«å°±æ˜¯ä¸€ç§å¼ºå¤§çš„ç»“æ„åŒ–ä¿¡æ¯ã€‚èŠ‚ç‚¹çš„åº¦æ•°ã€èšç±»æƒ…å†µã€åœ¨å›¾ä¸­çš„ä¸­å¿ƒæ€§ç­‰æ‹“æ‰‘ç‰¹å¾ï¼Œéƒ½ä¸ºç†è§£èŠ‚ç‚¹ï¼ˆç”¨æˆ·/ç‰©å“ï¼‰çš„å±æ€§æä¾›äº†ä¸°å¯Œçº¿ç´¢ã€‚</li>
<li><strong>ç»Ÿä¸€çš„å»ºæ¨¡æ¡†æ¶</strong>ï¼šæ— è®ºæ˜¯ç”¨æˆ·ä¸ç‰©å“çš„äº¤äº’ï¼ˆäºŒéƒ¨å›¾ï¼‰ã€ç‰©å“ä¸ç‰©å“çš„ç›¸ä¼¼å…³ç³»ï¼ˆåŒè´¨å›¾ï¼‰ï¼Œè¿˜æ˜¯ç”¨æˆ·ä¹‹é—´çš„ç¤¾äº¤å…³ç³»ï¼ˆç¤¾äº¤ç½‘ç»œï¼‰ï¼Œç”šè‡³æ˜¯åŒ…å«å“ç‰Œã€ç±»åˆ«ç­‰å¤šç§èŠ‚ç‚¹çš„å¤æ‚åœºæ™¯ï¼ˆå¼‚è´¨å›¾ï¼‰ï¼ŒGNNéƒ½èƒ½æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å»ºæ¨¡æ¡†æ¶ã€‚</li>
</ol>
<Mermaid id="mermaid-26" code="eJx1kstOAjEUhvc+RdONkMAbGBIGENjrirCA0CALgQzDwp0MF0UEjLgRFCSC4oIgkegww+Vl2un4FnY6XGRBF22ac/6v/zmncTGSPgMn3gPAViYbte5Qrw2M6h390qjWwcqQNguktaBaQ28XIE81lzsEsXJFyx+0WSL1EcuAYeB0uoAQgvRhoF//OFmQNHJYvf3ND1j8KCq6bKcZJDqDEjoHQiIdEaWEhIDffNYOw1s2B3kYiBNWINpS8Gy2BpkMC7RH7t364AftLbDa2/FhbvvkvhAkvSYda6RdITPZmGxKCCAJiak4SqJUNrMrR8kYPwWGYH18UcgyT55U/XEEOfTYBomm6oOuZQkrtVVpzQJtTfRanznE6j20c4qHU4xunxSLeNnVcyuKn1He5ENjMsTTT6yW3Hja2VyEw5Xau0cdsNSkPyf1ijnb4sT4fiXzMWlU11of15JeVX+W//sP2iD/E5dWFWb/HMAcggN4IhKKp8QLBxDESDJGh2Wzfe9V40am8pRx/wD4Xhxy"></Mermaid><h2 id="ğŸš€-lightgcn-å¤§é“è‡³ç®€-è¿”ç’å½’çœŸ" tabindex="-1"><a class="header-anchor" href="#ğŸš€-lightgcn-å¤§é“è‡³ç®€-è¿”ç’å½’çœŸ"><span>ğŸš€ LightGCNï¼šå¤§é“è‡³ç®€ï¼Œè¿”ç’å½’çœŸ</span></a></h2>
<p>åœ¨GNNçš„æ—©æœŸæ¢ç´¢ä¸­ï¼Œç ”ç©¶è€…ä»¬å€¾å‘äºå°†ç”¨äºè®¡ç®—æœºè§†è§‰æˆ–è‡ªç„¶è¯­è¨€å¤„ç†çš„å¤æ‚GNNæ¨¡å‹ï¼ˆå¦‚GCN, GATï¼‰ç›´æ¥è¿ç§»åˆ°æ¨èåœºæ™¯ã€‚è¿™äº›æ¨¡å‹é€šå¸¸åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒæ“ä½œï¼š<strong>ç‰¹å¾å˜æ¢</strong>ï¼ˆé€šè¿‡æƒé‡çŸ©é˜µ<code v-pre>W</code>ï¼‰ã€<strong>é‚»å±…èšåˆ</strong>ï¼ˆå¦‚æ±‚å’Œæˆ–å–å¹³å‡ï¼‰å’Œ<strong>éçº¿æ€§æ¿€æ´»</strong>ï¼ˆå¦‚<code v-pre>ReLU</code>ï¼‰ã€‚</p>
<p>ç„¶è€Œï¼Œä½•å‘å—æ•™æˆå›¢é˜Ÿåœ¨2020å¹´æå‡ºçš„ <strong>LightGCN</strong> é¢ è¦†äº†è¿™ä¸€æ€è·¯ã€‚ä»–ä»¬é€šè¿‡å¤§é‡çš„å®éªŒæ•é”åœ°å‘ç°ï¼Œåœ¨æ¨èç³»ç»Ÿçš„ååŒè¿‡æ»¤åœºæ™¯ä¸‹ï¼Œç‰¹å¾å˜æ¢å’Œéçº¿æ€§æ¿€æ´»è¿™ä¸¤ä¸ªæ“ä½œå¯¹äºæ€§èƒ½çš„æå‡æ˜¯<strong>éå¿…è¦ç”šè‡³æœ‰å®³çš„</strong>ã€‚</p>
<h3 id="æ ¸å¿ƒæ€æƒ³-å‡æ³•å³æ˜¯åŠ æ³•" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒæ€æƒ³-å‡æ³•å³æ˜¯åŠ æ³•"><span>æ ¸å¿ƒæ€æƒ³ï¼šå‡æ³•å³æ˜¯åŠ æ³•</span></a></h3>
<p>LightGCNçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨æ¨èçš„IDç±»ç‰¹å¾ä¸Šï¼Œæˆ‘ä»¬çœŸæ­£éœ€è¦çš„æ˜¯çº¯ç²¹çš„ã€æ— æŸçš„<strong>ä¿¡æ¯ä¼ æ’­ï¼ˆInformation Propagationï¼‰</strong>ï¼Œè€Œä¸æ˜¯å¤æ‚çš„ç‰¹å¾å˜æ¢ã€‚ç”¨æˆ·çš„æœ€ç»ˆåµŒå…¥ï¼Œåº”è¯¥æ˜¯å…¶è‡ªèº«åŸå§‹åµŒå…¥ä¸ä»é‚»å±…èŠ‚ç‚¹ï¼ˆå¦‚å…¶äº¤äº’è¿‡çš„ç‰©å“ï¼‰ä¼ æ’­è¿‡æ¥çš„ä¿¡æ¯çš„çº¿æ€§ç»„åˆã€‚</p>
<p>å› æ­¤ï¼ŒLightGCNå¤§èƒ†åœ°å»é™¤äº†ç‰¹å¾å˜æ¢å’Œéçº¿æ€§æ¿€æ´»ï¼Œå…¶æ ¸å¿ƒä¼ æ’­å…¬å¼æå…¶ç®€æ´ï¼š</p>
<p v-pre class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><munder><mo>âˆ‘</mo><mrow><mi>i</mi><mo>âˆˆ</mo><msub><mi>N</mi><mi>u</mi></msub></mrow></munder><mfrac><mn>1</mn><msqrt><mrow><mi mathvariant="normal">âˆ£</mi><msub><mi>N</mi><mi>u</mi></msub><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>N</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi></mrow></msqrt></mfrac><msubsup><mi>e</mi><mi>i</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></msubsup><mspace width="1em"/><mtext>å’Œ</mtext><mspace width="1em"/><msubsup><mi>e</mi><mi>i</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><munder><mo>âˆ‘</mo><mrow><mi>u</mi><mo>âˆˆ</mo><msub><mi>N</mi><mi>i</mi></msub></mrow></munder><mfrac><mn>1</mn><msqrt><mrow><mi mathvariant="normal">âˆ£</mi><msub><mi>N</mi><mi>i</mi></msub><mi mathvariant="normal">âˆ£</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>N</mi><mi>u</mi></msub><mi mathvariant="normal">âˆ£</mi></mrow></msqrt></mfrac><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">e_u^{(k+1)} = \sum_{i \in N_u} \frac{1}{\sqrt{|N_u||N_i|}} e_i^{(k)} \quad \text{å’Œ} \quad e_i^{(k+1)} = \sum_{u \in N_i} \frac{1}{\sqrt{|N_i||N_u|}} e_u^{(k)} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.185em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.7159em;vertical-align:-1.3944em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8557em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3944em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.175em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£âˆ£</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span></span></span><span style="top:-2.895em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.305em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord text"><span class="mord cjk_fallback">å’Œ</span></span><span class="mspace" style="margin-right:1em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.7159em;vertical-align:-1.3944em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8557em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mrel mtight">âˆˆ</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3944em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.175em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord">âˆ£</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£âˆ£</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span></span></span><span style="top:-2.895em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.305em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>å…¶ä¸­ï¼Œ<span v-pre class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo stretchy="false">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">e_u^{(k)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1614em;vertical-align:-0.1166em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.5834em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.1166em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯ç”¨æˆ· <span v-pre class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span> åœ¨ç¬¬ <span v-pre class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> å±‚çš„åµŒå…¥ï¼Œ<span v-pre class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="script">N</mi><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">\mathcal{N}_u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.14736em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1474em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> æ˜¯ç”¨æˆ· <span v-pre class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">u</span></span></span></span> çš„é‚»å±…ï¼ˆç‰©å“ï¼‰é›†åˆã€‚è¿™ä¸ªå…¬å¼æœ¬è´¨ä¸Šå°±æ˜¯åœ¨åš<strong>å½’ä¸€åŒ–åçš„é‚»å±…ä¿¡æ¯èšåˆ</strong>ã€‚ç»è¿‡ <span v-pre class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span></span></span></span> å±‚ä¼ æ’­åï¼ŒLightGCNå°†æ¯ä¸€å±‚çš„åµŒå…¥è¿›è¡ŒåŠ æƒæ±‚å’Œï¼ˆé€šå¸¸æ˜¯ç®€å•å¹³å‡ï¼‰ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç”¨æˆ·å’Œç‰©å“è¡¨ç¤ºï¼Œç”¨äºè®¡ç®—æ¨èåˆ†æ•°ã€‚</p>
<details class="hint-container details"><summary>LightGCN å®Œæ•´ PyTorch å®ç°</summary>
<div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">nn </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">as</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> nn</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994"> LightGCN</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">Module</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> __init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_users</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_items</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> adj_matrix</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> embed_dim</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">64</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_layers</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">3</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">        """</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">        Args:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            num_users (int): ç”¨æˆ·æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            num_items (int): ç‰©å“æ•°é‡</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            adj_matrix (torch.sparse.Tensor): æ ‡å‡†åŒ–çš„é‚»æ¥çŸ©é˜µ D^(-1/2)AD^(-1/2)</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            embed_dim (int): åµŒå…¥ç»´åº¦</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            num_layers (int): å›¾å·ç§¯å±‚æ•°</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">        """</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965">        super</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">LightGCN</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">).</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965">__init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_users </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_users</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_items </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_items</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">adj_matrix </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> adj_matrix</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">embed_dim </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> embed_dim</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_layers </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_layers</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # å®šä¹‰ç”¨æˆ·å’Œç‰©å“çš„åˆå§‹åµŒå…¥ E_0</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">user_embedding </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Embedding</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_users</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> embed_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">item_embedding </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Embedding</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_items</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> embed_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # åˆå§‹åŒ–åµŒå…¥æƒé‡</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">init</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">xavier_uniform_</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">user_embedding</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">weight</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">init</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">xavier_uniform_</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">item_embedding</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">weight</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665"> forward</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # è·å–æ‰€æœ‰èŠ‚ç‚¹çš„åˆå§‹åµŒå…¥</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # E_0 = [E_U, E_I]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        ego_embeddings </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">cat</span><span style="--shiki-light:#999999;--shiki-dark:#666666">([</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">user_embedding</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">weight</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">item_embedding</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">weight</span><span style="--shiki-light:#999999;--shiki-dark:#666666">],</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # ç”¨äºå­˜å‚¨æ¯ä¸€å±‚ä¼ æ’­åçš„åµŒå…¥</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        all_layer_embeddings </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> [</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">ego_embeddings</span><span style="--shiki-light:#999999;--shiki-dark:#666666">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # è¿›è¡Œå¤šå±‚å›¾å·ç§¯ (ä¿¡æ¯ä¼ æ’­)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">        for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> layer </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">in</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> range</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_layers</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            # E_k+1 = A_hat * E_k</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            ego_embeddings </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">sparse</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">mm</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">adj_matrix</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> ego_embeddings</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            all_layer_embeddings</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">ego_embeddings</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # å°†æ‰€æœ‰å±‚çš„åµŒå…¥è¿›è¡ŒåŠ æƒæ±‚å’Œï¼ˆè¿™é‡Œæ˜¯å¹³å‡ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # E_final = (1/K+1) * (E_0 + E_1 + ... + E_K)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        final_embeddings </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">mean</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">stack</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">all_layer_embeddings</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">),</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # ä»æœ€ç»ˆåµŒå…¥ä¸­åˆ†ç¦»å‡ºç”¨æˆ·å’Œç‰©å“çš„åµŒå…¥</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        users_emb</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> items_emb </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">split</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">final_embeddings</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> [</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_users</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_items</span><span style="--shiki-light:#999999;--shiki-dark:#666666">])</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">        return</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> users_emb</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> items_emb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665"> compute_loss</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> users_emb</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> items_emb</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> user_ids</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> pos_item_ids</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> neg_item_ids</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">        """</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">        è®¡ç®—BPRæŸå¤±</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">        """</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        u_embeds </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> users_emb</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">user_ids</span><span style="--shiki-light:#999999;--shiki-dark:#666666">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        pos_i_embeds </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> items_emb</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">pos_item_ids</span><span style="--shiki-light:#999999;--shiki-dark:#666666">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        neg_i_embeds </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> items_emb</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">neg_item_ids</span><span style="--shiki-light:#999999;--shiki-dark:#666666">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        pos_scores </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">sum</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">u_embeds </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> pos_i_embeds</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        neg_scores </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">sum</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">u_embeds </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> neg_i_embeds</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # BPR Loss</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        loss </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676"> -</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">mean</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">log</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">sigmoid</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">pos_scores </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> neg_scores</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)))</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">        return</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> loss</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<p>LightGCNçš„æˆåŠŸè¯æ˜äº†ï¼Œåœ¨ç‰¹å®šä»»åŠ¡ä¸­ï¼Œ<strong>é’ˆå¯¹æ€§çš„ç®€åŒ–è¿œèƒœäºç›²ç›®çš„å †ç Œå¤æ‚æ¨¡å—</strong>ã€‚å®ƒä¸ºæ¨èé¢†åŸŸçš„GNNè®¾è®¡æä¾›äº†ä¸€ä¸ªä¼˜é›…ã€é«˜æ•ˆä¸”å¼ºå¤§çš„åŸºçº¿ã€‚</p>
<h2 id="ğŸ­-pinsage-åº”å¯¹web-scaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº" tabindex="-1"><a class="header-anchor" href="#ğŸ­-pinsage-åº”å¯¹web-scaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº"><span>ğŸ­ PinSageï¼šåº”å¯¹Web-ScaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº</span></a></h2>
<p>LightGCNè™½ç„¶å¼ºå¤§ï¼Œä½†å®ƒä¾èµ–äºå¯¹æ•´ä¸ªå›¾è¿›è¡Œå…¨é‡è®¡ç®—ï¼ˆfull-batch trainingï¼‰ï¼Œè¿™åœ¨åŠ¨è¾„æ•°åäº¿èŠ‚ç‚¹ã€æ•°ç™¾äº¿è¾¹çš„å·¥ä¸šçº§å¤§å›¾ï¼ˆå¦‚Pinterestã€æ·˜å®ã€å¾®ä¿¡ï¼‰é¢å‰æ˜¯å®Œå…¨ä¸å¯è¡Œçš„ã€‚</p>
<p><strong>PinSage</strong> æ˜¯ç”±Pinterestå›¢é˜Ÿåœ¨2018å¹´æå‡ºçš„ï¼Œæ˜¯ç¬¬ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸ŠæˆåŠŸåº”ç”¨åˆ°è¶…å¤§è§„æ¨¡å›¾ä¸Šçš„GNNæ¨èæ¨¡å‹ï¼Œæ˜¯GNNå·¥ä¸šè½åœ°çš„é‡è¦é‡Œç¨‹ç¢‘ã€‚å®ƒçš„ä¸€ç³»åˆ—è®¾è®¡ï¼Œæ ¸å¿ƒéƒ½æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼š<strong>å¯æ‰©å±•æ€§ï¼ˆScalabilityï¼‰</strong>ã€‚</p>
<h3 id="æ ¸å¿ƒæ€æƒ³-é‡‡æ ·ä¸èšåˆ" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒæ€æƒ³-é‡‡æ ·ä¸èšåˆ"><span>æ ¸å¿ƒæ€æƒ³ï¼šé‡‡æ ·ä¸èšåˆ</span></a></h3>
<p>PinSageçš„æ¶æ„å®Œå…¨æ‘’å¼ƒäº†å…¨å›¾è®¡ç®—çš„æ€è·¯ï¼Œè½¬è€Œé‡‡ç”¨<strong>åŸºäºé‡‡æ ·çš„å°æ‰¹é‡ï¼ˆmini-batchï¼‰è®­ç»ƒ</strong>æ¨¡å¼ã€‚å…¶æ ¸å¿ƒåˆ›æ–°å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>
<p><strong>é‚»å±…é‡‡æ ·ï¼ˆNeighbor Samplingï¼‰</strong>ï¼šå¯¹äºä¸€ä¸ªä¸­å¿ƒèŠ‚ç‚¹ï¼Œä¸æ˜¯èšåˆå®ƒæ‰€æœ‰çš„é‚»å±…ä¿¡æ¯ï¼Œè€Œæ˜¯åª<strong>é‡‡æ ·å›ºå®šæ•°é‡çš„é‚»å±…</strong>ï¼ˆæ¯”å¦‚20ä¸ªï¼‰ã€‚è¿™æ ·ï¼Œæ— è®ºä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šå°‘é‚»å±…ï¼Œå®ƒçš„è®¡ç®—é‡éƒ½æ˜¯æ’å®šçš„ï¼Œä»è€Œè§£å†³äº†&quot;åº¦æ•°çˆ†ç‚¸&quot;é—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>åŸºäºéšæœºæ¸¸èµ°çš„é‡‡æ ·ç­–ç•¥</strong>ï¼šå¦‚ä½•é‡‡æ ·åˆ°&quot;é‡è¦&quot;çš„é‚»å±…ï¼ŸPinSageæ²¡æœ‰ä½¿ç”¨å‡åŒ€é‡‡æ ·ï¼Œè€Œæ˜¯è®¾è®¡äº†ä¸€ç§å·§å¦™çš„<strong>åŸºäºéšæœºæ¸¸èµ°çš„é‡‡æ ·</strong>ã€‚ä»ä¸­å¿ƒèŠ‚ç‚¹å‡ºå‘ï¼Œè¿›è¡Œå¤šæ¬¡çŸ­è·ç¦»çš„éšæœºæ¸¸èµ°ï¼Œå¹¶å°†æ¸¸èµ°ç»è¿‡çš„èŠ‚ç‚¹ä½œä¸ºé‚»å±…ã€‚è¿™ç§æ–¹æ³•èƒ½æ›´æœ‰æ•ˆåœ°é‡‡æ ·åˆ°ä¸ä¸­å¿ƒèŠ‚ç‚¹<strong>ç»“æ„æ›´ç›¸ä¼¼ã€å…³ç³»æ›´ç´§å¯†</strong>çš„èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ä»…ä»…æ˜¯ç›´æ¥ç›¸è¿çš„èŠ‚ç‚¹ã€‚</p>
</li>
<li>
<p><strong>å¤šå±‚èšåˆï¼ˆOn-the-fly Computationï¼‰</strong>ï¼šPinSageçš„è®¡ç®—æ˜¯&quot;å³æ—¶&quot;çš„ã€‚å½“è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹çš„è¡¨ç¤ºæ—¶ï¼Œå®ƒä¼šå…ˆé‡‡æ ·å…¶ä¸€é˜¶é‚»å±…ï¼Œç„¶åä¸ºè¿™äº›é‚»å±…é‡‡æ ·å®ƒä»¬çš„é‚»å±…ï¼ˆå³ä¸­å¿ƒèŠ‚ç‚¹çš„äºŒé˜¶é‚»å±…ï¼‰ï¼Œå±‚å±‚é€’è¿›ã€‚æ•´ä¸ªè®¡ç®—å›¾æ˜¯åœ¨ä¸€ä¸ªæ‰¹æ¬¡ä¸­åŠ¨æ€æ„å»ºçš„ï¼Œè¿™è¢«ç§°ä¸º&quot;on-the-fly&quot;å·ç§¯ã€‚</p>
</li>
</ol>
<details class="hint-container details"><summary>PinSage æ ¸å¿ƒæ€æƒ³å®ç°</summary>
<div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">nn </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">as</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> nn</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">functional </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">as</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> F</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> random</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"># æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„å®ç°ï¼Œæ—¨åœ¨è¯´æ˜PinSageçš„æ ¸å¿ƒæ€æƒ³ï¼Œ</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"># å·¥ä¸šçº§çš„å®ç°ä¼šå¤æ‚å¾—å¤šï¼Œå¹¶éœ€è¦é«˜æ•ˆçš„å›¾æ•°æ®åº“æ”¯æŒã€‚</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994"> SAGEConv</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">Module</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">    """</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">    PinSageçš„æ ¸å¿ƒå·ç§¯å±‚ï¼Œèšåˆé‡‡æ ·åˆ°çš„é‚»å±…ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">    """</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> __init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> in_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> out_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965">        super</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">SAGEConv</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">).</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965">__init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # èšåˆåçš„é‚»å±…ä¿¡æ¯å’ŒèŠ‚ç‚¹è‡ªèº«ä¿¡æ¯æ‹¼æ¥ï¼Œæ‰€ä»¥æ˜¯ in_dim * 2</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">agg_layer </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Linear</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">in_dim </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> out_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665"> forward</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> self_feats</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> neighbor_feats</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">        """</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">        Args:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            self_feats (Tensor): ä¸­å¿ƒèŠ‚ç‚¹è‡ªèº«çš„ç‰¹å¾ [batch_size, in_dim]</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            neighbor_feats (Tensor): é‡‡æ ·å¹¶èšåˆåçš„é‚»å±…ç‰¹å¾ [batch_size, in_dim]</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">        """</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # æ‹¼æ¥</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        combined </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">cat</span><span style="--shiki-light:#999999;--shiki-dark:#666666">([</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self_feats</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> neighbor_feats</span><span style="--shiki-light:#999999;--shiki-dark:#666666">],</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # æ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        output </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> F</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">relu</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">agg_layer</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">combined</span><span style="--shiki-light:#999999;--shiki-dark:#666666">))</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # æ ‡å‡†åŒ–</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">        return</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> F</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">normalize</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">output</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> p</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">2</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994"> PinSage</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">Module</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> __init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> in_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> hidden_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_layers</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">2</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965">        super</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">PinSage</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">).</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965">__init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_layers </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_layers</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">layers </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">ModuleList</span><span style="--shiki-light:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # åˆ›å»ºå¤šå±‚SAGEConv</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">        for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> i </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">in</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> range</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_layers</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            layer_in_dim </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> in_dim </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">if</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> i </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">==</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375"> else</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> hidden_dim</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">            self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">layers</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">SAGEConv</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">layer_in_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> hidden_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665"> forward</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> node_ids</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> full_feature_matrix</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> adj_list</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_samples_per_layer</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">        """</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">        PinSageçš„å‰å‘ä¼ æ’­</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">        Args:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            node_ids (list): ä¸€ä¸ªmini-batchçš„ä¸­å¿ƒèŠ‚ç‚¹ID</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            full_feature_matrix (Tensor): åŒ…å«æ‰€æœ‰èŠ‚ç‚¹ç‰¹å¾çš„çŸ©é˜µ</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            adj_list (dict): å›¾çš„é‚»æ¥è¡¨è¡¨ç¤º {node_id: [neighbor1, neighbor2, ...]}</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            num_samples_per_layer (list): æ¯å±‚è¦é‡‡æ ·çš„é‚»å±…æ•°é‡, e.g., [20, 10] for 2 layers</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">        """</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # h_l æ˜¯ç¬¬ l å±‚éœ€è¦çš„èŠ‚ç‚¹ç‰¹å¾</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        h </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> full_feature_matrix</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">node_ids</span><span style="--shiki-light:#999999;--shiki-dark:#666666">]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # ä»æœ€å¤–å±‚ (ç¬¬ k å±‚) å‘å†…å±‚ (ç¬¬ 1 å±‚) èšåˆ</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">        for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> l </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">in</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> range</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">num_layers </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">-</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676"> -</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676"> -</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            # è·å–å½“å‰å±‚è®¡ç®—æ‰€éœ€è¦çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆä¸Šä¸€å±‚èšåˆçš„ç»“æœï¼‰</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            current_nodes </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> h</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">size</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"> # å‡è®¾håŒ…å«äº†å½“å‰å±‚éœ€è¦çš„æ‰€æœ‰èŠ‚ç‚¹çš„ç‰¹å¾</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            # 1. é‡‡æ ·é‚»å±…</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            sampled_neighbors </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> []</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">            for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> node_id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">in</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> node_ids</span><span style="--shiki-light:#999999;--shiki-dark:#666666">:</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"> # éå†æ‰¹æ¬¡ä¸­çš„æ¯ä¸ªä¸­å¿ƒèŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                neighbors </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> adj_list</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">get</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">node_id</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> [])</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">                if</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> len</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">neighbors</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676"> ></span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_samples_per_layer</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">l</span><span style="--shiki-light:#999999;--shiki-dark:#666666">]:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    sampled </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> random</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">sample</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">neighbors</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_samples_per_layer</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">l</span><span style="--shiki-light:#999999;--shiki-dark:#666666">])</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">                else</span><span style="--shiki-light:#999999;--shiki-dark:#666666">:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    sampled </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> neighbors </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"># ä¸è¶³åˆ™å…¨éƒ¨é‡‡æ ·</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                sampled_neighbors</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">sampled</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            # 2. è·å–é‚»å±…ç‰¹å¾å¹¶èšåˆï¼ˆè¿™é‡Œç®€åŒ–ä¸ºå¹³å‡èšåˆï¼‰</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            neighbor_feats_list </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> []</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">            for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> neighbors </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">in</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> sampled_neighbors</span><span style="--shiki-light:#999999;--shiki-dark:#666666">:</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">                if</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> neighbors</span><span style="--shiki-light:#999999;--shiki-dark:#666666">:</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    neighbor_feats_list</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">mean</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">full_feature_matrix</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">neighbors</span><span style="--shiki-light:#999999;--shiki-dark:#666666">],</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666">))</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">                else</span><span style="--shiki-light:#999999;--shiki-dark:#666666">:</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"> # å¤„ç†å­¤ç«‹ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    neighbor_feats_list</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">zeros_like</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">full_feature_matrix</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666">]))</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            aggregated_neighbors </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">stack</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">neighbor_feats_list</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            # 3. èšåˆè‡ªèº«ä¸é‚»å±…ï¼Œé€šè¿‡SAGEConvå±‚æ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            # æ³¨æ„ï¼šè¿™é‡Œçš„ h éœ€è¦æ­£ç¡®å¯¹åº”ä¸Š</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            self_feats </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> full_feature_matrix</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">node_ids</span><span style="--shiki-light:#999999;--shiki-dark:#666666">]</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"> # è·å–ä¸­å¿ƒèŠ‚ç‚¹å½“å‰å±‚çš„ç‰¹å¾</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            h </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">layers</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">l</span><span style="--shiki-light:#999999;--shiki-dark:#666666">](</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self_feats</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> aggregated_neighbors</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            node_ids </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"> # ... æ›´æ–°ä¸‹ä¸€å±‚éœ€è¦è®¡ç®—çš„èŠ‚ç‚¹ ...</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">        return</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> h</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<p>PinSageä¸ä»…æä¾›äº†ä¸€ä¸ªå¯æ‰©å±•çš„GNNæ¶æ„ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå±•ç¤ºäº†ä¸€æ•´å¥—å°†GNNåº”ç”¨äºçœŸå®ã€æµ·é‡ã€å¤æ‚å·¥ä¸šåœºæ™¯çš„<strong>å·¥ç¨‹èŒƒå¼</strong>ï¼ŒåŒ…æ‹¬é‡‡æ ·ã€è´Ÿé‡‡æ ·ã€æ¨¡å‹éƒ¨ç½²ç­‰ï¼Œå½±å“æ·±è¿œã€‚</p>
<h2 id="ğŸŒˆ-han-æ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§" tabindex="-1"><a class="header-anchor" href="#ğŸŒˆ-han-æ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§"><span>ğŸŒˆ HANï¼šæ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§</span></a></h2>
<p>ç°å®ä¸–ç•Œçš„å›¾å¾ˆå°‘æ˜¯åŒè´¨çš„ã€‚ä¸€ä¸ªç”µå•†æ¨èåœºæ™¯çš„å›¾ï¼Œè‡³å°‘åŒ…å«ç”¨æˆ·ã€ç‰©å“ã€å“ç‰Œã€ç±»åˆ«ç­‰å¤šç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œä»¥åŠç‚¹å‡»ã€è´­ä¹°ã€å±äºï¼ˆç‰©å“å±äºæŸç±»åˆ«ï¼‰ç­‰å¤šç§ç±»å‹çš„è¾¹ã€‚è¿™ç§å›¾è¢«ç§°ä¸º<strong>å¼‚è´¨ä¿¡æ¯ç½‘ç»œï¼ˆHeterogeneous Information Network, HINï¼‰</strong>ã€‚</p>
<p>ç”¨åŒè´¨å›¾æ¨¡å‹ï¼ˆå¦‚LightGCNï¼‰æ¥å¤„ç†HINï¼Œä¼šä¸¢å¤±æ‰èŠ‚ç‚¹å’Œè¾¹çš„ç±»å‹ä¿¡æ¯ï¼Œæ— æ³•åŒºåˆ†&quot;ç”¨æˆ·è´­ä¹°ç‰©å“&quot;å’Œ&quot;ç‰©å“å±äºæŸå“ç‰Œ&quot;è¿™ä¸¤ç§å…³ç³»çš„è¯­ä¹‰å·®å¼‚ã€‚<strong>HAN (Heterogeneous Graph Attention Network)</strong> å°±æ˜¯ä¸ºè§£å†³è¿™ä¸€é—®é¢˜è€Œè®¾è®¡çš„ã€‚</p>
<h3 id="æ ¸å¿ƒæ€æƒ³-åŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒæ€æƒ³-åŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›"><span>æ ¸å¿ƒæ€æƒ³ï¼šåŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›</span></a></h3>
<p>HANçš„ç²¾é«“åœ¨äºå…¶**å±‚æ¬¡åŒ–æ³¨æ„åŠ›ï¼ˆHierarchical Attentionï¼‰**æœºåˆ¶ï¼Œå®ƒåˆ†ä¸ºä¸¤ä¸ªå±‚çº§ï¼š</p>
<ol>
<li>
<p><strong>èŠ‚ç‚¹çº§æ³¨æ„åŠ›ï¼ˆNode-level Attentionï¼‰</strong>ï¼šé¦–å…ˆï¼Œå®šä¹‰è‹¥å¹²æ¡<strong>å…ƒè·¯å¾„ï¼ˆMeta-pathï¼‰</strong>ã€‚å…ƒè·¯å¾„æ˜¯è¿æ¥ä¸åŒç±»å‹èŠ‚ç‚¹çš„è·¯å¾„ï¼Œä¾‹å¦‚ <code v-pre>ç”¨æˆ·-ç‰©å“-ç”¨æˆ·</code> (U-I-U) è¿™æ¡å…ƒè·¯å¾„å¯ä»¥æ•æ‰åˆ°&quot;è´­ä¹°äº†ç›¸åŒç‰©å“&quot;çš„ç›¸ä¼¼ç”¨æˆ·ã€‚æ²¿ç€æ¯ä¸€æ¡å…ƒè·¯å¾„ï¼ŒHANä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶èšåˆé‚»å±…èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆä¸€ä¸ªåŸºäºç‰¹å®šå…ƒè·¯å¾„çš„åµŒå…¥ã€‚</p>
</li>
<li>
<p><strong>è¯­ä¹‰çº§æ³¨æ„åŠ›ï¼ˆSemantic-level Attentionï¼‰</strong>ï¼šä¸€ä¸ªèŠ‚ç‚¹é€šè¿‡ä¸åŒçš„å…ƒè·¯å¾„ï¼Œä¼šå¾—åˆ°å¤šä¸ªä¸åŒè¯­ä¹‰çš„åµŒå…¥ï¼ˆå¦‚åŸºäºU-I-Uçš„åµŒå…¥å’ŒåŸºäºU-C-Uçš„åµŒå…¥ï¼‰ã€‚è¿™äº›ä¸åŒè¯­ä¹‰çš„é‡è¦æ€§æ˜¾ç„¶æ˜¯ä¸åŒçš„ã€‚å› æ­¤ï¼ŒHANå¼•å…¥äº†ç¬¬äºŒå±‚æ³¨æ„åŠ›ï¼Œå³è¯­ä¹‰çº§æ³¨æ„åŠ›ï¼Œæ¥å­¦ä¹ ä¸åŒå…ƒè·¯å¾„çš„é‡è¦æ€§æƒé‡ï¼Œæœ€ç»ˆå°†å¤šä¸ªè¯­ä¹‰åµŒå…¥åŠ æƒèåˆæˆä¸€ä¸ªç»Ÿä¸€çš„èŠ‚ç‚¹è¡¨ç¤ºã€‚</p>
</li>
</ol>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒHANèƒ½å¤Ÿæ™ºèƒ½åœ°è¯†åˆ«å¹¶èåˆæ¥è‡ªä¸åŒç±»å‹å…³ç³»çš„ä¿¡æ¯ï¼Œä»è€Œå­¦ä¹ åˆ°æ›´ä¸°å¯Œã€æ›´å…·è¡¨ç°åŠ›çš„èŠ‚ç‚¹è¡¨ç¤ºã€‚</p>
<details class="hint-container details"><summary>HAN æ ¸å¿ƒæ€æƒ³å®ç°</summary>
<div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">nn </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">as</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> nn</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">functional </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">as</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> F</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994"> SemanticAttention</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">Module</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">    """</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">    HANä¸­çš„è¯­ä¹‰å±‚æ³¨æ„åŠ›ï¼Œç”¨äºèåˆä¸åŒå…ƒè·¯å¾„å¸¦æ¥çš„åµŒå…¥</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">    """</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> __init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> in_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> hidden_dim</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">128</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965">        super</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">SemanticAttention</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">).</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965">__init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">project </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Sequential</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Linear</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">in_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> hidden_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">),</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Tanh</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(),</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">Linear</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">hidden_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> bias</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">False</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666">        )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665"> forward</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> z</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"> # zæ˜¯ [num_nodes, num_metapaths, in_dim]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # è®¡ç®—æ¯ä¸ªå…ƒè·¯å¾„çš„é‡è¦æ€§ w_phi = q^T * tanh(W*z_phi + b)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        w </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">project</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">z</span><span style="--shiki-light:#999999;--shiki-dark:#666666">).</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">mean</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">                    # [num_metapaths, 1]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        beta </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">softmax</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">w</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">                 # [num_metapaths, 1]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        beta </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> beta</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">expand</span><span style="--shiki-light:#999999;--shiki-dark:#666666">((</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">z</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">shape</span><span style="--shiki-light:#999999;--shiki-dark:#666666">[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666">],)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676"> +</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> beta</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">shape</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"> # [num_nodes, num_metapaths, 1]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # åŠ æƒæ±‚å’Œ</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">        return</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">beta </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> z</span><span style="--shiki-light:#999999;--shiki-dark:#666666">).</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">sum</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">                       # [num_nodes, in_dim]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994"> HANLayer</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">Module</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> __init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_metapaths</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> in_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> out_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_heads</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965">        super</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">HANLayer</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">).</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965">__init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # èŠ‚ç‚¹çº§æ³¨æ„åŠ›å±‚ (ä¸ºæ¯ç§å…ƒè·¯å¾„åˆ›å»ºä¸€ä¸ªGATå±‚)</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">gat_layers </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">ModuleList</span><span style="--shiki-light:#999999;--shiki-dark:#666666">([</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            # è¿™é‡Œçš„GATConvéœ€è¦èƒ½å¤„ç†å¼‚è´¨å›¾çš„è¾¹</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            # åœ¨å®è·µä¸­ä¼šç”¨PyGæˆ–DGLç­‰åº“ä¸­çš„HANConvæˆ–HGTConv</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            # GraphAttentionLayer(in_dim, out_dim, num_heads) for _ in range(num_metapaths)</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666">        ])</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # è¯­ä¹‰çº§æ³¨æ„åŠ›å±‚</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">semantic_attention </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> SemanticAttention</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A">in_dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">out_dim </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> num_heads</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665"> forward</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> g</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> h</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"> # gæ˜¯å¼‚è´¨å›¾, hæ˜¯èŠ‚ç‚¹ç‰¹å¾å­—å…¸</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        semantic_embeddings </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#999999;--shiki-dark:#666666"> []</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # å¯¹æ¯ä¸ªå…ƒè·¯å¾„ï¼ˆè¾¹ç±»å‹ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">        for</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> i</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> gat_layer </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">in</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> enumerate</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">gat_layers</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            # ä½¿ç”¨å¯¹åº”çš„GATå±‚è¿›è¡ŒèŠ‚ç‚¹çº§èšåˆ</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            # semantic_embeddings.append(gat_layer(g.edge_type_subgraph([edge_type]), h))</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">            pass</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"> # ä¼ªä»£ç </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # å°†ä¸åŒå…ƒè·¯å¾„çš„åµŒå…¥å †å èµ·æ¥</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        semantic_embeddings </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">stack</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">semantic_embeddings</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD"> # [N, num_metapaths, D_out]</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # é€šè¿‡è¯­ä¹‰æ³¨æ„åŠ›è¿›è¡Œèåˆ</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">        return</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">semantic_attention</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">semantic_embeddings</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<h2 id="âš”ï¸-gnnçš„ç°ä»£è®­ç»ƒå¿ƒæ³•" tabindex="-1"><a class="header-anchor" href="#âš”ï¸-gnnçš„ç°ä»£è®­ç»ƒå¿ƒæ³•"><span>âš”ï¸ GNNçš„ç°ä»£è®­ç»ƒå¿ƒæ³•</span></a></h2>
<p>é™¤äº†æ¨¡å‹æ¶æ„ï¼ŒGNNçš„è®­ç»ƒæ–¹å¼ä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ã€‚ç°ä»£çš„GNNè®­ç»ƒï¼Œå°¤å…¶æ˜¯è‡ªç›‘ç£å­¦ä¹ çš„å¼•å…¥ï¼Œæå¤§åœ°æå‡äº†æ¨¡å‹çš„æ€§èƒ½å’Œé²æ£’æ€§ã€‚</p>
<h3 id="å›¾å¯¹æ¯”å­¦ä¹ -graph-contrastive-learning" tabindex="-1"><a class="header-anchor" href="#å›¾å¯¹æ¯”å­¦ä¹ -graph-contrastive-learning"><span>å›¾å¯¹æ¯”å­¦ä¹ ï¼ˆGraph Contrastive Learningï¼‰</span></a></h3>
<p>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>åœ¨åµŒå…¥ç©ºé—´ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„&quot;å¢å¼ºè§†å›¾&quot;åº”è¯¥ä¸å®ƒè‡ªèº«çš„å…¶ä»–&quot;å¢å¼ºè§†å›¾&quot;å°½å¯èƒ½ç›¸ä¼¼ï¼Œè€Œä¸å…¶ä»–èŠ‚ç‚¹çš„è§†å›¾å°½å¯èƒ½è¿œç¦»ã€‚</strong></p>
<ul>
<li><strong>å›¾å¢å¼ºï¼ˆGraph Augmentationï¼‰</strong>ï¼šå¦‚ä½•åˆ›é€ &quot;å¢å¼ºè§†å›¾&quot;ï¼Ÿé€šå¸¸é€šè¿‡å¯¹åŸå›¾è¿›è¡Œéšæœºæ‰°åŠ¨ï¼Œå¦‚<strong>éšæœºåˆ è¾¹ï¼ˆEdge Droppingï¼‰</strong>ã€ <strong>éšæœºèŠ‚ç‚¹ä¸¢å¼ƒï¼ˆNode Droppingï¼‰</strong> æˆ– <strong>ç‰¹å¾æ©ç ï¼ˆFeature Maskingï¼‰</strong> æ¥ç”Ÿæˆä¸¤ä¸ªç›¸å…³çš„å­å›¾ã€‚</li>
<li><strong>å¯¹æ¯”æŸå¤±ï¼ˆContrastive Lossï¼‰</strong> ï¼šå°†æ¥è‡ªåŒä¸€åŸå§‹èŠ‚ç‚¹çš„è¡¨ç¤ºä½œä¸º<strong>æ­£æ ·æœ¬å¯¹</strong>ï¼Œæ¥è‡ªä¸åŒèŠ‚ç‚¹çš„è¡¨ç¤ºä½œä¸º<strong>è´Ÿæ ·æœ¬å¯¹</strong>ã€‚ç„¶åä½¿ç”¨InfoNCEç­‰å¯¹æ¯”æŸå¤±å‡½æ•°ï¼Œåœ¨åµŒå…¥ç©ºé—´ä¸­æ‹‰è¿‘æ­£æ ·æœ¬ï¼Œæ¨å¼€è´Ÿæ ·æœ¬ã€‚</li>
</ul>
<p>è¿™ç§è‡ªç›‘ç£çš„è®­ç»ƒæ–¹å¼ï¼Œå¯ä»¥å¸®åŠ©GNNå­¦ä¹ åˆ°å¯¹å™ªå£°ä¸æ•æ„Ÿçš„ã€æ›´å…·æœ¬è´¨æ€§çš„ç»“æ„ä¿¡æ¯ï¼Œå³ä½¿åœ¨æ ‡ç­¾æ•°æ®ç¨€ç–çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å–å¾—ä¼˜å¼‚æ•ˆæœã€‚</p>
<details class="hint-container details"><summary>å›¾å¯¹æ¯”å­¦ä¹ æŸå¤± (InfoNCE)</summary>
<div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" v-pre=""><code class="language-python"><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">class</span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994"> GraphContrastiveLoss</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665">Module</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965"> __init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> temperature</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">0.1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965">        super</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">GraphContrastiveLoss</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">).</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965">__init__</span><span style="--shiki-light:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">temperature </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> temperature</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076">        self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">criterion </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> nn</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">CrossEntropyLoss</span><span style="--shiki-light:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676">    def</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665"> forward</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> z1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> z2</span><span style="--shiki-light:#999999;--shiki-dark:#666666">):</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">        """</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">        Args:</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D">            z1, z2: ä¸¤ä¸ªå›¾å¢å¼ºè§†å›¾çš„èŠ‚ç‚¹åµŒå…¥, shape [N, D]</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77">        """</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        sim </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">mm</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">F</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">normalize</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">z1</span><span style="--shiki-light:#999999;--shiki-dark:#666666">),</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> F</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">normalize</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">z2</span><span style="--shiki-light:#999999;--shiki-dark:#666666">).</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">T</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676"> /</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">temperature</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # æ­£æ ·æœ¬åœ¨å¯¹è§’çº¿ä¸Š</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        labels </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">arange</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">sim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">size</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)).</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">to</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">sim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">device</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        </span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        # è®¡ç®—æŸå¤±</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        loss </span><span style="--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">criterion</span><span style="--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">sim</span><span style="--shiki-light:#999999;--shiki-dark:#666666">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> labels</span><span style="--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375">        return</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> loss</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<h2 id="ğŸ“–-å»¶ä¼¸é˜…è¯»" tabindex="-1"><a class="header-anchor" href="#ğŸ“–-å»¶ä¼¸é˜…è¯»"><span>ğŸ“– å»¶ä¼¸é˜…è¯»</span></a></h2>
<p><strong>ç»å…¸è®ºæ–‡</strong>ï¼š</p>
<ul>
<li><a href="https://arxiv.org/abs/2002.02126" target="_blank" rel="noopener noreferrer">LightGCN: Simplifying and Powering Graph Convolution Network for Recommendation (SIGIR'20)</a></li>
<li><a href="https://arxiv.org/abs/1806.01973" target="_blank" rel="noopener noreferrer">Graph Convolutional Neural Networks for Web-Scale Recommender Systems (KDD'18, PinSage)</a></li>
<li><a href="https://arxiv.org/abs/1903.07293" target="_blank" rel="noopener noreferrer">Heterogeneous Graph Attention Network (WWW'19, HAN)</a></li>
<li><a href="https://arxiv.org/abs/2010.10783" target="_blank" rel="noopener noreferrer">Self-supervised Graph Learning for Recommendation (SIGIR'21, SGL)</a></li>
</ul>
<p><strong>å¼€æºæ¡†æ¶</strong>ï¼š</p>
<ul>
<li><a href="https://github.com/pyg-team/pytorch_geometric" target="_blank" rel="noopener noreferrer">PyTorch Geometric (PyG)</a>ï¼šæœ€æµè¡Œçš„GNNåº“ä¹‹ä¸€ï¼Œæä¾›äº†å¤§é‡GNNæ¨¡å‹å’Œå·¥å…·ã€‚</li>
<li><a href="https://github.com/dmlc/dgl" target="_blank" rel="noopener noreferrer">DGL (Deep Graph Library)</a>ï¼šå¦ä¸€ä¸ªå¼ºå¤§çš„å›¾å­¦ä¹ æ¡†æ¶ï¼Œæ”¯æŒå¤šç§åç«¯ã€‚</li>
<li><a href="https://github.com/RUCAIBox/RecBole" target="_blank" rel="noopener noreferrer">RecBole</a>ï¼šä¸€ä¸ªç»Ÿä¸€ã€å…¨é¢çš„æ¨èç®—æ³•å¤ç°åº“ï¼ŒåŒ…å«äº†å¤šç§GNNæ¨¡å‹ã€‚</li>
</ul>
<blockquote>
<p>ğŸ§  <strong>æ€è€ƒé¢˜</strong></p>
<ol>
<li><strong>LightGCN vs. GCN</strong>ï¼šä½ è®¤ä¸ºLightGCNç§»é™¤çš„éçº¿æ€§å’Œç‰¹å¾å˜æ¢ï¼Œä¸ºä»€ä¹ˆåœ¨ååŒè¿‡æ»¤åœºæ™¯ä¸‹æ˜¯&quot;å¤šä½™&quot;çš„ï¼Ÿå®ƒå¯èƒ½åœ¨ä»€ä¹ˆç±»å‹çš„å›¾æ•°æ®ä¸Šè¡¨ç°ä¸ä½³ï¼Ÿ</li>
<li><strong>é‡‡æ ·ç­–ç•¥çš„æƒè¡¡</strong>ï¼šPinSageçš„éšæœºæ¸¸èµ°é‡‡æ ·ç›¸æ¯”å‡åŒ€é‚»å±…é‡‡æ ·ï¼Œå…¶ä¼˜åŠ¿å’ŒåŠ£åŠ¿åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½ å¯èƒ½ä¼šé€‰æ‹©åè€…ï¼Ÿ</li>
<li><strong>å†·å¯åŠ¨é—®é¢˜</strong>ï¼šå¯¹äºä¸€ä¸ªæ²¡æœ‰ä»»ä½•äº¤äº’çš„æ–°ç”¨æˆ·ï¼ˆ&quot;å†·å¯åŠ¨&quot;ç”¨æˆ·ï¼‰ï¼ŒGNNæ¨¡å‹ï¼ˆç‰¹åˆ«æ˜¯LightGCNï¼‰å°†å¦‚ä½•ä¸ºä»–ç”ŸæˆåµŒå…¥å¹¶è¿›è¡Œæ¨èï¼Ÿä½ æœ‰ä»€ä¹ˆæ”¹è¿›çš„æ€è·¯å—ï¼Ÿ</li>
<li><strong>å…ƒè·¯å¾„çš„è®¾è®¡</strong>ï¼šåœ¨ä¸€ä¸ªåŒ…å«&quot;ç”¨æˆ·-æœç´¢-ç‰©å“-è´­ä¹°&quot;è¡Œä¸ºçš„ç”µå•†åœºæ™¯ä¸­ï¼Œè¯·ä½ è®¾è®¡è‡³å°‘ä¸‰æ¡æœ‰æ„ä¹‰çš„å…ƒè·¯å¾„ï¼Œå¹¶è¯´æ˜å®ƒä»¬å„è‡ªèƒ½æ•æ‰åˆ°ä»€ä¹ˆæ¨èä¿¡å·ã€‚</li>
<li><strong>å›¾å¢å¼ºçš„é£é™©</strong>ï¼šå›¾å¯¹æ¯”å­¦ä¹ ä¸­çš„æ•°æ®å¢å¼ºï¼ˆå¦‚åˆ è¾¹ã€åˆ ç‚¹ï¼‰å¦‚æœæ“ä½œä¸å½“ï¼Œå¯èƒ½ä¼šç ´åå›¾çš„å…³é”®ç»“æ„ä¿¡æ¯ã€‚ä½ è®¤ä¸ºè¯¥å¦‚ä½•è®¾ç½®å¢å¼ºçš„å¼ºåº¦ï¼ˆæ¯”å¦‚åˆ é™¤æ¯”ä¾‹ï¼‰ï¼Œä»¥åœ¨&quot;åˆ›é€ å¤šæ ·æ€§&quot;å’Œ&quot;ä¿æŒç»“æ„&quot;ä¹‹é—´å–å¾—å¹³è¡¡ï¼Ÿ</li>
</ol>
</blockquote>
</div></template>


