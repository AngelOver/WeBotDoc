{"content":"<p>å¦‚æœè¯´å¬å›æ˜¯ä»äº¿ä¸‡ç‰©æ–™ä¸­&quot;å¤§æµ·æé’ˆ&quot;ï¼Œé‚£ä¹ˆ<strong>æ’åºï¼ˆRankingï¼‰</strong> å°±æ˜¯åœ¨è¿™å‡ ç™¾æ ¹&quot;é’ˆ&quot;é‡Œæ‰¾å‡ºæœ€äº®çš„é‚£ä¸€æ ¹ã€‚å®ƒæ˜¯æ¨èæµç¨‹çš„&quot;æœ€åä¸€å…¬é‡Œ&quot;ï¼Œè´Ÿè´£å¯¹å¬å›çš„å€™é€‰é›†è¿›è¡Œç²¾å‡†æ‰“åˆ†ï¼Œé¢„æµ‹ç”¨æˆ·å¯¹æ¯ä¸ªç‰©å“çš„åå¥½ç¨‹åº¦ï¼ˆå¦‚ç‚¹å‡»ç‡pCTRã€è½¬åŒ–ç‡pCVRï¼‰ï¼Œç„¶åæŒ‰åˆ†å€¼é«˜ä½å‘ˆç°ç»™ç”¨æˆ·ã€‚</p>\n<p>æ’åºæ¨¡å‹çš„å¥½åï¼Œç›´æ¥å†³å®šäº†ç”¨æˆ·çš„æœ€ç»ˆä½“éªŒå’Œå¹³å°çš„å•†ä¸šç›®æ ‡ã€‚è¿™æ˜¯ä¸€ä¸ªäºç»†å¾®å¤„è§çœŸç« çš„&quot;ç‚¼é‡‘&quot;è¿‡ç¨‹ï¼Œæ¨¡å‹çš„æ¯ä¸€æ¬¡å¾®å°è¿­ä»£ï¼Œéƒ½å¯èƒ½å¸¦æ¥å·¨å¤§çš„æ”¶ç›Šã€‚</p>\n<h2 id=\"ğŸ›ï¸-æ¨¡å‹æ¼”è¿›ä¹‹è·¯-ä»åˆ†ç«‹åˆ°èåˆ-ä»äººå·¥åˆ°è‡ªåŠ¨\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ›ï¸-æ¨¡å‹æ¼”è¿›ä¹‹è·¯-ä»åˆ†ç«‹åˆ°èåˆ-ä»äººå·¥åˆ°è‡ªåŠ¨\"><span>ğŸ›ï¸ æ¨¡å‹æ¼”è¿›ä¹‹è·¯ï¼šä»åˆ†ç«‹åˆ°èåˆï¼Œä»äººå·¥åˆ°è‡ªåŠ¨</span></a></h2>\n<p>æ·±åº¦æ’åºæ¨¡å‹çš„æ¼”è¿›ï¼Œæ˜¯ä¸€éƒ¨è¿½æ±‚&quot;æ›´é«˜ã€æ›´å¿«ã€æ›´å¼º&quot;çš„ç‰¹å¾å·¥ç¨‹ä¸æ¨¡å‹ç»“æ„åˆ›æ–°å²ã€‚</p>\n<h3 id=\"å¥ åŸºæ—¶ä»£-wide-deep-â€”â€”-è®°å¿†-ä¸-æ³›åŒ–-çš„é¦–æ¬¡è”å§»\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¥ åŸºæ—¶ä»£-wide-deep-â€”â€”-è®°å¿†-ä¸-æ³›åŒ–-çš„é¦–æ¬¡è”å§»\"><span>å¥ åŸºæ—¶ä»£ï¼šWide &amp; Deep â€”â€” &quot;è®°å¿†&quot;ä¸&quot;æ³›åŒ–&quot;çš„é¦–æ¬¡è”å§»</span></a></h3>\n<p>Googleåœ¨2016å¹´æå‡ºçš„ <code v-pre>Wide &amp; Deep</code> æ¨¡å‹ï¼Œæ˜¯æ·±åº¦å­¦ä¹ åœ¨æ¨èé¢†åŸŸé‡Œç¨‹ç¢‘å¼çš„ä½œå“ï¼Œå®ƒå¥ å®šäº†ç°ä»£æ’åºæ¨¡å‹çš„åŸºæœ¬èŒƒå¼ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä»»ä½•æ¨èåœºæ™¯éƒ½ç¦»ä¸å¼€&quot;è®°å¿†&quot;ï¼ˆMemorizationï¼‰å’Œ&quot;æ³›åŒ–&quot;ï¼ˆGeneralizationï¼‰ã€‚\n<ul>\n<li><strong>Wideéƒ¨åˆ†ï¼ˆè®°å¿†ï¼‰</strong>ï¼šä¸€ä¸ªå¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼Œè´Ÿè´£è®°å¿†é‚£äº›é¢‘ç¹å…±ç°çš„ã€é‡è¦çš„äº¤å‰ç‰¹å¾ï¼Œæ¯”å¦‚&quot;ç”¨æˆ·çˆ±å–æ‹¿é“ &amp; åŸå¸‚æ˜¯ä¸Šæµ·&quot;ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•ã€å¯è§£é‡Šæ€§å¼ºã€‚</li>\n<li><strong>Deepéƒ¨åˆ†ï¼ˆæ³›åŒ–ï¼‰</strong>ï¼šä¸€ä¸ªæ ‡å‡†çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆDNNï¼‰ï¼Œè´Ÿè´£å°†ç¨€ç–ç‰¹å¾åµŒå…¥åˆ°ä½ç»´ç¨ å¯†ç©ºé—´ï¼Œå­¦ä¹ é‚£äº›ä»æœªæˆ–å¾ˆå°‘å‡ºç°çš„ç‰¹å¾ç»„åˆï¼Œæ¢ç´¢æœªçŸ¥çš„å¯èƒ½æ€§ã€‚</li>\n</ul>\n</li>\n<li><strong>ç²¾é«“</strong>ï¼šå°†ä¸¤è€…è”åˆè®­ç»ƒï¼Œè®©æ¨¡å‹åŒæ—¶å…·å¤‡è®°ä½&quot;å†å²ç»éªŒ&quot;å’Œæ¢ç´¢&quot;æ–°é²œäº‹ç‰©&quot;çš„èƒ½åŠ›ã€‚</li>\n</ul>\n<Mermaid id=\"mermaid-42\" code=\"eJxLL0osyFAIceFSAILi0iQIXyk8MyVVISCxqEQJLAECKZlFqcklmfl5Cj5BcMHweDfXaLDqJ/uWP+/c+XRfo01Skb7d02VNT3YtedrfCRFTilXQ1bUDqvbxjVZ6unP/k52dz3ftf9aw/NmKhU/ndSvFgg1MzUvhQnOHS2pqATHucAG7A6Qawx2eLs837tZReLpxHtA+IBPqFpd419ykaCUgkZqSkpmX/nRjE1zGxc8PaJifH7q7QO4HKwkuzQULgJXCRcBCQEa0Uow21Cz/0pKC0pJopeDM9Nz8zJQX+yY/bd8FNJYLAEu4hSM=\"></Mermaid><details class=\"hint-container details\"><summary>ğŸ’» Wide&amp;Deep æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> WideDeep</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Wide &#x26; Deep Model</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        wide_features (list): Wideä¾§çš„ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        deep_features (list): Deepä¾§çš„ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> wide_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Wideéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆè¾“å‡ºå±‚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            x (dict): è¾“å…¥ç‰¹å¾, a dictionary with keys being feature names.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Wideä¾§é€»è¾‘</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        wide_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, wide_embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepä¾§é€»è¾‘</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, deep_embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_output </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, mlp_output_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥Wideå’ŒDeepçš„è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        concat_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_output</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">concat_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h3 id=\"äº¤å‰æ—¶ä»£-å‘Šåˆ«-äººå·¥ç‚¼ä¸¹-æ‹¥æŠ±-è‡ªåŠ¨é©¾é©¶\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#äº¤å‰æ—¶ä»£-å‘Šåˆ«-äººå·¥ç‚¼ä¸¹-æ‹¥æŠ±-è‡ªåŠ¨é©¾é©¶\"><span>äº¤å‰æ—¶ä»£ï¼šå‘Šåˆ«&quot;äººå·¥ç‚¼ä¸¹&quot;ï¼Œæ‹¥æŠ±&quot;è‡ªåŠ¨é©¾é©¶&quot;</span></a></h3>\n<p><code v-pre>Wide &amp; Deep</code> çš„ä¸€ä¸ªç—›ç‚¹æ˜¯ï¼ŒWideéƒ¨åˆ†çš„äº¤å‰ç‰¹å¾ä»ç„¶éœ€è¦å¤§é‡çš„äººå·¥è®¾è®¡å’Œç­›é€‰ï¼Œè¿™æ˜¯ä¸€é¡¹ç¹çä¸”ç»éªŒä¾èµ–çš„&quot;ç‚¼ä¸¹&quot;å·¥ä½œã€‚äºæ˜¯ï¼Œä¸€ç³»åˆ—èƒ½<strong>è‡ªåŠ¨å­¦ä¹ ç‰¹å¾äº¤å‰</strong>çš„æ¨¡å‹åº”è¿è€Œç”Ÿã€‚</p>\n<h4 id=\"deepfm-fmä¸dnnçš„ç è”ç’§åˆ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#deepfm-fmä¸dnnçš„ç è”ç’§åˆ\"><span>DeepFMï¼šFMä¸DNNçš„ç è”ç’§åˆ</span></a></h4>\n<p><code v-pre>DeepFM</code> æ˜¯è¿™ä¸ªæ—¶ä»£æœ€è€€çœ¼çš„æ˜æ˜Ÿï¼Œè‡³ä»Šä»æ˜¯è®¸å¤šå…¬å¸çº¿ä¸Šæ¨¡å‹çš„ä¸»åŠ›ã€‚å®ƒå·§å¦™åœ°å°†å› å­åˆ†è§£æœºï¼ˆFMï¼‰å’ŒDNNç»“åˆåœ¨äº†ä¸€ä¸ªæ¡†æ¶ä¸­ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š\n<ul>\n<li><strong>FMéƒ¨åˆ†</strong>ï¼šä¸Wideéƒ¨åˆ†ç±»ä¼¼ï¼Œä½†å®ƒèƒ½è‡ªåŠ¨å­¦ä¹ æ‰€æœ‰ç‰¹å¾ä¹‹é—´çš„äºŒé˜¶äº¤å‰ï¼Œæ— éœ€äººå·¥æŒ‡å®šã€‚</li>\n<li><strong>Deepéƒ¨åˆ†</strong>ï¼šä¸<code v-pre>Wide &amp; Deep</code>ä¸­çš„Deepéƒ¨åˆ†ä¸€è‡´ï¼Œå­¦ä¹ é«˜é˜¶äº¤å‰ç‰¹å¾ã€‚</li>\n</ul>\n</li>\n<li><strong>ç²¾é«“</strong>ï¼šFMéƒ¨åˆ†å’ŒDeepéƒ¨åˆ†çš„è¾“å…¥Embeddingæ˜¯<strong>å…±äº«</strong>çš„ï¼è¿™å¸¦æ¥äº†ä¸¤å¤§å¥½å¤„ï¼š\n<ol>\n<li>æ¨¡å‹æ›´å°ï¼Œè®­ç»ƒæ›´å¿«ã€‚</li>\n<li>Embeddingå±‚èƒ½è¢«ä½é˜¶å’Œé«˜é˜¶äº¤å‰ä¿¡å·åŒæ—¶è®­ç»ƒï¼Œå­¦ä¹ æ›´å……åˆ†ã€‚</li>\n</ol>\n</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» DeepFM æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> FM</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> DeepFM</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    DeepFM Model</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        deep_features (list): ç”¨äºDeepå’ŒFMéƒ¨åˆ†çš„ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # DeepFMä¸­ï¼Œæ‰€æœ‰ç‰¹å¾éƒ½ç”¨äºDeepå’ŒFMéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # FMéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fm </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> FM</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">reduce_sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆè¾“å‡ºå±‚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # 1 (æ¥è‡ªFM) + mlp_output_dim (æ¥è‡ªDeep)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            x (dict): è¾“å…¥ç‰¹å¾å­—å…¸.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è·å–æ‰€æœ‰ç‰¹å¾çš„Embedding</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        embed_x </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, n_fields, embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # FMéƒ¨åˆ†è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        fm_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, 1)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†è¾“å…¥éœ€è¦å°†Embeddingå±•å¹³</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">flatten</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">start_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, n_fields * embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, mlp_output_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥FMå’ŒDeepçš„è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        concat_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fm_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">concat_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h4 id=\"dcn-v2-æ›´å¼ºå¤§çš„æ˜¾å¼äº¤å‰ç½‘ç»œ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#dcn-v2-æ›´å¼ºå¤§çš„æ˜¾å¼äº¤å‰ç½‘ç»œ\"><span>DCN V2ï¼šæ›´å¼ºå¤§çš„æ˜¾å¼äº¤å‰ç½‘ç»œ</span></a></h4>\n<p><code v-pre>DCN</code> (Deep &amp; Cross Network) æä¾›äº†å¦ä¸€ç§æ˜¾å¼å­¦ä¹ ç‰¹å¾äº¤å‰çš„æ€è·¯ã€‚å®ƒè®¾è®¡çš„<code v-pre>Cross Network</code>å¯ä»¥åœ¨æ¯ä¸€å±‚éƒ½ä¿ç•™ä¹‹å‰æ‰€æœ‰å±‚çš„äº¤å‰ç»“æœï¼Œå¹¶ä¸åŸå§‹è¾“å…¥è¿›è¡Œæ–°ä¸€è½®çš„äº¤å‰ã€‚<code v-pre>DCN V2</code> æ˜¯å…¶æ”¹è¿›ç‰ˆï¼Œç»“æ„æ›´ç¨³å®šï¼Œè¡¨ç°æ›´ä¼˜ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š\n<ul>\n<li><strong>Crosséƒ¨åˆ†</strong>ï¼šç”¨ä¸€ä¸ªç‰¹å®šçš„ç½‘ç»œç»“æ„ï¼Œåœ¨æ¯ä¸€å±‚éƒ½æ˜¾å¼åœ°ã€è‡ªåŠ¨åœ°è¿›è¡Œç‰¹å¾äº¤å‰ï¼Œäº¤å‰çš„é˜¶æ•°ç”±ç½‘ç»œæ·±åº¦å†³å®šã€‚</li>\n<li><strong>Deepéƒ¨åˆ†</strong>ï¼šä¸€ä¸ªæ ‡å‡†çš„DNNï¼Œä¸Crosséƒ¨åˆ†å¹¶è¡Œã€‚</li>\n</ul>\n</li>\n<li><strong>ç²¾é«“</strong>ï¼šç›¸æ¯”äºFMåªèƒ½åšäºŒé˜¶äº¤å‰ï¼ŒCrossç½‘ç»œèƒ½ä»¥ä¸€ç§é«˜æ•ˆä¸”æœ‰ç•Œçš„æ–¹å¼ï¼Œå­¦ä¹ æ›´é«˜é˜¶çš„äº¤å‰ç‰¹å¾ã€‚</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» DCN V2 æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CrossNetworkV2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> DCNv2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Deep &#x26; Cross Network V2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        features (list): æ‰€æœ‰ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        cross_layer_num (int): Crossç½‘ç»œçš„å±‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> cross_layer_num</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Crosséƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cross_net </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CrossNetworkV2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> cross_layer_num</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥Crosså’ŒDeepçš„è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        embed_x </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">flatten</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">start_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, n_fields * embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Crosséƒ¨åˆ†è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        cross_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cross_net</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        concat_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cross_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">concat_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h3 id=\"æ³¨æ„åŠ›æ—¶ä»£-è®©æ¨¡å‹çŸ¥é“è¯¥-çœ‹-å“ªé‡Œ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ³¨æ„åŠ›æ—¶ä»£-è®©æ¨¡å‹çŸ¥é“è¯¥-çœ‹-å“ªé‡Œ\"><span>æ³¨æ„åŠ›æ—¶ä»£ï¼šè®©æ¨¡å‹çŸ¥é“è¯¥&quot;çœ‹&quot;å“ªé‡Œ</span></a></h3>\n<p>ä¹‹å‰çš„æ¨¡å‹åœ¨å¤„ç†ç”¨æˆ·å†å²è¡Œä¸ºæ—¶ï¼Œé€šå¸¸æ˜¯å°†æ‰€æœ‰è¡Œä¸ºçš„Embeddingåšç®€å•çš„Poolingï¼ˆå¦‚Sum/Averageï¼‰ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„â€”â€”ç”¨æˆ·çœ‹è¿‡çš„100ä¸ªè§†é¢‘ï¼Œè·Ÿå½“å‰è¦æ¨èçš„&quot;è·‘é‹&quot;å¹¿å‘Šï¼Œç›¸å…³æ€§å¿…ç„¶æœ‰é«˜æœ‰ä½ã€‚<strong>æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttentionï¼‰</strong> çš„å¼•å…¥ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>\n<h4 id=\"din-ä¸ºç”¨æˆ·å…´è¶£åŠ¨æ€-èšç„¦\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#din-ä¸ºç”¨æˆ·å…´è¶£åŠ¨æ€-èšç„¦\"><span>DINï¼šä¸ºç”¨æˆ·å…´è¶£åŠ¨æ€&quot;èšç„¦&quot;</span></a></h4>\n<p><code v-pre>DIN</code> (Deep Interest Network) æ˜¯é˜¿é‡Œæå‡ºçš„ã€åœ¨å·¥ä¸šç•Œå½±å“æ·±è¿œçš„æ¨¡å‹ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šç”¨æˆ·çš„å…´è¶£æ˜¯å¤šæ ·çš„ï¼Œå¹¶ä¸”åœ¨é¢å¯¹ä¸åŒçš„å€™é€‰å•†å“æ—¶ï¼Œç›¸å…³çš„å…´è¶£ç‚¹ä¹Ÿä¸åŒã€‚</li>\n<li><strong>ç²¾é«“</strong>ï¼š\n<ol>\n<li>ä¸å†å¯¹ç”¨æˆ·å†å²è¡Œä¸ºåšç®€å•çš„Poolingã€‚</li>\n<li>å¼•å…¥ä¸€ä¸ª&quot;æ³¨æ„åŠ›å•å…ƒ&quot;ï¼Œå°†<strong>å€™é€‰å•†å“</strong>ï¼ˆTarget Adï¼‰ä½œä¸ºæŸ¥è¯¢ï¼ˆQueryï¼‰ï¼Œå»åŠ¨æ€åœ°è®¡ç®—ç”¨æˆ·å†å²è¡Œä¸ºåºåˆ—ä¸­æ¯ä¸ªè¡Œä¸ºçš„&quot;æ³¨æ„åŠ›å¾—åˆ†&quot;ã€‚</li>\n<li>å¯¹å†å²è¡Œä¸ºçš„EmbeddingåšåŠ æƒæ±‚å’Œï¼Œæƒé‡å°±æ˜¯æ³¨æ„åŠ›å¾—åˆ†ã€‚è¿™æ ·ï¼Œä¸å½“å‰å€™é€‰å•†å“è¶Šç›¸å…³çš„å†å²è¡Œä¸ºï¼Œæƒé‡å°±è¶Šé«˜ã€‚</li>\n<li>æœ€åï¼Œå°†è¿™ä¸ª&quot;èšç„¦&quot;åçš„ç”¨æˆ·å…´è¶£å‘é‡ï¼Œä¸å…¶ä»–ç‰¹å¾ä¸€èµ·é€å…¥DNNè¿›è¡Œé¢„æµ‹ã€‚</li>\n</ol>\n</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» DIN æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ActivationUnit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> DIN</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Deep Interest Network</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        features (list): ç‰¹å¾åˆ—è¡¨ï¼Œéœ€è¦åŒºåˆ†ç›®æ ‡ç‰©å“ã€å†å²åºåˆ—å’Œå…¶ä»–ç‰¹å¾.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        history_features (list): å†å²è¡Œä¸ºåºåˆ—çš„ç‰¹å¾ååˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        target_features (list): ç›®æ ‡ç‰©å“çš„ç‰¹å¾ååˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        attention_mlp_params (dict): æ³¨æ„åŠ›å•å…ƒMLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> history_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> target_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> attention_mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ³¨æ„åŠ›å•å…ƒ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">attention_unit </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ActivationUnit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">            embedding_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get_embedding_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">            **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">attention_mlp_params</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        )</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆçš„MLP</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è¾“å…¥ç»´åº¦ = (ç›®æ ‡ç‰©å“+ä¸Šä¸‹æ–‡ç‰¹å¾) + å†å²åºåˆ—ç‰¹å¾(attentionä¹‹å)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get_mlp_input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(),</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æå–å„ç±»ç‰¹å¾çš„Embedding</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        target_item_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        history_seq_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">history_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        context_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get_context_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">())</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é€šè¿‡æ³¨æ„åŠ›å•å…ƒè®¡ç®—ç”¨æˆ·å…´è¶£å‘é‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        user_interest_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">attention_unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_item_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> history_seq_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥æ‰€æœ‰ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        mlp_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_item_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> user_interest_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> context_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h3 id=\"å¤šç›®æ ‡æ—¶ä»£-ä¸€ä¸ªæ¨¡å‹-å¤šç§ä½¿å‘½\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¤šç›®æ ‡æ—¶ä»£-ä¸€ä¸ªæ¨¡å‹-å¤šç§ä½¿å‘½\"><span>å¤šç›®æ ‡æ—¶ä»£ï¼šä¸€ä¸ªæ¨¡å‹ï¼Œå¤šç§ä½¿å‘½</span></a></h3>\n<p>åœ¨çœŸå®çš„ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¸åªå…³å¿ƒ&quot;ç‚¹å‡»ç‡&quot;ï¼Œè¿˜å…³å¿ƒ&quot;è½¬åŒ–ç‡&quot;ã€&quot;è§‚çœ‹æ—¶é•¿&quot;ã€&quot;åˆ†äº«ç‡&quot;ç­‰å¤šä¸ªæŒ‡æ ‡ã€‚<strong>å¤šä»»åŠ¡å­¦ä¹ ï¼ˆMulti-Task Learning, MTLï¼‰</strong> å°±æ˜¯ä¸ºäº†åŒæ—¶ä¼˜åŒ–è¿™äº›ç›®æ ‡è€Œç”Ÿã€‚</p>\n<h4 id=\"mmoe-å·§å¦™å¹³è¡¡å¤šä¸ªä»»åŠ¡çš„-ä¸“å®¶ç½‘ç»œ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#mmoe-å·§å¦™å¹³è¡¡å¤šä¸ªä»»åŠ¡çš„-ä¸“å®¶ç½‘ç»œ\"><span>MMoEï¼šå·§å¦™å¹³è¡¡å¤šä¸ªä»»åŠ¡çš„&quot;ä¸“å®¶ç½‘ç»œ&quot;</span></a></h4>\n<p><code v-pre>MMoE</code> (Multi-gate Mixture-of-Experts) æ˜¯Googleæå‡ºçš„ç»å…¸å¤šä»»åŠ¡å­¦ä¹ æ¡†æ¶ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä¸åŒçš„ä»»åŠ¡ä¹‹é—´ï¼Œæ—¢æœ‰å…±æ€§ï¼Œä¹Ÿæœ‰ç‰¹æ€§ã€‚å¼ºè¡Œè®©æ‰€æœ‰ä»»åŠ¡å…±äº«ä¸€ä¸ªåº•å±‚ç½‘ç»œï¼ˆShared-Bottomï¼‰å¯èƒ½ä¼šå¯¼è‡´&quot;è··è··æ¿æ•ˆåº”&quot;ï¼ˆä¸€ä¸ªä»»åŠ¡æå‡ï¼Œå¦ä¸€ä¸ªä»»åŠ¡ä¸‹é™ï¼‰ã€‚</li>\n<li><strong>ç²¾é«“</strong>ï¼š\n<ol>\n<li>è®¾ç½®å¤šä¸ª<strong>ä¸“å®¶ç½‘ç»œï¼ˆExpertsï¼‰</strong>ï¼Œæ¯ä¸ªä¸“å®¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å­ç½‘ç»œï¼Œå¯ä»¥å­¦ä¹ åˆ°æŸæ–¹é¢çš„å…±åŒçŸ¥è¯†ã€‚</li>\n<li>ä¸ºæ¯ä¸ªä»»åŠ¡è®¾ç½®ä¸€ä¸ª<strong>é—¨æ§ç½‘ç»œï¼ˆGateï¼‰</strong>ã€‚è¿™ä¸ªé—¨æ§ç½‘ç»œä¼šæ ¹æ®å½“å‰è¾“å…¥ï¼ŒåŠ¨æ€åœ°ä¸ºæ‰€æœ‰ä¸“å®¶åˆ†é…æƒé‡ã€‚</li>\n<li>æ¯ä¸ªä»»åŠ¡çš„æœ€ç»ˆè¾“å…¥ï¼Œæ˜¯æ‰€æœ‰ä¸“å®¶è¾“å‡ºçš„åŠ æƒå’Œã€‚è¿™æ ·ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥æŒ‰éœ€ã€çµæ´»åœ°ç»„åˆä¸“å®¶çš„èƒ½åŠ›ï¼Œæ—¢èƒ½å…±äº«ä¿¡æ¯ï¼Œåˆèƒ½ä¿ç•™ä¸ªæ€§ï¼Œæœ‰æ•ˆé¿å…äº†è´Ÿè¿ç§»ã€‚</li>\n</ol>\n</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» MMoE æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> MMoE</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Multi-gate Mixture-of-Experts Model</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        features (list): æ‰€æœ‰è¾“å…¥ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        task_types (list): ä»»åŠ¡ç±»å‹åˆ—è¡¨, e.g., ['binary', 'binary'].</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        n_expert (int): ä¸“å®¶æ•°é‡.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        expert_params (dict): æ¯ä¸ªä¸“å®¶ç½‘ç»œçš„MLPå‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        tower_params_list (list): æ¯ä¸ªä»»åŠ¡å¡”çš„MLPå‚æ•°åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> task_types</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> n_expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> expert_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tower_params_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_task </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> len</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">task_types</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä¸“å®¶ç½‘ç»œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">experts </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _ </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é—¨æ§ç½‘ç»œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gates </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> n_expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> bias</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _ </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_task</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä»»åŠ¡å¡”</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">towers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">tower_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tower_params </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tower_params_list</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        input_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">flatten</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">start_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä¸“å®¶è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        expert_outputs </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> expert </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">experts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        expert_outputs </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_outputs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch, n_expert, expert_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é—¨æ§å’Œä»»åŠ¡å¡”è®¡ç®—</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        outputs </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_task</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            gate_value </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gates</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">](</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">unsqueeze</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch, n_expert, 1)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # é—¨æ§åŠ æƒ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            task_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_outputs </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> gate_value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch, expert_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # ä»»åŠ¡å¡”è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            task_output </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">towers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">](</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">task_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            outputs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">task_output</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> outputs</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h2 id=\"ğŸ“–-å»¶ä¼¸é˜…è¯»\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ“–-å»¶ä¼¸é˜…è¯»\"><span>ğŸ“– <strong>å»¶ä¼¸é˜…è¯»</strong></span></a></h2>\n<ol>\n<li><a href=\"https://arxiv.org/abs/1606.07792\" target=\"_blank\" rel=\"noopener noreferrer\">Wide &amp; Deep Learning for Recommender Systems</a> - Wide&amp;Deepçš„å¼€å±±ä¹‹ä½œã€‚</li>\n<li><a href=\"https://arxiv.org/abs/1703.04247\" target=\"_blank\" rel=\"noopener noreferrer\">DeepFM: A Factorization-Machine based Neural Network for CTR Prediction</a> - DeepFMçš„ç»å…¸è®ºæ–‡ã€‚</li>\n<li><a href=\"https://arxiv.org/abs/1706.06978\" target=\"_blank\" rel=\"noopener noreferrer\">Deep Interest Network for Click-Through Rate Prediction</a> - DINçš„ç»å…¸è®ºæ–‡ï¼Œå¼€å¯äº†æ·±åº¦å…´è¶£å»ºæ¨¡çš„æ—¶ä»£ã€‚</li>\n<li><a href=\"https://dl.acm.org/doi/10.1145/3219819.3220007\" target=\"_blank\" rel=\"noopener noreferrer\">Modeling Task Relationships in Multi-task Learning with Multi-gate Mixture-of-Experts</a> - MMoEçš„ç»å…¸è®ºæ–‡ï¼Œå¤šä»»åŠ¡å­¦ä¹ çš„å¿…è¯»æ–‡çŒ®ã€‚</li>\n<li><a href=\"https://github.com/datawhalechina/torch-rechub/tree/main/torch_rechub/models/ranking\" target=\"_blank\" rel=\"noopener noreferrer\">Torch-RecHub Ranking Models</a> - Datawhaleå¼€æºçš„torch-rechubé¡¹ç›®ä¸­ï¼ŒåŒ…å«äº†å¤šç§ç»å…¸æ’åºæ¨¡å‹çš„PyTorchå®ç°ã€‚</li>\n</ol>\n<blockquote>\n<p>ğŸ§  <strong>æ€è€ƒé¢˜</strong></p>\n<ol>\n<li>\n<p>DeepFMçš„Embeddingå…±äº«æœºåˆ¶æ˜¯å…¶äº®ç‚¹ï¼Œä½†ä¹Ÿå¯èƒ½å¸¦æ¥å‚æ•°æ›´æ–°çš„å†²çªã€‚ä½ è®¤ä¸ºåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼ŒFMå’ŒDeepéƒ¨åˆ†ä½¿ç”¨ç‹¬ç«‹çš„Embeddingå¯èƒ½ä¼šæ›´å¥½ï¼Ÿ</p>\n</li>\n<li>\n<p>DCNå’ŒxDeepFMéƒ½è‡´åŠ›äºæ˜¾å¼åœ°å­¦ä¹ é«˜é˜¶ç‰¹å¾äº¤å‰ï¼Œå®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨è®¡ç®—æ•ˆç‡å’Œæ•ˆæœä¸Šå„æœ‰ä»€ä¹ˆå–èˆï¼Ÿ</p>\n</li>\n<li>\n<p>DINçš„æ³¨æ„åŠ›æœºåˆ¶æ˜¯é’ˆå¯¹&quot;ç”¨æˆ·å†å²&quot;å’Œ&quot;å€™é€‰å•†å“&quot;æ¥è®¡ç®—çš„ã€‚ä½ è¿˜èƒ½æƒ³åˆ°å“ªäº›ç‰¹å¾å¯ä»¥å¼•å…¥åˆ°è¿™ä¸ªæ³¨æ„åŠ›è®¡ç®—ä¸­ï¼Œæ¥è¿›ä¸€æ­¥æå‡æ•ˆæœï¼Ÿï¼ˆæ¯”å¦‚ï¼Œä¸Šä¸‹æ–‡ç‰¹å¾ï¼Ÿï¼‰</p>\n</li>\n<li>\n<p>MMoEä¸­çš„&quot;ä¸“å®¶&quot;æ•°é‡æ˜¯ä¸€ä¸ªè¶…å‚ï¼Œä½ è®¤ä¸ºå®ƒåº”è¯¥å¦‚ä½•è®¾ç½®ï¼Ÿæ˜¯è¶Šå¤šè¶Šå¥½å—ï¼Ÿå®ƒå’Œä»»åŠ¡çš„ç›¸å…³æ€§æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>\n</li>\n</ol>\n</blockquote>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">ğŸ‰ ç« èŠ‚å°ç»“</p>\n<p>æ·±åº¦æ’åºæ¨¡å‹çš„æ¼”è¿›å†ç¨‹å±•ç°äº†æ¨èç³»ç»Ÿä»&quot;æ‰‹å·¥ç‚¼ä¸¹&quot;åˆ°&quot;è‡ªåŠ¨é©¾é©¶&quot;çš„åä¸½è½¬èº«ã€‚Wide&amp;Deepå¥ å®šäº†è®°å¿†ä¸æ³›åŒ–å¹¶é‡çš„åŸºç¡€èŒƒå¼ï¼ŒDeepFMå®ç°äº†ç‰¹å¾äº¤å‰çš„è‡ªåŠ¨åŒ–çªç ´ï¼ŒDINå¼•å…¥æ³¨æ„åŠ›æœºåˆ¶æ•è·åŠ¨æ€å…´è¶£ï¼ŒMMoEå°†å•ä¸€ç›®æ ‡æ‰©å±•ä¸ºå¤šä»»åŠ¡ååŒä¼˜åŒ–ã€‚æ¯ä¸€æ¬¡æ¨¡å‹åˆ›æ–°ï¼Œéƒ½æ˜¯å¯¹ç”¨æˆ·å¤æ‚åå¥½çš„æ›´æ·±å±‚ç†è§£ï¼Œä¹Ÿæ˜¯å¯¹æ¨èç²¾åº¦æé™çš„ä¸æ‡ˆè¿½æ±‚ã€‚æŒæ¡è¿™äº›æ¨¡å‹çš„ç²¾é«“ï¼Œå°±æ˜¯æŒæ¡äº†åœ¨æ¨èç³»ç»Ÿ&quot;æœ€åä¸€å…¬é‡Œ&quot;ä¸­ç²¾é›•ç»†ç¢çš„è‰ºæœ¯ã€‚</p>\n</div>\n<hr>\n<blockquote>\n<p>&quot;The devil is in the details.&quot; â€”â€” Ludwig Mies van der Rohe<br>\nåœ¨æ’åºæ¨¡å‹çš„ä¸–ç•Œé‡Œï¼Œé­”é¬¼è—åœ¨ç»†èŠ‚ä¸­ï¼Œè€Œå¤©ä½¿ä¹Ÿåœ¨ç»†èŠ‚ä¸­è¯ç”Ÿã€‚</p>\n</blockquote>\n","env":{"base":"/search-rec-ads-cosmos-explorer/","filePath":"D:/softwore/user/git/work_code/WeBotDoc/docs/zh/3.ç¬¬ä¸‰ç« ï¼šæ¨èç®—æ³•--æ¯”ä½ æ›´æ‡‚ä½ çš„è´´å¿ƒå°æ£‰è¢„/2.æ·±åº¦å­¦ä¹ æ–‡è‰ºå¤å…´/5.ranking_models.md","filePathRelative":"zh/3.ç¬¬ä¸‰ç« ï¼šæ¨èç®—æ³•--æ¯”ä½ æ›´æ‡‚ä½ çš„è´´å¿ƒå°æ£‰è¢„/2.æ·±åº¦å­¦ä¹ æ–‡è‰ºå¤å…´/5.ranking_models.md","frontmatter":{"title":"æ·±åº¦æ’åºæ¨¡å‹ï¼šç²¾è°ƒæµé‡çš„\"ç‚¼é‡‘æœ¯\"","createTime":"2025/06/13 14:00"},"sfcBlocks":{"template":{"type":"template","content":"<template><p>å¦‚æœè¯´å¬å›æ˜¯ä»äº¿ä¸‡ç‰©æ–™ä¸­&quot;å¤§æµ·æé’ˆ&quot;ï¼Œé‚£ä¹ˆ<strong>æ’åºï¼ˆRankingï¼‰</strong> å°±æ˜¯åœ¨è¿™å‡ ç™¾æ ¹&quot;é’ˆ&quot;é‡Œæ‰¾å‡ºæœ€äº®çš„é‚£ä¸€æ ¹ã€‚å®ƒæ˜¯æ¨èæµç¨‹çš„&quot;æœ€åä¸€å…¬é‡Œ&quot;ï¼Œè´Ÿè´£å¯¹å¬å›çš„å€™é€‰é›†è¿›è¡Œç²¾å‡†æ‰“åˆ†ï¼Œé¢„æµ‹ç”¨æˆ·å¯¹æ¯ä¸ªç‰©å“çš„åå¥½ç¨‹åº¦ï¼ˆå¦‚ç‚¹å‡»ç‡pCTRã€è½¬åŒ–ç‡pCVRï¼‰ï¼Œç„¶åæŒ‰åˆ†å€¼é«˜ä½å‘ˆç°ç»™ç”¨æˆ·ã€‚</p>\n<p>æ’åºæ¨¡å‹çš„å¥½åï¼Œç›´æ¥å†³å®šäº†ç”¨æˆ·çš„æœ€ç»ˆä½“éªŒå’Œå¹³å°çš„å•†ä¸šç›®æ ‡ã€‚è¿™æ˜¯ä¸€ä¸ªäºç»†å¾®å¤„è§çœŸç« çš„&quot;ç‚¼é‡‘&quot;è¿‡ç¨‹ï¼Œæ¨¡å‹çš„æ¯ä¸€æ¬¡å¾®å°è¿­ä»£ï¼Œéƒ½å¯èƒ½å¸¦æ¥å·¨å¤§çš„æ”¶ç›Šã€‚</p>\n<h2 id=\"ğŸ›ï¸-æ¨¡å‹æ¼”è¿›ä¹‹è·¯-ä»åˆ†ç«‹åˆ°èåˆ-ä»äººå·¥åˆ°è‡ªåŠ¨\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ›ï¸-æ¨¡å‹æ¼”è¿›ä¹‹è·¯-ä»åˆ†ç«‹åˆ°èåˆ-ä»äººå·¥åˆ°è‡ªåŠ¨\"><span>ğŸ›ï¸ æ¨¡å‹æ¼”è¿›ä¹‹è·¯ï¼šä»åˆ†ç«‹åˆ°èåˆï¼Œä»äººå·¥åˆ°è‡ªåŠ¨</span></a></h2>\n<p>æ·±åº¦æ’åºæ¨¡å‹çš„æ¼”è¿›ï¼Œæ˜¯ä¸€éƒ¨è¿½æ±‚&quot;æ›´é«˜ã€æ›´å¿«ã€æ›´å¼º&quot;çš„ç‰¹å¾å·¥ç¨‹ä¸æ¨¡å‹ç»“æ„åˆ›æ–°å²ã€‚</p>\n<h3 id=\"å¥ åŸºæ—¶ä»£-wide-deep-â€”â€”-è®°å¿†-ä¸-æ³›åŒ–-çš„é¦–æ¬¡è”å§»\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¥ åŸºæ—¶ä»£-wide-deep-â€”â€”-è®°å¿†-ä¸-æ³›åŒ–-çš„é¦–æ¬¡è”å§»\"><span>å¥ åŸºæ—¶ä»£ï¼šWide &amp; Deep â€”â€” &quot;è®°å¿†&quot;ä¸&quot;æ³›åŒ–&quot;çš„é¦–æ¬¡è”å§»</span></a></h3>\n<p>Googleåœ¨2016å¹´æå‡ºçš„ <code v-pre>Wide &amp; Deep</code> æ¨¡å‹ï¼Œæ˜¯æ·±åº¦å­¦ä¹ åœ¨æ¨èé¢†åŸŸé‡Œç¨‹ç¢‘å¼çš„ä½œå“ï¼Œå®ƒå¥ å®šäº†ç°ä»£æ’åºæ¨¡å‹çš„åŸºæœ¬èŒƒå¼ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä»»ä½•æ¨èåœºæ™¯éƒ½ç¦»ä¸å¼€&quot;è®°å¿†&quot;ï¼ˆMemorizationï¼‰å’Œ&quot;æ³›åŒ–&quot;ï¼ˆGeneralizationï¼‰ã€‚\n<ul>\n<li><strong>Wideéƒ¨åˆ†ï¼ˆè®°å¿†ï¼‰</strong>ï¼šä¸€ä¸ªå¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼Œè´Ÿè´£è®°å¿†é‚£äº›é¢‘ç¹å…±ç°çš„ã€é‡è¦çš„äº¤å‰ç‰¹å¾ï¼Œæ¯”å¦‚&quot;ç”¨æˆ·çˆ±å–æ‹¿é“ &amp; åŸå¸‚æ˜¯ä¸Šæµ·&quot;ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•ã€å¯è§£é‡Šæ€§å¼ºã€‚</li>\n<li><strong>Deepéƒ¨åˆ†ï¼ˆæ³›åŒ–ï¼‰</strong>ï¼šä¸€ä¸ªæ ‡å‡†çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆDNNï¼‰ï¼Œè´Ÿè´£å°†ç¨€ç–ç‰¹å¾åµŒå…¥åˆ°ä½ç»´ç¨ å¯†ç©ºé—´ï¼Œå­¦ä¹ é‚£äº›ä»æœªæˆ–å¾ˆå°‘å‡ºç°çš„ç‰¹å¾ç»„åˆï¼Œæ¢ç´¢æœªçŸ¥çš„å¯èƒ½æ€§ã€‚</li>\n</ul>\n</li>\n<li><strong>ç²¾é«“</strong>ï¼šå°†ä¸¤è€…è”åˆè®­ç»ƒï¼Œè®©æ¨¡å‹åŒæ—¶å…·å¤‡è®°ä½&quot;å†å²ç»éªŒ&quot;å’Œæ¢ç´¢&quot;æ–°é²œäº‹ç‰©&quot;çš„èƒ½åŠ›ã€‚</li>\n</ul>\n<Mermaid id=\"mermaid-42\" code=\"eJxLL0osyFAIceFSAILi0iQIXyk8MyVVISCxqEQJLAECKZlFqcklmfl5Cj5BcMHweDfXaLDqJ/uWP+/c+XRfo01Skb7d02VNT3YtedrfCRFTilXQ1bUDqvbxjVZ6unP/k52dz3ftf9aw/NmKhU/ndSvFgg1MzUvhQnOHS2pqATHucAG7A6Qawx2eLs837tZReLpxHtA+IBPqFpd419ykaCUgkZqSkpmX/nRjE1zGxc8PaJifH7q7QO4HKwkuzQULgJXCRcBCQEa0Uow21Cz/0pKC0pJopeDM9Nz8zJQX+yY/bd8FNJYLAEu4hSM=\"></Mermaid><details class=\"hint-container details\"><summary>ğŸ’» Wide&amp;Deep æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> WideDeep</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Wide &#x26; Deep Model</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        wide_features (list): Wideä¾§çš„ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        deep_features (list): Deepä¾§çš„ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> wide_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Wideéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆè¾“å‡ºå±‚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            x (dict): è¾“å…¥ç‰¹å¾, a dictionary with keys being feature names.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Wideä¾§é€»è¾‘</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        wide_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, wide_embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepä¾§é€»è¾‘</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, deep_embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_output </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, mlp_output_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥Wideå’ŒDeepçš„è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        concat_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_output</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">concat_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h3 id=\"äº¤å‰æ—¶ä»£-å‘Šåˆ«-äººå·¥ç‚¼ä¸¹-æ‹¥æŠ±-è‡ªåŠ¨é©¾é©¶\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#äº¤å‰æ—¶ä»£-å‘Šåˆ«-äººå·¥ç‚¼ä¸¹-æ‹¥æŠ±-è‡ªåŠ¨é©¾é©¶\"><span>äº¤å‰æ—¶ä»£ï¼šå‘Šåˆ«&quot;äººå·¥ç‚¼ä¸¹&quot;ï¼Œæ‹¥æŠ±&quot;è‡ªåŠ¨é©¾é©¶&quot;</span></a></h3>\n<p><code v-pre>Wide &amp; Deep</code> çš„ä¸€ä¸ªç—›ç‚¹æ˜¯ï¼ŒWideéƒ¨åˆ†çš„äº¤å‰ç‰¹å¾ä»ç„¶éœ€è¦å¤§é‡çš„äººå·¥è®¾è®¡å’Œç­›é€‰ï¼Œè¿™æ˜¯ä¸€é¡¹ç¹çä¸”ç»éªŒä¾èµ–çš„&quot;ç‚¼ä¸¹&quot;å·¥ä½œã€‚äºæ˜¯ï¼Œä¸€ç³»åˆ—èƒ½<strong>è‡ªåŠ¨å­¦ä¹ ç‰¹å¾äº¤å‰</strong>çš„æ¨¡å‹åº”è¿è€Œç”Ÿã€‚</p>\n<h4 id=\"deepfm-fmä¸dnnçš„ç è”ç’§åˆ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#deepfm-fmä¸dnnçš„ç è”ç’§åˆ\"><span>DeepFMï¼šFMä¸DNNçš„ç è”ç’§åˆ</span></a></h4>\n<p><code v-pre>DeepFM</code> æ˜¯è¿™ä¸ªæ—¶ä»£æœ€è€€çœ¼çš„æ˜æ˜Ÿï¼Œè‡³ä»Šä»æ˜¯è®¸å¤šå…¬å¸çº¿ä¸Šæ¨¡å‹çš„ä¸»åŠ›ã€‚å®ƒå·§å¦™åœ°å°†å› å­åˆ†è§£æœºï¼ˆFMï¼‰å’ŒDNNç»“åˆåœ¨äº†ä¸€ä¸ªæ¡†æ¶ä¸­ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š\n<ul>\n<li><strong>FMéƒ¨åˆ†</strong>ï¼šä¸Wideéƒ¨åˆ†ç±»ä¼¼ï¼Œä½†å®ƒèƒ½è‡ªåŠ¨å­¦ä¹ æ‰€æœ‰ç‰¹å¾ä¹‹é—´çš„äºŒé˜¶äº¤å‰ï¼Œæ— éœ€äººå·¥æŒ‡å®šã€‚</li>\n<li><strong>Deepéƒ¨åˆ†</strong>ï¼šä¸<code v-pre>Wide &amp; Deep</code>ä¸­çš„Deepéƒ¨åˆ†ä¸€è‡´ï¼Œå­¦ä¹ é«˜é˜¶äº¤å‰ç‰¹å¾ã€‚</li>\n</ul>\n</li>\n<li><strong>ç²¾é«“</strong>ï¼šFMéƒ¨åˆ†å’ŒDeepéƒ¨åˆ†çš„è¾“å…¥Embeddingæ˜¯<strong>å…±äº«</strong>çš„ï¼è¿™å¸¦æ¥äº†ä¸¤å¤§å¥½å¤„ï¼š\n<ol>\n<li>æ¨¡å‹æ›´å°ï¼Œè®­ç»ƒæ›´å¿«ã€‚</li>\n<li>Embeddingå±‚èƒ½è¢«ä½é˜¶å’Œé«˜é˜¶äº¤å‰ä¿¡å·åŒæ—¶è®­ç»ƒï¼Œå­¦ä¹ æ›´å……åˆ†ã€‚</li>\n</ol>\n</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» DeepFM æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> FM</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> DeepFM</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    DeepFM Model</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        deep_features (list): ç”¨äºDeepå’ŒFMéƒ¨åˆ†çš„ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # DeepFMä¸­ï¼Œæ‰€æœ‰ç‰¹å¾éƒ½ç”¨äºDeepå’ŒFMéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # FMéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fm </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> FM</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">reduce_sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆè¾“å‡ºå±‚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # 1 (æ¥è‡ªFM) + mlp_output_dim (æ¥è‡ªDeep)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            x (dict): è¾“å…¥ç‰¹å¾å­—å…¸.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è·å–æ‰€æœ‰ç‰¹å¾çš„Embedding</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        embed_x </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, n_fields, embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # FMéƒ¨åˆ†è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        fm_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, 1)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†è¾“å…¥éœ€è¦å°†Embeddingå±•å¹³</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">flatten</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">start_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, n_fields * embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, mlp_output_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥FMå’ŒDeepçš„è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        concat_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fm_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">concat_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h4 id=\"dcn-v2-æ›´å¼ºå¤§çš„æ˜¾å¼äº¤å‰ç½‘ç»œ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#dcn-v2-æ›´å¼ºå¤§çš„æ˜¾å¼äº¤å‰ç½‘ç»œ\"><span>DCN V2ï¼šæ›´å¼ºå¤§çš„æ˜¾å¼äº¤å‰ç½‘ç»œ</span></a></h4>\n<p><code v-pre>DCN</code> (Deep &amp; Cross Network) æä¾›äº†å¦ä¸€ç§æ˜¾å¼å­¦ä¹ ç‰¹å¾äº¤å‰çš„æ€è·¯ã€‚å®ƒè®¾è®¡çš„<code v-pre>Cross Network</code>å¯ä»¥åœ¨æ¯ä¸€å±‚éƒ½ä¿ç•™ä¹‹å‰æ‰€æœ‰å±‚çš„äº¤å‰ç»“æœï¼Œå¹¶ä¸åŸå§‹è¾“å…¥è¿›è¡Œæ–°ä¸€è½®çš„äº¤å‰ã€‚<code v-pre>DCN V2</code> æ˜¯å…¶æ”¹è¿›ç‰ˆï¼Œç»“æ„æ›´ç¨³å®šï¼Œè¡¨ç°æ›´ä¼˜ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š\n<ul>\n<li><strong>Crosséƒ¨åˆ†</strong>ï¼šç”¨ä¸€ä¸ªç‰¹å®šçš„ç½‘ç»œç»“æ„ï¼Œåœ¨æ¯ä¸€å±‚éƒ½æ˜¾å¼åœ°ã€è‡ªåŠ¨åœ°è¿›è¡Œç‰¹å¾äº¤å‰ï¼Œäº¤å‰çš„é˜¶æ•°ç”±ç½‘ç»œæ·±åº¦å†³å®šã€‚</li>\n<li><strong>Deepéƒ¨åˆ†</strong>ï¼šä¸€ä¸ªæ ‡å‡†çš„DNNï¼Œä¸Crosséƒ¨åˆ†å¹¶è¡Œã€‚</li>\n</ul>\n</li>\n<li><strong>ç²¾é«“</strong>ï¼šç›¸æ¯”äºFMåªèƒ½åšäºŒé˜¶äº¤å‰ï¼ŒCrossç½‘ç»œèƒ½ä»¥ä¸€ç§é«˜æ•ˆä¸”æœ‰ç•Œçš„æ–¹å¼ï¼Œå­¦ä¹ æ›´é«˜é˜¶çš„äº¤å‰ç‰¹å¾ã€‚</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» DCN V2 æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CrossNetworkV2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> DCNv2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Deep &#x26; Cross Network V2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        features (list): æ‰€æœ‰ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        cross_layer_num (int): Crossç½‘ç»œçš„å±‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> cross_layer_num</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Crosséƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cross_net </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CrossNetworkV2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> cross_layer_num</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥Crosså’ŒDeepçš„è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        embed_x </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">flatten</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">start_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, n_fields * embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Crosséƒ¨åˆ†è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        cross_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cross_net</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        concat_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cross_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">concat_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h3 id=\"æ³¨æ„åŠ›æ—¶ä»£-è®©æ¨¡å‹çŸ¥é“è¯¥-çœ‹-å“ªé‡Œ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ³¨æ„åŠ›æ—¶ä»£-è®©æ¨¡å‹çŸ¥é“è¯¥-çœ‹-å“ªé‡Œ\"><span>æ³¨æ„åŠ›æ—¶ä»£ï¼šè®©æ¨¡å‹çŸ¥é“è¯¥&quot;çœ‹&quot;å“ªé‡Œ</span></a></h3>\n<p>ä¹‹å‰çš„æ¨¡å‹åœ¨å¤„ç†ç”¨æˆ·å†å²è¡Œä¸ºæ—¶ï¼Œé€šå¸¸æ˜¯å°†æ‰€æœ‰è¡Œä¸ºçš„Embeddingåšç®€å•çš„Poolingï¼ˆå¦‚Sum/Averageï¼‰ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„â€”â€”ç”¨æˆ·çœ‹è¿‡çš„100ä¸ªè§†é¢‘ï¼Œè·Ÿå½“å‰è¦æ¨èçš„&quot;è·‘é‹&quot;å¹¿å‘Šï¼Œç›¸å…³æ€§å¿…ç„¶æœ‰é«˜æœ‰ä½ã€‚<strong>æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttentionï¼‰</strong> çš„å¼•å…¥ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>\n<h4 id=\"din-ä¸ºç”¨æˆ·å…´è¶£åŠ¨æ€-èšç„¦\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#din-ä¸ºç”¨æˆ·å…´è¶£åŠ¨æ€-èšç„¦\"><span>DINï¼šä¸ºç”¨æˆ·å…´è¶£åŠ¨æ€&quot;èšç„¦&quot;</span></a></h4>\n<p><code v-pre>DIN</code> (Deep Interest Network) æ˜¯é˜¿é‡Œæå‡ºçš„ã€åœ¨å·¥ä¸šç•Œå½±å“æ·±è¿œçš„æ¨¡å‹ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šç”¨æˆ·çš„å…´è¶£æ˜¯å¤šæ ·çš„ï¼Œå¹¶ä¸”åœ¨é¢å¯¹ä¸åŒçš„å€™é€‰å•†å“æ—¶ï¼Œç›¸å…³çš„å…´è¶£ç‚¹ä¹Ÿä¸åŒã€‚</li>\n<li><strong>ç²¾é«“</strong>ï¼š\n<ol>\n<li>ä¸å†å¯¹ç”¨æˆ·å†å²è¡Œä¸ºåšç®€å•çš„Poolingã€‚</li>\n<li>å¼•å…¥ä¸€ä¸ª&quot;æ³¨æ„åŠ›å•å…ƒ&quot;ï¼Œå°†<strong>å€™é€‰å•†å“</strong>ï¼ˆTarget Adï¼‰ä½œä¸ºæŸ¥è¯¢ï¼ˆQueryï¼‰ï¼Œå»åŠ¨æ€åœ°è®¡ç®—ç”¨æˆ·å†å²è¡Œä¸ºåºåˆ—ä¸­æ¯ä¸ªè¡Œä¸ºçš„&quot;æ³¨æ„åŠ›å¾—åˆ†&quot;ã€‚</li>\n<li>å¯¹å†å²è¡Œä¸ºçš„EmbeddingåšåŠ æƒæ±‚å’Œï¼Œæƒé‡å°±æ˜¯æ³¨æ„åŠ›å¾—åˆ†ã€‚è¿™æ ·ï¼Œä¸å½“å‰å€™é€‰å•†å“è¶Šç›¸å…³çš„å†å²è¡Œä¸ºï¼Œæƒé‡å°±è¶Šé«˜ã€‚</li>\n<li>æœ€åï¼Œå°†è¿™ä¸ª&quot;èšç„¦&quot;åçš„ç”¨æˆ·å…´è¶£å‘é‡ï¼Œä¸å…¶ä»–ç‰¹å¾ä¸€èµ·é€å…¥DNNè¿›è¡Œé¢„æµ‹ã€‚</li>\n</ol>\n</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» DIN æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ActivationUnit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> DIN</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Deep Interest Network</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        features (list): ç‰¹å¾åˆ—è¡¨ï¼Œéœ€è¦åŒºåˆ†ç›®æ ‡ç‰©å“ã€å†å²åºåˆ—å’Œå…¶ä»–ç‰¹å¾.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        history_features (list): å†å²è¡Œä¸ºåºåˆ—çš„ç‰¹å¾ååˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        target_features (list): ç›®æ ‡ç‰©å“çš„ç‰¹å¾ååˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        attention_mlp_params (dict): æ³¨æ„åŠ›å•å…ƒMLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> history_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> target_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> attention_mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ³¨æ„åŠ›å•å…ƒ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">attention_unit </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ActivationUnit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">            embedding_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get_embedding_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">            **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">attention_mlp_params</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        )</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆçš„MLP</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è¾“å…¥ç»´åº¦ = (ç›®æ ‡ç‰©å“+ä¸Šä¸‹æ–‡ç‰¹å¾) + å†å²åºåˆ—ç‰¹å¾(attentionä¹‹å)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get_mlp_input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(),</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æå–å„ç±»ç‰¹å¾çš„Embedding</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        target_item_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        history_seq_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">history_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        context_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get_context_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">())</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é€šè¿‡æ³¨æ„åŠ›å•å…ƒè®¡ç®—ç”¨æˆ·å…´è¶£å‘é‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        user_interest_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">attention_unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_item_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> history_seq_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥æ‰€æœ‰ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        mlp_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_item_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> user_interest_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> context_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h3 id=\"å¤šç›®æ ‡æ—¶ä»£-ä¸€ä¸ªæ¨¡å‹-å¤šç§ä½¿å‘½\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¤šç›®æ ‡æ—¶ä»£-ä¸€ä¸ªæ¨¡å‹-å¤šç§ä½¿å‘½\"><span>å¤šç›®æ ‡æ—¶ä»£ï¼šä¸€ä¸ªæ¨¡å‹ï¼Œå¤šç§ä½¿å‘½</span></a></h3>\n<p>åœ¨çœŸå®çš„ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¸åªå…³å¿ƒ&quot;ç‚¹å‡»ç‡&quot;ï¼Œè¿˜å…³å¿ƒ&quot;è½¬åŒ–ç‡&quot;ã€&quot;è§‚çœ‹æ—¶é•¿&quot;ã€&quot;åˆ†äº«ç‡&quot;ç­‰å¤šä¸ªæŒ‡æ ‡ã€‚<strong>å¤šä»»åŠ¡å­¦ä¹ ï¼ˆMulti-Task Learning, MTLï¼‰</strong> å°±æ˜¯ä¸ºäº†åŒæ—¶ä¼˜åŒ–è¿™äº›ç›®æ ‡è€Œç”Ÿã€‚</p>\n<h4 id=\"mmoe-å·§å¦™å¹³è¡¡å¤šä¸ªä»»åŠ¡çš„-ä¸“å®¶ç½‘ç»œ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#mmoe-å·§å¦™å¹³è¡¡å¤šä¸ªä»»åŠ¡çš„-ä¸“å®¶ç½‘ç»œ\"><span>MMoEï¼šå·§å¦™å¹³è¡¡å¤šä¸ªä»»åŠ¡çš„&quot;ä¸“å®¶ç½‘ç»œ&quot;</span></a></h4>\n<p><code v-pre>MMoE</code> (Multi-gate Mixture-of-Experts) æ˜¯Googleæå‡ºçš„ç»å…¸å¤šä»»åŠ¡å­¦ä¹ æ¡†æ¶ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä¸åŒçš„ä»»åŠ¡ä¹‹é—´ï¼Œæ—¢æœ‰å…±æ€§ï¼Œä¹Ÿæœ‰ç‰¹æ€§ã€‚å¼ºè¡Œè®©æ‰€æœ‰ä»»åŠ¡å…±äº«ä¸€ä¸ªåº•å±‚ç½‘ç»œï¼ˆShared-Bottomï¼‰å¯èƒ½ä¼šå¯¼è‡´&quot;è··è··æ¿æ•ˆåº”&quot;ï¼ˆä¸€ä¸ªä»»åŠ¡æå‡ï¼Œå¦ä¸€ä¸ªä»»åŠ¡ä¸‹é™ï¼‰ã€‚</li>\n<li><strong>ç²¾é«“</strong>ï¼š\n<ol>\n<li>è®¾ç½®å¤šä¸ª<strong>ä¸“å®¶ç½‘ç»œï¼ˆExpertsï¼‰</strong>ï¼Œæ¯ä¸ªä¸“å®¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å­ç½‘ç»œï¼Œå¯ä»¥å­¦ä¹ åˆ°æŸæ–¹é¢çš„å…±åŒçŸ¥è¯†ã€‚</li>\n<li>ä¸ºæ¯ä¸ªä»»åŠ¡è®¾ç½®ä¸€ä¸ª<strong>é—¨æ§ç½‘ç»œï¼ˆGateï¼‰</strong>ã€‚è¿™ä¸ªé—¨æ§ç½‘ç»œä¼šæ ¹æ®å½“å‰è¾“å…¥ï¼ŒåŠ¨æ€åœ°ä¸ºæ‰€æœ‰ä¸“å®¶åˆ†é…æƒé‡ã€‚</li>\n<li>æ¯ä¸ªä»»åŠ¡çš„æœ€ç»ˆè¾“å…¥ï¼Œæ˜¯æ‰€æœ‰ä¸“å®¶è¾“å‡ºçš„åŠ æƒå’Œã€‚è¿™æ ·ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥æŒ‰éœ€ã€çµæ´»åœ°ç»„åˆä¸“å®¶çš„èƒ½åŠ›ï¼Œæ—¢èƒ½å…±äº«ä¿¡æ¯ï¼Œåˆèƒ½ä¿ç•™ä¸ªæ€§ï¼Œæœ‰æ•ˆé¿å…äº†è´Ÿè¿ç§»ã€‚</li>\n</ol>\n</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» MMoE æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> MMoE</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Multi-gate Mixture-of-Experts Model</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        features (list): æ‰€æœ‰è¾“å…¥ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        task_types (list): ä»»åŠ¡ç±»å‹åˆ—è¡¨, e.g., ['binary', 'binary'].</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        n_expert (int): ä¸“å®¶æ•°é‡.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        expert_params (dict): æ¯ä¸ªä¸“å®¶ç½‘ç»œçš„MLPå‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        tower_params_list (list): æ¯ä¸ªä»»åŠ¡å¡”çš„MLPå‚æ•°åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> task_types</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> n_expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> expert_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tower_params_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_task </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> len</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">task_types</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä¸“å®¶ç½‘ç»œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">experts </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _ </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é—¨æ§ç½‘ç»œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gates </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> n_expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> bias</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _ </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_task</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä»»åŠ¡å¡”</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">towers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">tower_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tower_params </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tower_params_list</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        input_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">flatten</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">start_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä¸“å®¶è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        expert_outputs </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> expert </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">experts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        expert_outputs </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_outputs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch, n_expert, expert_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é—¨æ§å’Œä»»åŠ¡å¡”è®¡ç®—</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        outputs </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_task</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            gate_value </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gates</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">](</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">unsqueeze</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch, n_expert, 1)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # é—¨æ§åŠ æƒ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            task_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_outputs </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> gate_value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch, expert_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # ä»»åŠ¡å¡”è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            task_output </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">towers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">](</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">task_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            outputs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">task_output</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> outputs</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h2 id=\"ğŸ“–-å»¶ä¼¸é˜…è¯»\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ“–-å»¶ä¼¸é˜…è¯»\"><span>ğŸ“– <strong>å»¶ä¼¸é˜…è¯»</strong></span></a></h2>\n<ol>\n<li><a href=\"https://arxiv.org/abs/1606.07792\" target=\"_blank\" rel=\"noopener noreferrer\">Wide &amp; Deep Learning for Recommender Systems</a> - Wide&amp;Deepçš„å¼€å±±ä¹‹ä½œã€‚</li>\n<li><a href=\"https://arxiv.org/abs/1703.04247\" target=\"_blank\" rel=\"noopener noreferrer\">DeepFM: A Factorization-Machine based Neural Network for CTR Prediction</a> - DeepFMçš„ç»å…¸è®ºæ–‡ã€‚</li>\n<li><a href=\"https://arxiv.org/abs/1706.06978\" target=\"_blank\" rel=\"noopener noreferrer\">Deep Interest Network for Click-Through Rate Prediction</a> - DINçš„ç»å…¸è®ºæ–‡ï¼Œå¼€å¯äº†æ·±åº¦å…´è¶£å»ºæ¨¡çš„æ—¶ä»£ã€‚</li>\n<li><a href=\"https://dl.acm.org/doi/10.1145/3219819.3220007\" target=\"_blank\" rel=\"noopener noreferrer\">Modeling Task Relationships in Multi-task Learning with Multi-gate Mixture-of-Experts</a> - MMoEçš„ç»å…¸è®ºæ–‡ï¼Œå¤šä»»åŠ¡å­¦ä¹ çš„å¿…è¯»æ–‡çŒ®ã€‚</li>\n<li><a href=\"https://github.com/datawhalechina/torch-rechub/tree/main/torch_rechub/models/ranking\" target=\"_blank\" rel=\"noopener noreferrer\">Torch-RecHub Ranking Models</a> - Datawhaleå¼€æºçš„torch-rechubé¡¹ç›®ä¸­ï¼ŒåŒ…å«äº†å¤šç§ç»å…¸æ’åºæ¨¡å‹çš„PyTorchå®ç°ã€‚</li>\n</ol>\n<blockquote>\n<p>ğŸ§  <strong>æ€è€ƒé¢˜</strong></p>\n<ol>\n<li>\n<p>DeepFMçš„Embeddingå…±äº«æœºåˆ¶æ˜¯å…¶äº®ç‚¹ï¼Œä½†ä¹Ÿå¯èƒ½å¸¦æ¥å‚æ•°æ›´æ–°çš„å†²çªã€‚ä½ è®¤ä¸ºåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼ŒFMå’ŒDeepéƒ¨åˆ†ä½¿ç”¨ç‹¬ç«‹çš„Embeddingå¯èƒ½ä¼šæ›´å¥½ï¼Ÿ</p>\n</li>\n<li>\n<p>DCNå’ŒxDeepFMéƒ½è‡´åŠ›äºæ˜¾å¼åœ°å­¦ä¹ é«˜é˜¶ç‰¹å¾äº¤å‰ï¼Œå®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨è®¡ç®—æ•ˆç‡å’Œæ•ˆæœä¸Šå„æœ‰ä»€ä¹ˆå–èˆï¼Ÿ</p>\n</li>\n<li>\n<p>DINçš„æ³¨æ„åŠ›æœºåˆ¶æ˜¯é’ˆå¯¹&quot;ç”¨æˆ·å†å²&quot;å’Œ&quot;å€™é€‰å•†å“&quot;æ¥è®¡ç®—çš„ã€‚ä½ è¿˜èƒ½æƒ³åˆ°å“ªäº›ç‰¹å¾å¯ä»¥å¼•å…¥åˆ°è¿™ä¸ªæ³¨æ„åŠ›è®¡ç®—ä¸­ï¼Œæ¥è¿›ä¸€æ­¥æå‡æ•ˆæœï¼Ÿï¼ˆæ¯”å¦‚ï¼Œä¸Šä¸‹æ–‡ç‰¹å¾ï¼Ÿï¼‰</p>\n</li>\n<li>\n<p>MMoEä¸­çš„&quot;ä¸“å®¶&quot;æ•°é‡æ˜¯ä¸€ä¸ªè¶…å‚ï¼Œä½ è®¤ä¸ºå®ƒåº”è¯¥å¦‚ä½•è®¾ç½®ï¼Ÿæ˜¯è¶Šå¤šè¶Šå¥½å—ï¼Ÿå®ƒå’Œä»»åŠ¡çš„ç›¸å…³æ€§æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>\n</li>\n</ol>\n</blockquote>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">ğŸ‰ ç« èŠ‚å°ç»“</p>\n<p>æ·±åº¦æ’åºæ¨¡å‹çš„æ¼”è¿›å†ç¨‹å±•ç°äº†æ¨èç³»ç»Ÿä»&quot;æ‰‹å·¥ç‚¼ä¸¹&quot;åˆ°&quot;è‡ªåŠ¨é©¾é©¶&quot;çš„åä¸½è½¬èº«ã€‚Wide&amp;Deepå¥ å®šäº†è®°å¿†ä¸æ³›åŒ–å¹¶é‡çš„åŸºç¡€èŒƒå¼ï¼ŒDeepFMå®ç°äº†ç‰¹å¾äº¤å‰çš„è‡ªåŠ¨åŒ–çªç ´ï¼ŒDINå¼•å…¥æ³¨æ„åŠ›æœºåˆ¶æ•è·åŠ¨æ€å…´è¶£ï¼ŒMMoEå°†å•ä¸€ç›®æ ‡æ‰©å±•ä¸ºå¤šä»»åŠ¡ååŒä¼˜åŒ–ã€‚æ¯ä¸€æ¬¡æ¨¡å‹åˆ›æ–°ï¼Œéƒ½æ˜¯å¯¹ç”¨æˆ·å¤æ‚åå¥½çš„æ›´æ·±å±‚ç†è§£ï¼Œä¹Ÿæ˜¯å¯¹æ¨èç²¾åº¦æé™çš„ä¸æ‡ˆè¿½æ±‚ã€‚æŒæ¡è¿™äº›æ¨¡å‹çš„ç²¾é«“ï¼Œå°±æ˜¯æŒæ¡äº†åœ¨æ¨èç³»ç»Ÿ&quot;æœ€åä¸€å…¬é‡Œ&quot;ä¸­ç²¾é›•ç»†ç¢çš„è‰ºæœ¯ã€‚</p>\n</div>\n<hr>\n<blockquote>\n<p>&quot;The devil is in the details.&quot; â€”â€” Ludwig Mies van der Rohe<br>\nåœ¨æ’åºæ¨¡å‹çš„ä¸–ç•Œé‡Œï¼Œé­”é¬¼è—åœ¨ç»†èŠ‚ä¸­ï¼Œè€Œå¤©ä½¿ä¹Ÿåœ¨ç»†èŠ‚ä¸­è¯ç”Ÿã€‚</p>\n</blockquote>\n</template>","contentStripped":"<p>å¦‚æœè¯´å¬å›æ˜¯ä»äº¿ä¸‡ç‰©æ–™ä¸­&quot;å¤§æµ·æé’ˆ&quot;ï¼Œé‚£ä¹ˆ<strong>æ’åºï¼ˆRankingï¼‰</strong> å°±æ˜¯åœ¨è¿™å‡ ç™¾æ ¹&quot;é’ˆ&quot;é‡Œæ‰¾å‡ºæœ€äº®çš„é‚£ä¸€æ ¹ã€‚å®ƒæ˜¯æ¨èæµç¨‹çš„&quot;æœ€åä¸€å…¬é‡Œ&quot;ï¼Œè´Ÿè´£å¯¹å¬å›çš„å€™é€‰é›†è¿›è¡Œç²¾å‡†æ‰“åˆ†ï¼Œé¢„æµ‹ç”¨æˆ·å¯¹æ¯ä¸ªç‰©å“çš„åå¥½ç¨‹åº¦ï¼ˆå¦‚ç‚¹å‡»ç‡pCTRã€è½¬åŒ–ç‡pCVRï¼‰ï¼Œç„¶åæŒ‰åˆ†å€¼é«˜ä½å‘ˆç°ç»™ç”¨æˆ·ã€‚</p>\n<p>æ’åºæ¨¡å‹çš„å¥½åï¼Œç›´æ¥å†³å®šäº†ç”¨æˆ·çš„æœ€ç»ˆä½“éªŒå’Œå¹³å°çš„å•†ä¸šç›®æ ‡ã€‚è¿™æ˜¯ä¸€ä¸ªäºç»†å¾®å¤„è§çœŸç« çš„&quot;ç‚¼é‡‘&quot;è¿‡ç¨‹ï¼Œæ¨¡å‹çš„æ¯ä¸€æ¬¡å¾®å°è¿­ä»£ï¼Œéƒ½å¯èƒ½å¸¦æ¥å·¨å¤§çš„æ”¶ç›Šã€‚</p>\n<h2 id=\"ğŸ›ï¸-æ¨¡å‹æ¼”è¿›ä¹‹è·¯-ä»åˆ†ç«‹åˆ°èåˆ-ä»äººå·¥åˆ°è‡ªåŠ¨\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ›ï¸-æ¨¡å‹æ¼”è¿›ä¹‹è·¯-ä»åˆ†ç«‹åˆ°èåˆ-ä»äººå·¥åˆ°è‡ªåŠ¨\"><span>ğŸ›ï¸ æ¨¡å‹æ¼”è¿›ä¹‹è·¯ï¼šä»åˆ†ç«‹åˆ°èåˆï¼Œä»äººå·¥åˆ°è‡ªåŠ¨</span></a></h2>\n<p>æ·±åº¦æ’åºæ¨¡å‹çš„æ¼”è¿›ï¼Œæ˜¯ä¸€éƒ¨è¿½æ±‚&quot;æ›´é«˜ã€æ›´å¿«ã€æ›´å¼º&quot;çš„ç‰¹å¾å·¥ç¨‹ä¸æ¨¡å‹ç»“æ„åˆ›æ–°å²ã€‚</p>\n<h3 id=\"å¥ åŸºæ—¶ä»£-wide-deep-â€”â€”-è®°å¿†-ä¸-æ³›åŒ–-çš„é¦–æ¬¡è”å§»\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¥ åŸºæ—¶ä»£-wide-deep-â€”â€”-è®°å¿†-ä¸-æ³›åŒ–-çš„é¦–æ¬¡è”å§»\"><span>å¥ åŸºæ—¶ä»£ï¼šWide &amp; Deep â€”â€” &quot;è®°å¿†&quot;ä¸&quot;æ³›åŒ–&quot;çš„é¦–æ¬¡è”å§»</span></a></h3>\n<p>Googleåœ¨2016å¹´æå‡ºçš„ <code v-pre>Wide &amp; Deep</code> æ¨¡å‹ï¼Œæ˜¯æ·±åº¦å­¦ä¹ åœ¨æ¨èé¢†åŸŸé‡Œç¨‹ç¢‘å¼çš„ä½œå“ï¼Œå®ƒå¥ å®šäº†ç°ä»£æ’åºæ¨¡å‹çš„åŸºæœ¬èŒƒå¼ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä»»ä½•æ¨èåœºæ™¯éƒ½ç¦»ä¸å¼€&quot;è®°å¿†&quot;ï¼ˆMemorizationï¼‰å’Œ&quot;æ³›åŒ–&quot;ï¼ˆGeneralizationï¼‰ã€‚\n<ul>\n<li><strong>Wideéƒ¨åˆ†ï¼ˆè®°å¿†ï¼‰</strong>ï¼šä¸€ä¸ªå¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼Œè´Ÿè´£è®°å¿†é‚£äº›é¢‘ç¹å…±ç°çš„ã€é‡è¦çš„äº¤å‰ç‰¹å¾ï¼Œæ¯”å¦‚&quot;ç”¨æˆ·çˆ±å–æ‹¿é“ &amp; åŸå¸‚æ˜¯ä¸Šæµ·&quot;ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•ã€å¯è§£é‡Šæ€§å¼ºã€‚</li>\n<li><strong>Deepéƒ¨åˆ†ï¼ˆæ³›åŒ–ï¼‰</strong>ï¼šä¸€ä¸ªæ ‡å‡†çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆDNNï¼‰ï¼Œè´Ÿè´£å°†ç¨€ç–ç‰¹å¾åµŒå…¥åˆ°ä½ç»´ç¨ å¯†ç©ºé—´ï¼Œå­¦ä¹ é‚£äº›ä»æœªæˆ–å¾ˆå°‘å‡ºç°çš„ç‰¹å¾ç»„åˆï¼Œæ¢ç´¢æœªçŸ¥çš„å¯èƒ½æ€§ã€‚</li>\n</ul>\n</li>\n<li><strong>ç²¾é«“</strong>ï¼šå°†ä¸¤è€…è”åˆè®­ç»ƒï¼Œè®©æ¨¡å‹åŒæ—¶å…·å¤‡è®°ä½&quot;å†å²ç»éªŒ&quot;å’Œæ¢ç´¢&quot;æ–°é²œäº‹ç‰©&quot;çš„èƒ½åŠ›ã€‚</li>\n</ul>\n<Mermaid id=\"mermaid-42\" code=\"eJxLL0osyFAIceFSAILi0iQIXyk8MyVVISCxqEQJLAECKZlFqcklmfl5Cj5BcMHweDfXaLDqJ/uWP+/c+XRfo01Skb7d02VNT3YtedrfCRFTilXQ1bUDqvbxjVZ6unP/k52dz3ftf9aw/NmKhU/ndSvFgg1MzUvhQnOHS2pqATHucAG7A6Qawx2eLs837tZReLpxHtA+IBPqFpd419ykaCUgkZqSkpmX/nRjE1zGxc8PaJifH7q7QO4HKwkuzQULgJXCRcBCQEa0Uow21Cz/0pKC0pJopeDM9Nz8zJQX+yY/bd8FNJYLAEu4hSM=\"></Mermaid><details class=\"hint-container details\"><summary>ğŸ’» Wide&amp;Deep æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> WideDeep</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Wide &#x26; Deep Model</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        wide_features (list): Wideä¾§çš„ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        deep_features (list): Deepä¾§çš„ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> wide_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Wideéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆè¾“å‡ºå±‚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            x (dict): è¾“å…¥ç‰¹å¾, a dictionary with keys being feature names.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Wideä¾§é€»è¾‘</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        wide_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, wide_embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepä¾§é€»è¾‘</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, deep_embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_output </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, mlp_output_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥Wideå’ŒDeepçš„è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        concat_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">wide_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_output</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">concat_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h3 id=\"äº¤å‰æ—¶ä»£-å‘Šåˆ«-äººå·¥ç‚¼ä¸¹-æ‹¥æŠ±-è‡ªåŠ¨é©¾é©¶\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#äº¤å‰æ—¶ä»£-å‘Šåˆ«-äººå·¥ç‚¼ä¸¹-æ‹¥æŠ±-è‡ªåŠ¨é©¾é©¶\"><span>äº¤å‰æ—¶ä»£ï¼šå‘Šåˆ«&quot;äººå·¥ç‚¼ä¸¹&quot;ï¼Œæ‹¥æŠ±&quot;è‡ªåŠ¨é©¾é©¶&quot;</span></a></h3>\n<p><code v-pre>Wide &amp; Deep</code> çš„ä¸€ä¸ªç—›ç‚¹æ˜¯ï¼ŒWideéƒ¨åˆ†çš„äº¤å‰ç‰¹å¾ä»ç„¶éœ€è¦å¤§é‡çš„äººå·¥è®¾è®¡å’Œç­›é€‰ï¼Œè¿™æ˜¯ä¸€é¡¹ç¹çä¸”ç»éªŒä¾èµ–çš„&quot;ç‚¼ä¸¹&quot;å·¥ä½œã€‚äºæ˜¯ï¼Œä¸€ç³»åˆ—èƒ½<strong>è‡ªåŠ¨å­¦ä¹ ç‰¹å¾äº¤å‰</strong>çš„æ¨¡å‹åº”è¿è€Œç”Ÿã€‚</p>\n<h4 id=\"deepfm-fmä¸dnnçš„ç è”ç’§åˆ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#deepfm-fmä¸dnnçš„ç è”ç’§åˆ\"><span>DeepFMï¼šFMä¸DNNçš„ç è”ç’§åˆ</span></a></h4>\n<p><code v-pre>DeepFM</code> æ˜¯è¿™ä¸ªæ—¶ä»£æœ€è€€çœ¼çš„æ˜æ˜Ÿï¼Œè‡³ä»Šä»æ˜¯è®¸å¤šå…¬å¸çº¿ä¸Šæ¨¡å‹çš„ä¸»åŠ›ã€‚å®ƒå·§å¦™åœ°å°†å› å­åˆ†è§£æœºï¼ˆFMï¼‰å’ŒDNNç»“åˆåœ¨äº†ä¸€ä¸ªæ¡†æ¶ä¸­ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š\n<ul>\n<li><strong>FMéƒ¨åˆ†</strong>ï¼šä¸Wideéƒ¨åˆ†ç±»ä¼¼ï¼Œä½†å®ƒèƒ½è‡ªåŠ¨å­¦ä¹ æ‰€æœ‰ç‰¹å¾ä¹‹é—´çš„äºŒé˜¶äº¤å‰ï¼Œæ— éœ€äººå·¥æŒ‡å®šã€‚</li>\n<li><strong>Deepéƒ¨åˆ†</strong>ï¼šä¸<code v-pre>Wide &amp; Deep</code>ä¸­çš„Deepéƒ¨åˆ†ä¸€è‡´ï¼Œå­¦ä¹ é«˜é˜¶äº¤å‰ç‰¹å¾ã€‚</li>\n</ul>\n</li>\n<li><strong>ç²¾é«“</strong>ï¼šFMéƒ¨åˆ†å’ŒDeepéƒ¨åˆ†çš„è¾“å…¥Embeddingæ˜¯<strong>å…±äº«</strong>çš„ï¼è¿™å¸¦æ¥äº†ä¸¤å¤§å¥½å¤„ï¼š\n<ol>\n<li>æ¨¡å‹æ›´å°ï¼Œè®­ç»ƒæ›´å¿«ã€‚</li>\n<li>Embeddingå±‚èƒ½è¢«ä½é˜¶å’Œé«˜é˜¶äº¤å‰ä¿¡å·åŒæ—¶è®­ç»ƒï¼Œå­¦ä¹ æ›´å……åˆ†ã€‚</li>\n</ol>\n</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» DeepFM æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> FM</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> DeepFM</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    DeepFM Model</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        deep_features (list): ç”¨äºDeepå’ŒFMéƒ¨åˆ†çš„ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # DeepFMä¸­ï¼Œæ‰€æœ‰ç‰¹å¾éƒ½ç”¨äºDeepå’ŒFMéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # FMéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fm </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> FM</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">reduce_sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆè¾“å‡ºå±‚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # 1 (æ¥è‡ªFM) + mlp_output_dim (æ¥è‡ªDeep)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            x (dict): è¾“å…¥ç‰¹å¾å­—å…¸.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è·å–æ‰€æœ‰ç‰¹å¾çš„Embedding</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        embed_x </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, n_fields, embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # FMéƒ¨åˆ†è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        fm_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, 1)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†è¾“å…¥éœ€è¦å°†Embeddingå±•å¹³</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">flatten</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">start_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, n_fields * embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, mlp_output_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥FMå’ŒDeepçš„è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        concat_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">fm_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">concat_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h4 id=\"dcn-v2-æ›´å¼ºå¤§çš„æ˜¾å¼äº¤å‰ç½‘ç»œ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#dcn-v2-æ›´å¼ºå¤§çš„æ˜¾å¼äº¤å‰ç½‘ç»œ\"><span>DCN V2ï¼šæ›´å¼ºå¤§çš„æ˜¾å¼äº¤å‰ç½‘ç»œ</span></a></h4>\n<p><code v-pre>DCN</code> (Deep &amp; Cross Network) æä¾›äº†å¦ä¸€ç§æ˜¾å¼å­¦ä¹ ç‰¹å¾äº¤å‰çš„æ€è·¯ã€‚å®ƒè®¾è®¡çš„<code v-pre>Cross Network</code>å¯ä»¥åœ¨æ¯ä¸€å±‚éƒ½ä¿ç•™ä¹‹å‰æ‰€æœ‰å±‚çš„äº¤å‰ç»“æœï¼Œå¹¶ä¸åŸå§‹è¾“å…¥è¿›è¡Œæ–°ä¸€è½®çš„äº¤å‰ã€‚<code v-pre>DCN V2</code> æ˜¯å…¶æ”¹è¿›ç‰ˆï¼Œç»“æ„æ›´ç¨³å®šï¼Œè¡¨ç°æ›´ä¼˜ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š\n<ul>\n<li><strong>Crosséƒ¨åˆ†</strong>ï¼šç”¨ä¸€ä¸ªç‰¹å®šçš„ç½‘ç»œç»“æ„ï¼Œåœ¨æ¯ä¸€å±‚éƒ½æ˜¾å¼åœ°ã€è‡ªåŠ¨åœ°è¿›è¡Œç‰¹å¾äº¤å‰ï¼Œäº¤å‰çš„é˜¶æ•°ç”±ç½‘ç»œæ·±åº¦å†³å®šã€‚</li>\n<li><strong>Deepéƒ¨åˆ†</strong>ï¼šä¸€ä¸ªæ ‡å‡†çš„DNNï¼Œä¸Crosséƒ¨åˆ†å¹¶è¡Œã€‚</li>\n</ul>\n</li>\n<li><strong>ç²¾é«“</strong>ï¼šç›¸æ¯”äºFMåªèƒ½åšäºŒé˜¶äº¤å‰ï¼ŒCrossç½‘ç»œèƒ½ä»¥ä¸€ç§é«˜æ•ˆä¸”æœ‰ç•Œçš„æ–¹å¼ï¼Œå­¦ä¹ æ›´é«˜é˜¶çš„äº¤å‰ç‰¹å¾ã€‚</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» DCN V2 æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CrossNetworkV2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> DCNv2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Deep &#x26; Cross Network V2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        features (list): æ‰€æœ‰ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        cross_layer_num (int): Crossç½‘ç»œçš„å±‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> cross_layer_num</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Crosséƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cross_net </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CrossNetworkV2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> cross_layer_num</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥Crosså’ŒDeepçš„è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        embed_x </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">flatten</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">start_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch_size, n_fields * embed_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Crosséƒ¨åˆ†è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        cross_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cross_net</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # Deepéƒ¨åˆ†è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        deep_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">deep_mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        concat_out </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cross_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> deep_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">concat_out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h3 id=\"æ³¨æ„åŠ›æ—¶ä»£-è®©æ¨¡å‹çŸ¥é“è¯¥-çœ‹-å“ªé‡Œ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ³¨æ„åŠ›æ—¶ä»£-è®©æ¨¡å‹çŸ¥é“è¯¥-çœ‹-å“ªé‡Œ\"><span>æ³¨æ„åŠ›æ—¶ä»£ï¼šè®©æ¨¡å‹çŸ¥é“è¯¥&quot;çœ‹&quot;å“ªé‡Œ</span></a></h3>\n<p>ä¹‹å‰çš„æ¨¡å‹åœ¨å¤„ç†ç”¨æˆ·å†å²è¡Œä¸ºæ—¶ï¼Œé€šå¸¸æ˜¯å°†æ‰€æœ‰è¡Œä¸ºçš„Embeddingåšç®€å•çš„Poolingï¼ˆå¦‚Sum/Averageï¼‰ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„â€”â€”ç”¨æˆ·çœ‹è¿‡çš„100ä¸ªè§†é¢‘ï¼Œè·Ÿå½“å‰è¦æ¨èçš„&quot;è·‘é‹&quot;å¹¿å‘Šï¼Œç›¸å…³æ€§å¿…ç„¶æœ‰é«˜æœ‰ä½ã€‚<strong>æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttentionï¼‰</strong> çš„å¼•å…¥ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>\n<h4 id=\"din-ä¸ºç”¨æˆ·å…´è¶£åŠ¨æ€-èšç„¦\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#din-ä¸ºç”¨æˆ·å…´è¶£åŠ¨æ€-èšç„¦\"><span>DINï¼šä¸ºç”¨æˆ·å…´è¶£åŠ¨æ€&quot;èšç„¦&quot;</span></a></h4>\n<p><code v-pre>DIN</code> (Deep Interest Network) æ˜¯é˜¿é‡Œæå‡ºçš„ã€åœ¨å·¥ä¸šç•Œå½±å“æ·±è¿œçš„æ¨¡å‹ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šç”¨æˆ·çš„å…´è¶£æ˜¯å¤šæ ·çš„ï¼Œå¹¶ä¸”åœ¨é¢å¯¹ä¸åŒçš„å€™é€‰å•†å“æ—¶ï¼Œç›¸å…³çš„å…´è¶£ç‚¹ä¹Ÿä¸åŒã€‚</li>\n<li><strong>ç²¾é«“</strong>ï¼š\n<ol>\n<li>ä¸å†å¯¹ç”¨æˆ·å†å²è¡Œä¸ºåšç®€å•çš„Poolingã€‚</li>\n<li>å¼•å…¥ä¸€ä¸ª&quot;æ³¨æ„åŠ›å•å…ƒ&quot;ï¼Œå°†<strong>å€™é€‰å•†å“</strong>ï¼ˆTarget Adï¼‰ä½œä¸ºæŸ¥è¯¢ï¼ˆQueryï¼‰ï¼Œå»åŠ¨æ€åœ°è®¡ç®—ç”¨æˆ·å†å²è¡Œä¸ºåºåˆ—ä¸­æ¯ä¸ªè¡Œä¸ºçš„&quot;æ³¨æ„åŠ›å¾—åˆ†&quot;ã€‚</li>\n<li>å¯¹å†å²è¡Œä¸ºçš„EmbeddingåšåŠ æƒæ±‚å’Œï¼Œæƒé‡å°±æ˜¯æ³¨æ„åŠ›å¾—åˆ†ã€‚è¿™æ ·ï¼Œä¸å½“å‰å€™é€‰å•†å“è¶Šç›¸å…³çš„å†å²è¡Œä¸ºï¼Œæƒé‡å°±è¶Šé«˜ã€‚</li>\n<li>æœ€åï¼Œå°†è¿™ä¸ª&quot;èšç„¦&quot;åçš„ç”¨æˆ·å…´è¶£å‘é‡ï¼Œä¸å…¶ä»–ç‰¹å¾ä¸€èµ·é€å…¥DNNè¿›è¡Œé¢„æµ‹ã€‚</li>\n</ol>\n</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» DIN æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ActivationUnit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> DIN</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Deep Interest Network</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        features (list): ç‰¹å¾åˆ—è¡¨ï¼Œéœ€è¦åŒºåˆ†ç›®æ ‡ç‰©å“ã€å†å²åºåˆ—å’Œå…¶ä»–ç‰¹å¾.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        history_features (list): å†å²è¡Œä¸ºåºåˆ—çš„ç‰¹å¾ååˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        target_features (list): ç›®æ ‡ç‰©å“çš„ç‰¹å¾ååˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        mlp_params (dict): MLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        attention_mlp_params (dict): æ³¨æ„åŠ›å•å…ƒMLPçš„å‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> history_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> target_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> attention_mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ³¨æ„åŠ›å•å…ƒ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">attention_unit </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ActivationUnit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">            embedding_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get_embedding_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">            **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">attention_mlp_params</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        )</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆçš„MLP</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è¾“å…¥ç»´åº¦ = (ç›®æ ‡ç‰©å“+ä¸Šä¸‹æ–‡ç‰¹å¾) + å†å²åºåˆ—ç‰¹å¾(attentionä¹‹å)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get_mlp_input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(),</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æå–å„ç±»ç‰¹å¾çš„Embedding</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        target_item_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        history_seq_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">history_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        context_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get_context_features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">())</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é€šè¿‡æ³¨æ„åŠ›å•å…ƒè®¡ç®—ç”¨æˆ·å…´è¶£å‘é‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        user_interest_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">attention_unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_item_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> history_seq_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥æ‰€æœ‰ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        mlp_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">target_item_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> user_interest_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> context_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æœ€ç»ˆé¢„æµ‹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        y_pred </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mlp_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">y_pred</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h3 id=\"å¤šç›®æ ‡æ—¶ä»£-ä¸€ä¸ªæ¨¡å‹-å¤šç§ä½¿å‘½\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å¤šç›®æ ‡æ—¶ä»£-ä¸€ä¸ªæ¨¡å‹-å¤šç§ä½¿å‘½\"><span>å¤šç›®æ ‡æ—¶ä»£ï¼šä¸€ä¸ªæ¨¡å‹ï¼Œå¤šç§ä½¿å‘½</span></a></h3>\n<p>åœ¨çœŸå®çš„ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¸åªå…³å¿ƒ&quot;ç‚¹å‡»ç‡&quot;ï¼Œè¿˜å…³å¿ƒ&quot;è½¬åŒ–ç‡&quot;ã€&quot;è§‚çœ‹æ—¶é•¿&quot;ã€&quot;åˆ†äº«ç‡&quot;ç­‰å¤šä¸ªæŒ‡æ ‡ã€‚<strong>å¤šä»»åŠ¡å­¦ä¹ ï¼ˆMulti-Task Learning, MTLï¼‰</strong> å°±æ˜¯ä¸ºäº†åŒæ—¶ä¼˜åŒ–è¿™äº›ç›®æ ‡è€Œç”Ÿã€‚</p>\n<h4 id=\"mmoe-å·§å¦™å¹³è¡¡å¤šä¸ªä»»åŠ¡çš„-ä¸“å®¶ç½‘ç»œ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#mmoe-å·§å¦™å¹³è¡¡å¤šä¸ªä»»åŠ¡çš„-ä¸“å®¶ç½‘ç»œ\"><span>MMoEï¼šå·§å¦™å¹³è¡¡å¤šä¸ªä»»åŠ¡çš„&quot;ä¸“å®¶ç½‘ç»œ&quot;</span></a></h4>\n<p><code v-pre>MMoE</code> (Multi-gate Mixture-of-Experts) æ˜¯Googleæå‡ºçš„ç»å…¸å¤šä»»åŠ¡å­¦ä¹ æ¡†æ¶ã€‚</p>\n<ul>\n<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šä¸åŒçš„ä»»åŠ¡ä¹‹é—´ï¼Œæ—¢æœ‰å…±æ€§ï¼Œä¹Ÿæœ‰ç‰¹æ€§ã€‚å¼ºè¡Œè®©æ‰€æœ‰ä»»åŠ¡å…±äº«ä¸€ä¸ªåº•å±‚ç½‘ç»œï¼ˆShared-Bottomï¼‰å¯èƒ½ä¼šå¯¼è‡´&quot;è··è··æ¿æ•ˆåº”&quot;ï¼ˆä¸€ä¸ªä»»åŠ¡æå‡ï¼Œå¦ä¸€ä¸ªä»»åŠ¡ä¸‹é™ï¼‰ã€‚</li>\n<li><strong>ç²¾é«“</strong>ï¼š\n<ol>\n<li>è®¾ç½®å¤šä¸ª<strong>ä¸“å®¶ç½‘ç»œï¼ˆExpertsï¼‰</strong>ï¼Œæ¯ä¸ªä¸“å®¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å­ç½‘ç»œï¼Œå¯ä»¥å­¦ä¹ åˆ°æŸæ–¹é¢çš„å…±åŒçŸ¥è¯†ã€‚</li>\n<li>ä¸ºæ¯ä¸ªä»»åŠ¡è®¾ç½®ä¸€ä¸ª<strong>é—¨æ§ç½‘ç»œï¼ˆGateï¼‰</strong>ã€‚è¿™ä¸ªé—¨æ§ç½‘ç»œä¼šæ ¹æ®å½“å‰è¾“å…¥ï¼ŒåŠ¨æ€åœ°ä¸ºæ‰€æœ‰ä¸“å®¶åˆ†é…æƒé‡ã€‚</li>\n<li>æ¯ä¸ªä»»åŠ¡çš„æœ€ç»ˆè¾“å…¥ï¼Œæ˜¯æ‰€æœ‰ä¸“å®¶è¾“å‡ºçš„åŠ æƒå’Œã€‚è¿™æ ·ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥æŒ‰éœ€ã€çµæ´»åœ°ç»„åˆä¸“å®¶çš„èƒ½åŠ›ï¼Œæ—¢èƒ½å…±äº«ä¿¡æ¯ï¼Œåˆèƒ½ä¿ç•™ä¸ªæ€§ï¼Œæœ‰æ•ˆé¿å…äº†è´Ÿè¿ç§»ã€‚</li>\n</ol>\n</li>\n</ul>\n<details class=\"hint-container details\"><summary>ğŸ’» MMoE æ¨¡å‹å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch_rechub</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">models</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> MMoE</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Multi-gate Mixture-of-Experts Model</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        features (list): æ‰€æœ‰è¾“å…¥ç‰¹å¾åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        task_types (list): ä»»åŠ¡ç±»å‹åˆ—è¡¨, e.g., ['binary', 'binary'].</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        n_expert (int): ä¸“å®¶æ•°é‡.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        expert_params (dict): æ¯ä¸ªä¸“å®¶ç½‘ç»œçš„MLPå‚æ•°.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        tower_params_list (list): æ¯ä¸ªä»»åŠ¡å¡”çš„MLPå‚æ•°åˆ—è¡¨.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> task_types</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> n_expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> expert_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tower_params_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">().</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> EmbeddingLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">features</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_task </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> len</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">task_types</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä¸“å®¶ç½‘ç»œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">experts </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _ </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é—¨æ§ç½‘ç»œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gates </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> n_expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> bias</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _ </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_task</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä»»åŠ¡å¡”</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">towers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            MLP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">output_dim</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> **</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">tower_params</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tower_params </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tower_params_list</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        input_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">feature_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">flatten</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">start_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä¸“å®¶è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        expert_outputs </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> expert </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">experts</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        expert_outputs </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_outputs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch, n_expert, expert_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é—¨æ§å’Œä»»åŠ¡å¡”è®¡ç®—</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        outputs </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">n_task</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            gate_value </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gates</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">](</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">input_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">unsqueeze</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch, n_expert, 1)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # é—¨æ§åŠ æƒ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            task_input </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expert_outputs </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> gate_value</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # (batch, expert_dim)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # ä»»åŠ¡å¡”è¾“å‡º</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            task_output </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">towers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">](</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">task_input</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            outputs</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">task_output</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> outputs</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h2 id=\"ğŸ“–-å»¶ä¼¸é˜…è¯»\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ“–-å»¶ä¼¸é˜…è¯»\"><span>ğŸ“– <strong>å»¶ä¼¸é˜…è¯»</strong></span></a></h2>\n<ol>\n<li><a href=\"https://arxiv.org/abs/1606.07792\" target=\"_blank\" rel=\"noopener noreferrer\">Wide &amp; Deep Learning for Recommender Systems</a> - Wide&amp;Deepçš„å¼€å±±ä¹‹ä½œã€‚</li>\n<li><a href=\"https://arxiv.org/abs/1703.04247\" target=\"_blank\" rel=\"noopener noreferrer\">DeepFM: A Factorization-Machine based Neural Network for CTR Prediction</a> - DeepFMçš„ç»å…¸è®ºæ–‡ã€‚</li>\n<li><a href=\"https://arxiv.org/abs/1706.06978\" target=\"_blank\" rel=\"noopener noreferrer\">Deep Interest Network for Click-Through Rate Prediction</a> - DINçš„ç»å…¸è®ºæ–‡ï¼Œå¼€å¯äº†æ·±åº¦å…´è¶£å»ºæ¨¡çš„æ—¶ä»£ã€‚</li>\n<li><a href=\"https://dl.acm.org/doi/10.1145/3219819.3220007\" target=\"_blank\" rel=\"noopener noreferrer\">Modeling Task Relationships in Multi-task Learning with Multi-gate Mixture-of-Experts</a> - MMoEçš„ç»å…¸è®ºæ–‡ï¼Œå¤šä»»åŠ¡å­¦ä¹ çš„å¿…è¯»æ–‡çŒ®ã€‚</li>\n<li><a href=\"https://github.com/datawhalechina/torch-rechub/tree/main/torch_rechub/models/ranking\" target=\"_blank\" rel=\"noopener noreferrer\">Torch-RecHub Ranking Models</a> - Datawhaleå¼€æºçš„torch-rechubé¡¹ç›®ä¸­ï¼ŒåŒ…å«äº†å¤šç§ç»å…¸æ’åºæ¨¡å‹çš„PyTorchå®ç°ã€‚</li>\n</ol>\n<blockquote>\n<p>ğŸ§  <strong>æ€è€ƒé¢˜</strong></p>\n<ol>\n<li>\n<p>DeepFMçš„Embeddingå…±äº«æœºåˆ¶æ˜¯å…¶äº®ç‚¹ï¼Œä½†ä¹Ÿå¯èƒ½å¸¦æ¥å‚æ•°æ›´æ–°çš„å†²çªã€‚ä½ è®¤ä¸ºåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼ŒFMå’ŒDeepéƒ¨åˆ†ä½¿ç”¨ç‹¬ç«‹çš„Embeddingå¯èƒ½ä¼šæ›´å¥½ï¼Ÿ</p>\n</li>\n<li>\n<p>DCNå’ŒxDeepFMéƒ½è‡´åŠ›äºæ˜¾å¼åœ°å­¦ä¹ é«˜é˜¶ç‰¹å¾äº¤å‰ï¼Œå®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨è®¡ç®—æ•ˆç‡å’Œæ•ˆæœä¸Šå„æœ‰ä»€ä¹ˆå–èˆï¼Ÿ</p>\n</li>\n<li>\n<p>DINçš„æ³¨æ„åŠ›æœºåˆ¶æ˜¯é’ˆå¯¹&quot;ç”¨æˆ·å†å²&quot;å’Œ&quot;å€™é€‰å•†å“&quot;æ¥è®¡ç®—çš„ã€‚ä½ è¿˜èƒ½æƒ³åˆ°å“ªäº›ç‰¹å¾å¯ä»¥å¼•å…¥åˆ°è¿™ä¸ªæ³¨æ„åŠ›è®¡ç®—ä¸­ï¼Œæ¥è¿›ä¸€æ­¥æå‡æ•ˆæœï¼Ÿï¼ˆæ¯”å¦‚ï¼Œä¸Šä¸‹æ–‡ç‰¹å¾ï¼Ÿï¼‰</p>\n</li>\n<li>\n<p>MMoEä¸­çš„&quot;ä¸“å®¶&quot;æ•°é‡æ˜¯ä¸€ä¸ªè¶…å‚ï¼Œä½ è®¤ä¸ºå®ƒåº”è¯¥å¦‚ä½•è®¾ç½®ï¼Ÿæ˜¯è¶Šå¤šè¶Šå¥½å—ï¼Ÿå®ƒå’Œä»»åŠ¡çš„ç›¸å…³æ€§æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>\n</li>\n</ol>\n</blockquote>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">ğŸ‰ ç« èŠ‚å°ç»“</p>\n<p>æ·±åº¦æ’åºæ¨¡å‹çš„æ¼”è¿›å†ç¨‹å±•ç°äº†æ¨èç³»ç»Ÿä»&quot;æ‰‹å·¥ç‚¼ä¸¹&quot;åˆ°&quot;è‡ªåŠ¨é©¾é©¶&quot;çš„åä¸½è½¬èº«ã€‚Wide&amp;Deepå¥ å®šäº†è®°å¿†ä¸æ³›åŒ–å¹¶é‡çš„åŸºç¡€èŒƒå¼ï¼ŒDeepFMå®ç°äº†ç‰¹å¾äº¤å‰çš„è‡ªåŠ¨åŒ–çªç ´ï¼ŒDINå¼•å…¥æ³¨æ„åŠ›æœºåˆ¶æ•è·åŠ¨æ€å…´è¶£ï¼ŒMMoEå°†å•ä¸€ç›®æ ‡æ‰©å±•ä¸ºå¤šä»»åŠ¡ååŒä¼˜åŒ–ã€‚æ¯ä¸€æ¬¡æ¨¡å‹åˆ›æ–°ï¼Œéƒ½æ˜¯å¯¹ç”¨æˆ·å¤æ‚åå¥½çš„æ›´æ·±å±‚ç†è§£ï¼Œä¹Ÿæ˜¯å¯¹æ¨èç²¾åº¦æé™çš„ä¸æ‡ˆè¿½æ±‚ã€‚æŒæ¡è¿™äº›æ¨¡å‹çš„ç²¾é«“ï¼Œå°±æ˜¯æŒæ¡äº†åœ¨æ¨èç³»ç»Ÿ&quot;æœ€åä¸€å…¬é‡Œ&quot;ä¸­ç²¾é›•ç»†ç¢çš„è‰ºæœ¯ã€‚</p>\n</div>\n<hr>\n<blockquote>\n<p>&quot;The devil is in the details.&quot; â€”â€” Ludwig Mies van der Rohe<br>\nåœ¨æ’åºæ¨¡å‹çš„ä¸–ç•Œé‡Œï¼Œé­”é¬¼è—åœ¨ç»†èŠ‚ä¸­ï¼Œè€Œå¤©ä½¿ä¹Ÿåœ¨ç»†èŠ‚ä¸­è¯ç”Ÿã€‚</p>\n</blockquote>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"å¦‚æœè¯´å¬å›æ˜¯ä»äº¿ä¸‡ç‰©æ–™ä¸­\"å¤§æµ·æé’ˆ\"ï¼Œé‚£ä¹ˆ**æ’åºï¼ˆRankingï¼‰** å°±æ˜¯åœ¨è¿™å‡ ç™¾æ ¹\"é’ˆ\"é‡Œæ‰¾å‡ºæœ€äº®çš„é‚£ä¸€æ ¹ã€‚å®ƒæ˜¯æ¨èæµç¨‹çš„\"æœ€åä¸€å…¬é‡Œ\"ï¼Œè´Ÿè´£å¯¹å¬å›çš„å€™é€‰é›†è¿›è¡Œç²¾å‡†æ‰“åˆ†ï¼Œé¢„æµ‹ç”¨æˆ·å¯¹æ¯ä¸ªç‰©å“çš„åå¥½ç¨‹åº¦ï¼ˆå¦‚ç‚¹å‡»ç‡pCTRã€è½¬åŒ–ç‡pCVRï¼‰ï¼Œç„¶åæŒ‰åˆ†å€¼é«˜ä½å‘ˆç°ç»™ç”¨æˆ·ã€‚\n\næ’åºæ¨¡å‹çš„å¥½åï¼Œç›´æ¥å†³å®šäº†ç”¨æˆ·çš„æœ€ç»ˆä½“éªŒå’Œå¹³å°çš„å•†ä¸šç›®æ ‡ã€‚è¿™æ˜¯ä¸€ä¸ªäºç»†å¾®å¤„è§çœŸç« çš„\"ç‚¼é‡‘\"è¿‡ç¨‹ï¼Œæ¨¡å‹çš„æ¯ä¸€æ¬¡å¾®å°è¿­ä»£ï¼Œéƒ½å¯èƒ½å¸¦æ¥å·¨å¤§çš„æ”¶ç›Šã€‚\n\n## ğŸ›ï¸ æ¨¡å‹æ¼”è¿›ä¹‹è·¯ï¼šä»åˆ†ç«‹åˆ°èåˆï¼Œä»äººå·¥åˆ°è‡ªåŠ¨\n\næ·±åº¦æ’åºæ¨¡å‹çš„æ¼”è¿›ï¼Œæ˜¯ä¸€éƒ¨è¿½æ±‚\"æ›´é«˜ã€æ›´å¿«ã€æ›´å¼º\"çš„ç‰¹å¾å·¥ç¨‹ä¸æ¨¡å‹ç»“æ„åˆ›æ–°å²ã€‚\n\n### å¥ åŸºæ—¶ä»£ï¼šWide & Deep â€”â€” \"è®°å¿†\"ä¸\"æ³›åŒ–\"çš„é¦–æ¬¡è”å§»\n\nGoogleåœ¨2016å¹´æå‡ºçš„ `Wide & Deep` æ¨¡å‹ï¼Œæ˜¯æ·±åº¦å­¦ä¹ åœ¨æ¨èé¢†åŸŸé‡Œç¨‹ç¢‘å¼çš„ä½œå“ï¼Œå®ƒå¥ å®šäº†ç°ä»£æ’åºæ¨¡å‹çš„åŸºæœ¬èŒƒå¼ã€‚\n\n-   **æ ¸å¿ƒæ€æƒ³**ï¼šä»»ä½•æ¨èåœºæ™¯éƒ½ç¦»ä¸å¼€\"è®°å¿†\"ï¼ˆMemorizationï¼‰å’Œ\"æ³›åŒ–\"ï¼ˆGeneralizationï¼‰ã€‚\n    -   **Wideéƒ¨åˆ†ï¼ˆè®°å¿†ï¼‰**ï¼šä¸€ä¸ªå¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼Œè´Ÿè´£è®°å¿†é‚£äº›é¢‘ç¹å…±ç°çš„ã€é‡è¦çš„äº¤å‰ç‰¹å¾ï¼Œæ¯”å¦‚\"ç”¨æˆ·çˆ±å–æ‹¿é“ & åŸå¸‚æ˜¯ä¸Šæµ·\"ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•ã€å¯è§£é‡Šæ€§å¼ºã€‚\n    -   **Deepéƒ¨åˆ†ï¼ˆæ³›åŒ–ï¼‰**ï¼šä¸€ä¸ªæ ‡å‡†çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆDNNï¼‰ï¼Œè´Ÿè´£å°†ç¨€ç–ç‰¹å¾åµŒå…¥åˆ°ä½ç»´ç¨ å¯†ç©ºé—´ï¼Œå­¦ä¹ é‚£äº›ä»æœªæˆ–å¾ˆå°‘å‡ºç°çš„ç‰¹å¾ç»„åˆï¼Œæ¢ç´¢æœªçŸ¥çš„å¯èƒ½æ€§ã€‚\n-   **ç²¾é«“**ï¼šå°†ä¸¤è€…è”åˆè®­ç»ƒï¼Œè®©æ¨¡å‹åŒæ—¶å…·å¤‡è®°ä½\"å†å²ç»éªŒ\"å’Œæ¢ç´¢\"æ–°é²œäº‹ç‰©\"çš„èƒ½åŠ›ã€‚\n\n```mermaid\ngraph TD\n    subgraph \"Wide Part\"\n        direction LR\n        W_FE[\"Wideä¾§ç‰¹å¾<br/>å¦‚äº¤å‰ç‰¹å¾\"] --> W_LM[\"å¹¿ä¹‰çº¿æ€§æ¨¡å‹\"]\n    end\n\n    subgraph \"Deep Part\"\n        direction LR\n        D_FE[\"Deepä¾§ç‰¹å¾<br/>å¦‚IDç±», å±æ€§ç±»\"] --> D_Emb[\"Embeddingå±‚\"] --> D_DNN[\"DNN\"]\n    end\n\n    W_LM --> Sum\n    D_DNN --> Sum\n\n    Sum[\"\\+\"] --> Output[\"Sigmoidè¾“å‡º\"]\n\n```\n\n::: details ğŸ’» Wide&Deep æ¨¡å‹å®ç° \n```python\nimport torch\nimport torch.nn as nn\nfrom torch_rechub.models.layers import MLP, EmbeddingLayer\n\nclass WideDeep(nn.Module):\n    \"\"\"\n    Wide & Deep Model\n    \n    Args:\n        wide_features (list): Wideä¾§çš„ç‰¹å¾åˆ—è¡¨.\n        deep_features (list): Deepä¾§çš„ç‰¹å¾åˆ—è¡¨.\n        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.\n    \"\"\"\n    def __init__(self, wide_features, deep_features, mlp_params):\n        super().__init__()\n        \n        # Wideéƒ¨åˆ†\n        self.wide_feature_layer = EmbeddingLayer(wide_features)\n        \n        # Deepéƒ¨åˆ†\n        self.deep_feature_layer = EmbeddingLayer(deep_features)\n        self.deep_mlp = MLP(self.deep_feature_layer.input_dim, **mlp_params)\n        \n        # æœ€ç»ˆè¾“å‡ºå±‚\n        self.output_layer = nn.Linear(mlp_params[\"output_dim\"] + self.wide_feature_layer.input_dim, 1)\n\n    def forward(self, x):\n        \"\"\"\n        Args:\n            x (dict): è¾“å…¥ç‰¹å¾, a dictionary with keys being feature names.\n        \"\"\"\n        # Wideä¾§é€»è¾‘\n        wide_input = self.wide_feature_layer(x) # (batch_size, wide_embed_dim)\n        \n        # Deepä¾§é€»è¾‘\n        deep_input = self.deep_feature_layer(x) # (batch_size, deep_embed_dim)\n        deep_output = self.deep_mlp(deep_input) # (batch_size, mlp_output_dim)\n        \n        # æ‹¼æ¥Wideå’ŒDeepçš„è¾“å‡º\n        concat_out = torch.cat([wide_input, deep_output], dim=1)\n        \n        # æœ€ç»ˆé¢„æµ‹\n        y_pred = self.output_layer(concat_out)\n        return torch.sigmoid(y_pred)\n```\n:::\n\n### äº¤å‰æ—¶ä»£ï¼šå‘Šåˆ«\"äººå·¥ç‚¼ä¸¹\"ï¼Œæ‹¥æŠ±\"è‡ªåŠ¨é©¾é©¶\"\n\n`Wide & Deep` çš„ä¸€ä¸ªç—›ç‚¹æ˜¯ï¼ŒWideéƒ¨åˆ†çš„äº¤å‰ç‰¹å¾ä»ç„¶éœ€è¦å¤§é‡çš„äººå·¥è®¾è®¡å’Œç­›é€‰ï¼Œè¿™æ˜¯ä¸€é¡¹ç¹çä¸”ç»éªŒä¾èµ–çš„\"ç‚¼ä¸¹\"å·¥ä½œã€‚äºæ˜¯ï¼Œä¸€ç³»åˆ—èƒ½**è‡ªåŠ¨å­¦ä¹ ç‰¹å¾äº¤å‰**çš„æ¨¡å‹åº”è¿è€Œç”Ÿã€‚\n\n#### DeepFMï¼šFMä¸DNNçš„ç è”ç’§åˆ\n\n`DeepFM` æ˜¯è¿™ä¸ªæ—¶ä»£æœ€è€€çœ¼çš„æ˜æ˜Ÿï¼Œè‡³ä»Šä»æ˜¯è®¸å¤šå…¬å¸çº¿ä¸Šæ¨¡å‹çš„ä¸»åŠ›ã€‚å®ƒå·§å¦™åœ°å°†å› å­åˆ†è§£æœºï¼ˆFMï¼‰å’ŒDNNç»“åˆåœ¨äº†ä¸€ä¸ªæ¡†æ¶ä¸­ã€‚\n\n-   **æ ¸å¿ƒæ€æƒ³**ï¼š\n    -   **FMéƒ¨åˆ†**ï¼šä¸Wideéƒ¨åˆ†ç±»ä¼¼ï¼Œä½†å®ƒèƒ½è‡ªåŠ¨å­¦ä¹ æ‰€æœ‰ç‰¹å¾ä¹‹é—´çš„äºŒé˜¶äº¤å‰ï¼Œæ— éœ€äººå·¥æŒ‡å®šã€‚\n    -   **Deepéƒ¨åˆ†**ï¼šä¸`Wide & Deep`ä¸­çš„Deepéƒ¨åˆ†ä¸€è‡´ï¼Œå­¦ä¹ é«˜é˜¶äº¤å‰ç‰¹å¾ã€‚\n-   **ç²¾é«“**ï¼šFMéƒ¨åˆ†å’ŒDeepéƒ¨åˆ†çš„è¾“å…¥Embeddingæ˜¯**å…±äº«**çš„ï¼è¿™å¸¦æ¥äº†ä¸¤å¤§å¥½å¤„ï¼š\n    1.  æ¨¡å‹æ›´å°ï¼Œè®­ç»ƒæ›´å¿«ã€‚\n    2.  Embeddingå±‚èƒ½è¢«ä½é˜¶å’Œé«˜é˜¶äº¤å‰ä¿¡å·åŒæ—¶è®­ç»ƒï¼Œå­¦ä¹ æ›´å……åˆ†ã€‚\n\n::: details ğŸ’» DeepFM æ¨¡å‹å®ç° \n```python\nimport torch\nimport torch.nn as nn\nfrom torch_rechub.models.layers import MLP, FM, EmbeddingLayer\n\nclass DeepFM(nn.Module):\n    \"\"\"\n    DeepFM Model\n    \n    Args:\n        deep_features (list): ç”¨äºDeepå’ŒFMéƒ¨åˆ†çš„ç‰¹å¾åˆ—è¡¨.\n        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.\n    \"\"\"\n    def __init__(self, deep_features, mlp_params):\n        super().__init__()\n        # DeepFMä¸­ï¼Œæ‰€æœ‰ç‰¹å¾éƒ½ç”¨äºDeepå’ŒFMéƒ¨åˆ†\n        self.feature_layer = EmbeddingLayer(deep_features)\n        \n        # FMéƒ¨åˆ†\n        self.fm = FM(reduce_sum=True)\n        \n        # Deepéƒ¨åˆ†\n        self.deep_mlp = MLP(self.feature_layer.input_dim, **mlp_params)\n        \n        # æœ€ç»ˆè¾“å‡ºå±‚\n        # 1 (æ¥è‡ªFM) + mlp_output_dim (æ¥è‡ªDeep)\n        self.output_layer = nn.Linear(mlp_params[\"output_dim\"] + 1, 1)\n\n    def forward(self, x):\n        \"\"\"\n        Args:\n            x (dict): è¾“å…¥ç‰¹å¾å­—å…¸.\n        \"\"\"\n        # è·å–æ‰€æœ‰ç‰¹å¾çš„Embedding\n        embed_x = self.feature_layer(x) # (batch_size, n_fields, embed_dim)\n        \n        # FMéƒ¨åˆ†è¾“å‡º\n        fm_out = self.fm(embed_x) # (batch_size, 1)\n        \n        # Deepéƒ¨åˆ†è¾“å…¥éœ€è¦å°†Embeddingå±•å¹³\n        deep_input = embed_x.flatten(start_dim=1) # (batch_size, n_fields * embed_dim)\n        deep_out = self.deep_mlp(deep_input) # (batch_size, mlp_output_dim)\n        \n        # æ‹¼æ¥FMå’ŒDeepçš„è¾“å‡º\n        concat_out = torch.cat([fm_out, deep_out], dim=1)\n        \n        # æœ€ç»ˆé¢„æµ‹\n        y_pred = self.output_layer(concat_out)\n        return torch.sigmoid(y_pred)\n```\n:::\n\n#### DCN V2ï¼šæ›´å¼ºå¤§çš„æ˜¾å¼äº¤å‰ç½‘ç»œ\n\n`DCN` (Deep & Cross Network) æä¾›äº†å¦ä¸€ç§æ˜¾å¼å­¦ä¹ ç‰¹å¾äº¤å‰çš„æ€è·¯ã€‚å®ƒè®¾è®¡çš„`Cross Network`å¯ä»¥åœ¨æ¯ä¸€å±‚éƒ½ä¿ç•™ä¹‹å‰æ‰€æœ‰å±‚çš„äº¤å‰ç»“æœï¼Œå¹¶ä¸åŸå§‹è¾“å…¥è¿›è¡Œæ–°ä¸€è½®çš„äº¤å‰ã€‚`DCN V2` æ˜¯å…¶æ”¹è¿›ç‰ˆï¼Œç»“æ„æ›´ç¨³å®šï¼Œè¡¨ç°æ›´ä¼˜ã€‚\n\n-   **æ ¸å¿ƒæ€æƒ³**ï¼š\n    -   **Crosséƒ¨åˆ†**ï¼šç”¨ä¸€ä¸ªç‰¹å®šçš„ç½‘ç»œç»“æ„ï¼Œåœ¨æ¯ä¸€å±‚éƒ½æ˜¾å¼åœ°ã€è‡ªåŠ¨åœ°è¿›è¡Œç‰¹å¾äº¤å‰ï¼Œäº¤å‰çš„é˜¶æ•°ç”±ç½‘ç»œæ·±åº¦å†³å®šã€‚\n    -   **Deepéƒ¨åˆ†**ï¼šä¸€ä¸ªæ ‡å‡†çš„DNNï¼Œä¸Crosséƒ¨åˆ†å¹¶è¡Œã€‚\n-   **ç²¾é«“**ï¼šç›¸æ¯”äºFMåªèƒ½åšäºŒé˜¶äº¤å‰ï¼ŒCrossç½‘ç»œèƒ½ä»¥ä¸€ç§é«˜æ•ˆä¸”æœ‰ç•Œçš„æ–¹å¼ï¼Œå­¦ä¹ æ›´é«˜é˜¶çš„äº¤å‰ç‰¹å¾ã€‚\n\n::: details ğŸ’» DCN V2 æ¨¡å‹å®ç° \n```python\nimport torch\nimport torch.nn as nn\nfrom torch_rechub.models.layers import MLP, CrossNetworkV2, EmbeddingLayer\n\nclass DCNv2(nn.Module):\n    \"\"\"\n    Deep & Cross Network V2\n    \n    Args:\n        features (list): æ‰€æœ‰ç‰¹å¾åˆ—è¡¨.\n        cross_layer_num (int): Crossç½‘ç»œçš„å±‚æ•°.\n        mlp_params (dict): Deepä¾§MLPçš„å‚æ•°.\n    \"\"\"\n    def __init__(self, features, cross_layer_num, mlp_params):\n        super().__init__()\n        self.feature_layer = EmbeddingLayer(features)\n        self.input_dim = self.feature_layer.input_dim\n        \n        # Crosséƒ¨åˆ†\n        self.cross_net = CrossNetworkV2(self.input_dim, cross_layer_num)\n        \n        # Deepéƒ¨åˆ†\n        self.deep_mlp = MLP(self.input_dim, **mlp_params)\n        \n        # æ‹¼æ¥Crosså’ŒDeepçš„è¾“å‡º\n        self.output_layer = nn.Linear(self.input_dim + mlp_params[\"output_dim\"], 1)\n\n    def forward(self, x):\n        embed_x = self.feature_layer(x).flatten(start_dim=1) # (batch_size, n_fields * embed_dim)\n        \n        # Crosséƒ¨åˆ†è¾“å‡º\n        cross_out = self.cross_net(embed_x)\n        \n        # Deepéƒ¨åˆ†è¾“å‡º\n        deep_out = self.deep_mlp(embed_x)\n        \n        # æ‹¼æ¥\n        concat_out = torch.cat([cross_out, deep_out], dim=1)\n        \n        # æœ€ç»ˆé¢„æµ‹\n        y_pred = self.output_layer(concat_out)\n        return torch.sigmoid(y_pred)\n```\n:::\n\n### æ³¨æ„åŠ›æ—¶ä»£ï¼šè®©æ¨¡å‹çŸ¥é“è¯¥\"çœ‹\"å“ªé‡Œ\n\nä¹‹å‰çš„æ¨¡å‹åœ¨å¤„ç†ç”¨æˆ·å†å²è¡Œä¸ºæ—¶ï¼Œé€šå¸¸æ˜¯å°†æ‰€æœ‰è¡Œä¸ºçš„Embeddingåšç®€å•çš„Poolingï¼ˆå¦‚Sum/Averageï¼‰ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„â€”â€”ç”¨æˆ·çœ‹è¿‡çš„100ä¸ªè§†é¢‘ï¼Œè·Ÿå½“å‰è¦æ¨èçš„\"è·‘é‹\"å¹¿å‘Šï¼Œç›¸å…³æ€§å¿…ç„¶æœ‰é«˜æœ‰ä½ã€‚**æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttentionï¼‰** çš„å¼•å…¥ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\n#### DINï¼šä¸ºç”¨æˆ·å…´è¶£åŠ¨æ€\"èšç„¦\"\n\n`DIN` (Deep Interest Network) æ˜¯é˜¿é‡Œæå‡ºçš„ã€åœ¨å·¥ä¸šç•Œå½±å“æ·±è¿œçš„æ¨¡å‹ã€‚\n\n-   **æ ¸å¿ƒæ€æƒ³**ï¼šç”¨æˆ·çš„å…´è¶£æ˜¯å¤šæ ·çš„ï¼Œå¹¶ä¸”åœ¨é¢å¯¹ä¸åŒçš„å€™é€‰å•†å“æ—¶ï¼Œç›¸å…³çš„å…´è¶£ç‚¹ä¹Ÿä¸åŒã€‚\n-   **ç²¾é«“**ï¼š\n    1.  ä¸å†å¯¹ç”¨æˆ·å†å²è¡Œä¸ºåšç®€å•çš„Poolingã€‚\n    2.  å¼•å…¥ä¸€ä¸ª\"æ³¨æ„åŠ›å•å…ƒ\"ï¼Œå°†**å€™é€‰å•†å“**ï¼ˆTarget Adï¼‰ä½œä¸ºæŸ¥è¯¢ï¼ˆQueryï¼‰ï¼Œå»åŠ¨æ€åœ°è®¡ç®—ç”¨æˆ·å†å²è¡Œä¸ºåºåˆ—ä¸­æ¯ä¸ªè¡Œä¸ºçš„\"æ³¨æ„åŠ›å¾—åˆ†\"ã€‚\n    3.  å¯¹å†å²è¡Œä¸ºçš„EmbeddingåšåŠ æƒæ±‚å’Œï¼Œæƒé‡å°±æ˜¯æ³¨æ„åŠ›å¾—åˆ†ã€‚è¿™æ ·ï¼Œä¸å½“å‰å€™é€‰å•†å“è¶Šç›¸å…³çš„å†å²è¡Œä¸ºï¼Œæƒé‡å°±è¶Šé«˜ã€‚\n    4.  æœ€åï¼Œå°†è¿™ä¸ª\"èšç„¦\"åçš„ç”¨æˆ·å…´è¶£å‘é‡ï¼Œä¸å…¶ä»–ç‰¹å¾ä¸€èµ·é€å…¥DNNè¿›è¡Œé¢„æµ‹ã€‚\n\n::: details ğŸ’» DIN æ¨¡å‹å®ç° \n```python\nimport torch\nimport torch.nn as nn\nfrom torch_rechub.models.layers import MLP, ActivationUnit, EmbeddingLayer\n\nclass DIN(nn.Module):\n    \"\"\"\n    Deep Interest Network\n    \n    Args:\n        features (list): ç‰¹å¾åˆ—è¡¨ï¼Œéœ€è¦åŒºåˆ†ç›®æ ‡ç‰©å“ã€å†å²åºåˆ—å’Œå…¶ä»–ç‰¹å¾.\n        history_features (list): å†å²è¡Œä¸ºåºåˆ—çš„ç‰¹å¾ååˆ—è¡¨.\n        target_features (list): ç›®æ ‡ç‰©å“çš„ç‰¹å¾ååˆ—è¡¨.\n        mlp_params (dict): MLPçš„å‚æ•°.\n        attention_mlp_params (dict): æ³¨æ„åŠ›å•å…ƒMLPçš„å‚æ•°.\n    \"\"\"\n    def __init__(self, features, history_features, target_features, mlp_params, attention_mlp_params):\n        super().__init__()\n        self.feature_layer = EmbeddingLayer(features)\n        \n        # æ³¨æ„åŠ›å•å…ƒ\n        self.attention_unit = ActivationUnit(\n            embedding_dim=self.feature_layer.get_embedding_dim(target_features),\n            **attention_mlp_params\n        )\n        \n        # æœ€ç»ˆçš„MLP\n        # è¾“å…¥ç»´åº¦ = (ç›®æ ‡ç‰©å“+ä¸Šä¸‹æ–‡ç‰¹å¾) + å†å²åºåˆ—ç‰¹å¾(attentionä¹‹å)\n        self.mlp = MLP(self.get_mlp_input_dim(), **mlp_params)\n        \n    def forward(self, x):\n        # æå–å„ç±»ç‰¹å¾çš„Embedding\n        target_item_emb = self.feature_layer(x, self.target_features)\n        history_seq_emb = self.feature_layer(x, self.history_features)\n        context_emb = self.feature_layer(x, self.get_context_features())\n        \n        # é€šè¿‡æ³¨æ„åŠ›å•å…ƒè®¡ç®—ç”¨æˆ·å…´è¶£å‘é‡\n        user_interest_emb = self.attention_unit(target_item_emb, history_seq_emb)\n        \n        # æ‹¼æ¥æ‰€æœ‰ç‰¹å¾\n        mlp_input = torch.cat([target_item_emb, user_interest_emb, context_emb], dim=1)\n        \n        # æœ€ç»ˆé¢„æµ‹\n        y_pred = self.mlp(mlp_input)\n        return torch.sigmoid(y_pred)\n```\n:::\n\n### å¤šç›®æ ‡æ—¶ä»£ï¼šä¸€ä¸ªæ¨¡å‹ï¼Œå¤šç§ä½¿å‘½\n\nåœ¨çœŸå®çš„ä¸šåŠ¡ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¸åªå…³å¿ƒ\"ç‚¹å‡»ç‡\"ï¼Œè¿˜å…³å¿ƒ\"è½¬åŒ–ç‡\"ã€\"è§‚çœ‹æ—¶é•¿\"ã€\"åˆ†äº«ç‡\"ç­‰å¤šä¸ªæŒ‡æ ‡ã€‚**å¤šä»»åŠ¡å­¦ä¹ ï¼ˆMulti-Task Learning, MTLï¼‰** å°±æ˜¯ä¸ºäº†åŒæ—¶ä¼˜åŒ–è¿™äº›ç›®æ ‡è€Œç”Ÿã€‚\n\n#### MMoEï¼šå·§å¦™å¹³è¡¡å¤šä¸ªä»»åŠ¡çš„\"ä¸“å®¶ç½‘ç»œ\"\n\n`MMoE` (Multi-gate Mixture-of-Experts) æ˜¯Googleæå‡ºçš„ç»å…¸å¤šä»»åŠ¡å­¦ä¹ æ¡†æ¶ã€‚\n\n-   **æ ¸å¿ƒæ€æƒ³**ï¼šä¸åŒçš„ä»»åŠ¡ä¹‹é—´ï¼Œæ—¢æœ‰å…±æ€§ï¼Œä¹Ÿæœ‰ç‰¹æ€§ã€‚å¼ºè¡Œè®©æ‰€æœ‰ä»»åŠ¡å…±äº«ä¸€ä¸ªåº•å±‚ç½‘ç»œï¼ˆShared-Bottomï¼‰å¯èƒ½ä¼šå¯¼è‡´\"è··è··æ¿æ•ˆåº”\"ï¼ˆä¸€ä¸ªä»»åŠ¡æå‡ï¼Œå¦ä¸€ä¸ªä»»åŠ¡ä¸‹é™ï¼‰ã€‚\n-   **ç²¾é«“**ï¼š\n    1.  è®¾ç½®å¤šä¸ª**ä¸“å®¶ç½‘ç»œï¼ˆExpertsï¼‰**ï¼Œæ¯ä¸ªä¸“å®¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å­ç½‘ç»œï¼Œå¯ä»¥å­¦ä¹ åˆ°æŸæ–¹é¢çš„å…±åŒçŸ¥è¯†ã€‚\n    2.  ä¸ºæ¯ä¸ªä»»åŠ¡è®¾ç½®ä¸€ä¸ª**é—¨æ§ç½‘ç»œï¼ˆGateï¼‰**ã€‚è¿™ä¸ªé—¨æ§ç½‘ç»œä¼šæ ¹æ®å½“å‰è¾“å…¥ï¼ŒåŠ¨æ€åœ°ä¸ºæ‰€æœ‰ä¸“å®¶åˆ†é…æƒé‡ã€‚\n    3.  æ¯ä¸ªä»»åŠ¡çš„æœ€ç»ˆè¾“å…¥ï¼Œæ˜¯æ‰€æœ‰ä¸“å®¶è¾“å‡ºçš„åŠ æƒå’Œã€‚è¿™æ ·ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥æŒ‰éœ€ã€çµæ´»åœ°ç»„åˆä¸“å®¶çš„èƒ½åŠ›ï¼Œæ—¢èƒ½å…±äº«ä¿¡æ¯ï¼Œåˆèƒ½ä¿ç•™ä¸ªæ€§ï¼Œæœ‰æ•ˆé¿å…äº†è´Ÿè¿ç§»ã€‚\n\n::: details ğŸ’» MMoE æ¨¡å‹å®ç° \n```python\nimport torch\nimport torch.nn as nn\nfrom torch_rechub.models.layers import MLP, EmbeddingLayer\n\nclass MMoE(nn.Module):\n    \"\"\"\n    Multi-gate Mixture-of-Experts Model\n    \n    Args:\n        features (list): æ‰€æœ‰è¾“å…¥ç‰¹å¾åˆ—è¡¨.\n        task_types (list): ä»»åŠ¡ç±»å‹åˆ—è¡¨, e.g., ['binary', 'binary'].\n        n_expert (int): ä¸“å®¶æ•°é‡.\n        expert_params (dict): æ¯ä¸ªä¸“å®¶ç½‘ç»œçš„MLPå‚æ•°.\n        tower_params_list (list): æ¯ä¸ªä»»åŠ¡å¡”çš„MLPå‚æ•°åˆ—è¡¨.\n    \"\"\"\n    def __init__(self, features, task_types, n_expert, expert_params, tower_params_list):\n        super().__init__()\n        self.feature_layer = EmbeddingLayer(features)\n        self.input_dim = self.feature_layer.input_dim\n        self.n_task = len(task_types)\n        \n        # ä¸“å®¶ç½‘ç»œ\n        self.experts = nn.ModuleList([\n            MLP(self.input_dim, **expert_params) for _ in range(n_expert)\n        ])\n        \n        # é—¨æ§ç½‘ç»œ\n        self.gates = nn.ModuleList([\n            nn.Linear(self.input_dim, n_expert, bias=False) for _ in range(self.n_task)\n        ])\n        \n        # ä»»åŠ¡å¡”\n        self.towers = nn.ModuleList([\n            MLP(expert_params[\"output_dim\"], **tower_params) for tower_params in tower_params_list\n        ])\n        \n    def forward(self, x):\n        input_emb = self.feature_layer(x).flatten(start_dim=1)\n        \n        # ä¸“å®¶è¾“å‡º\n        expert_outputs = [expert(input_emb) for expert in self.experts]\n        expert_outputs = torch.stack(expert_outputs, dim=1) # (batch, n_expert, expert_dim)\n        \n        # é—¨æ§å’Œä»»åŠ¡å¡”è®¡ç®—\n        outputs = []\n        for i in range(self.n_task):\n            gate_value = self.gates[i](input_emb).softmax(dim=1).unsqueeze(-1) # (batch, n_expert, 1)\n            \n            # é—¨æ§åŠ æƒ\n            task_input = torch.sum(expert_outputs * gate_value, dim=1) # (batch, expert_dim)\n            \n            # ä»»åŠ¡å¡”è¾“å‡º\n            task_output = self.towers[i](task_input)\n            outputs.append(task_output)\n            \n        return outputs\n```\n:::\n\n\n## ğŸ“– **å»¶ä¼¸é˜…è¯»**\n1. [Wide & Deep Learning for Recommender Systems](https://arxiv.org/abs/1606.07792) - Wide&Deepçš„å¼€å±±ä¹‹ä½œã€‚\n2. [DeepFM: A Factorization-Machine based Neural Network for CTR Prediction](https://arxiv.org/abs/1703.04247) - DeepFMçš„ç»å…¸è®ºæ–‡ã€‚\n3. [Deep Interest Network for Click-Through Rate Prediction](https://arxiv.org/abs/1706.06978) - DINçš„ç»å…¸è®ºæ–‡ï¼Œå¼€å¯äº†æ·±åº¦å…´è¶£å»ºæ¨¡çš„æ—¶ä»£ã€‚\n4. [Modeling Task Relationships in Multi-task Learning with Multi-gate Mixture-of-Experts](https://dl.acm.org/doi/10.1145/3219819.3220007) - MMoEçš„ç»å…¸è®ºæ–‡ï¼Œå¤šä»»åŠ¡å­¦ä¹ çš„å¿…è¯»æ–‡çŒ®ã€‚\n5. [Torch-RecHub Ranking Models](https://github.com/datawhalechina/torch-rechub/tree/main/torch_rechub/models/ranking) - Datawhaleå¼€æºçš„torch-rechubé¡¹ç›®ä¸­ï¼ŒåŒ…å«äº†å¤šç§ç»å…¸æ’åºæ¨¡å‹çš„PyTorchå®ç°ã€‚\n\n> ğŸ§  **æ€è€ƒé¢˜**\n> \n> 1. DeepFMçš„Embeddingå…±äº«æœºåˆ¶æ˜¯å…¶äº®ç‚¹ï¼Œä½†ä¹Ÿå¯èƒ½å¸¦æ¥å‚æ•°æ›´æ–°çš„å†²çªã€‚ä½ è®¤ä¸ºåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼ŒFMå’ŒDeepéƒ¨åˆ†ä½¿ç”¨ç‹¬ç«‹çš„Embeddingå¯èƒ½ä¼šæ›´å¥½ï¼Ÿ\n> \n> 2. DCNå’ŒxDeepFMéƒ½è‡´åŠ›äºæ˜¾å¼åœ°å­¦ä¹ é«˜é˜¶ç‰¹å¾äº¤å‰ï¼Œå®ƒä»¬çš„æ ¸å¿ƒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨è®¡ç®—æ•ˆç‡å’Œæ•ˆæœä¸Šå„æœ‰ä»€ä¹ˆå–èˆï¼Ÿ\n> \n> 3. DINçš„æ³¨æ„åŠ›æœºåˆ¶æ˜¯é’ˆå¯¹\"ç”¨æˆ·å†å²\"å’Œ\"å€™é€‰å•†å“\"æ¥è®¡ç®—çš„ã€‚ä½ è¿˜èƒ½æƒ³åˆ°å“ªäº›ç‰¹å¾å¯ä»¥å¼•å…¥åˆ°è¿™ä¸ªæ³¨æ„åŠ›è®¡ç®—ä¸­ï¼Œæ¥è¿›ä¸€æ­¥æå‡æ•ˆæœï¼Ÿï¼ˆæ¯”å¦‚ï¼Œä¸Šä¸‹æ–‡ç‰¹å¾ï¼Ÿï¼‰\n> \n> 4. MMoEä¸­çš„\"ä¸“å®¶\"æ•°é‡æ˜¯ä¸€ä¸ªè¶…å‚ï¼Œä½ è®¤ä¸ºå®ƒåº”è¯¥å¦‚ä½•è®¾ç½®ï¼Ÿæ˜¯è¶Šå¤šè¶Šå¥½å—ï¼Ÿå®ƒå’Œä»»åŠ¡çš„ç›¸å…³æ€§æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ\n\n::: tip ğŸ‰ ç« èŠ‚å°ç»“\næ·±åº¦æ’åºæ¨¡å‹çš„æ¼”è¿›å†ç¨‹å±•ç°äº†æ¨èç³»ç»Ÿä»\"æ‰‹å·¥ç‚¼ä¸¹\"åˆ°\"è‡ªåŠ¨é©¾é©¶\"çš„åä¸½è½¬èº«ã€‚Wide&Deepå¥ å®šäº†è®°å¿†ä¸æ³›åŒ–å¹¶é‡çš„åŸºç¡€èŒƒå¼ï¼ŒDeepFMå®ç°äº†ç‰¹å¾äº¤å‰çš„è‡ªåŠ¨åŒ–çªç ´ï¼ŒDINå¼•å…¥æ³¨æ„åŠ›æœºåˆ¶æ•è·åŠ¨æ€å…´è¶£ï¼ŒMMoEå°†å•ä¸€ç›®æ ‡æ‰©å±•ä¸ºå¤šä»»åŠ¡ååŒä¼˜åŒ–ã€‚æ¯ä¸€æ¬¡æ¨¡å‹åˆ›æ–°ï¼Œéƒ½æ˜¯å¯¹ç”¨æˆ·å¤æ‚åå¥½çš„æ›´æ·±å±‚ç†è§£ï¼Œä¹Ÿæ˜¯å¯¹æ¨èç²¾åº¦æé™çš„ä¸æ‡ˆè¿½æ±‚ã€‚æŒæ¡è¿™äº›æ¨¡å‹çš„ç²¾é«“ï¼Œå°±æ˜¯æŒæ¡äº†åœ¨æ¨èç³»ç»Ÿ\"æœ€åä¸€å…¬é‡Œ\"ä¸­ç²¾é›•ç»†ç¢çš„è‰ºæœ¯ã€‚\n:::\n\n---\n\n> \"The devil is in the details.\" â€”â€” Ludwig Mies van der Rohe  \n> åœ¨æ’åºæ¨¡å‹çš„ä¸–ç•Œé‡Œï¼Œé­”é¬¼è—åœ¨ç»†èŠ‚ä¸­ï¼Œè€Œå¤©ä½¿ä¹Ÿåœ¨ç»†èŠ‚ä¸­è¯ç”Ÿã€‚","excerpt":"","includedFiles":[],"tasklistId":0,"title":"","headers":[{"level":2,"title":"ğŸ›ï¸ æ¨¡å‹æ¼”è¿›ä¹‹è·¯ï¼šä»åˆ†ç«‹åˆ°èåˆï¼Œä»äººå·¥åˆ°è‡ªåŠ¨","slug":"ğŸ›ï¸-æ¨¡å‹æ¼”è¿›ä¹‹è·¯-ä»åˆ†ç«‹åˆ°èåˆ-ä»äººå·¥åˆ°è‡ªåŠ¨","link":"#ğŸ›ï¸-æ¨¡å‹æ¼”è¿›ä¹‹è·¯-ä»åˆ†ç«‹åˆ°èåˆ-ä»äººå·¥åˆ°è‡ªåŠ¨","children":[{"level":3,"title":"å¥ åŸºæ—¶ä»£ï¼šWide & Deep â€”â€” \"è®°å¿†\"ä¸\"æ³›åŒ–\"çš„é¦–æ¬¡è”å§»","slug":"å¥ åŸºæ—¶ä»£-wide-deep-â€”â€”-è®°å¿†-ä¸-æ³›åŒ–-çš„é¦–æ¬¡è”å§»","link":"#å¥ åŸºæ—¶ä»£-wide-deep-â€”â€”-è®°å¿†-ä¸-æ³›åŒ–-çš„é¦–æ¬¡è”å§»","children":[]},{"level":3,"title":"äº¤å‰æ—¶ä»£ï¼šå‘Šåˆ«\"äººå·¥ç‚¼ä¸¹\"ï¼Œæ‹¥æŠ±\"è‡ªåŠ¨é©¾é©¶\"","slug":"äº¤å‰æ—¶ä»£-å‘Šåˆ«-äººå·¥ç‚¼ä¸¹-æ‹¥æŠ±-è‡ªåŠ¨é©¾é©¶","link":"#äº¤å‰æ—¶ä»£-å‘Šåˆ«-äººå·¥ç‚¼ä¸¹-æ‹¥æŠ±-è‡ªåŠ¨é©¾é©¶","children":[]},{"level":3,"title":"æ³¨æ„åŠ›æ—¶ä»£ï¼šè®©æ¨¡å‹çŸ¥é“è¯¥\"çœ‹\"å“ªé‡Œ","slug":"æ³¨æ„åŠ›æ—¶ä»£-è®©æ¨¡å‹çŸ¥é“è¯¥-çœ‹-å“ªé‡Œ","link":"#æ³¨æ„åŠ›æ—¶ä»£-è®©æ¨¡å‹çŸ¥é“è¯¥-çœ‹-å“ªé‡Œ","children":[]},{"level":3,"title":"å¤šç›®æ ‡æ—¶ä»£ï¼šä¸€ä¸ªæ¨¡å‹ï¼Œå¤šç§ä½¿å‘½","slug":"å¤šç›®æ ‡æ—¶ä»£-ä¸€ä¸ªæ¨¡å‹-å¤šç§ä½¿å‘½","link":"#å¤šç›®æ ‡æ—¶ä»£-ä¸€ä¸ªæ¨¡å‹-å¤šç§ä½¿å‘½","children":[]}]},{"level":2,"title":"ğŸ“– å»¶ä¼¸é˜…è¯»","slug":"ğŸ“–-å»¶ä¼¸é˜…è¯»","link":"#ğŸ“–-å»¶ä¼¸é˜…è¯»","children":[]}]}}
