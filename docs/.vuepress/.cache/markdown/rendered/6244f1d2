{"content":"<p>åœ¨æ¨èç³»ç»Ÿçš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¯»æ‰¾èƒ½æ›´æ·±åˆ»ç†è§£ç”¨æˆ·ä¸ç‰©å“ä¹‹é—´å¤æ‚å…³ç³»çš„æ–¹æ³•ã€‚ä¼ ç»Ÿçš„ååŒè¿‡æ»¤å…³æ³¨å…±ç°å…³ç³»ï¼Œè€Œæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆå¦‚DINã€BSTï¼‰åˆ™ç²¾äºæ•æ‰åºåˆ—ä¾èµ–ã€‚ç„¶è€Œï¼Œå®ƒä»¬åœ¨æŸç§ç¨‹åº¦ä¸Šéƒ½å°†ç”¨æˆ·å’Œç‰©å“è§†ä¸ºç‹¬ç«‹çš„ä¸ªä½“ï¼Œå¿½ç•¥äº†ä¸€ä¸ªè‡³å…³é‡è¦çš„ä¿¡æ¯ç»´åº¦â€”â€”<strong>è¿æ¥ï¼ˆConnectionsï¼‰</strong>ã€‚</p>\n<p><strong>å›¾ç¥ç»ç½‘ç»œï¼ˆGraph Neural Network, GNNï¼‰</strong> ä¸ºæ¨èç³»ç»Ÿå¸¦æ¥äº†å…¨æ–°çš„ä¸–ç•Œè§‚ã€‚å®ƒä¸å†å°†ç³»ç»Ÿè§†ä¸ºç”¨æˆ·çš„é›†åˆå’Œç‰©å“çš„é›†åˆï¼Œè€Œæ˜¯çœ‹ä½œä¸€ä¸ªç”±ç”¨æˆ·ã€ç‰©å“ä»¥åŠå®ƒä»¬ä¹‹é—´çº·ç¹å¤æ‚çš„äº¤äº’å…³ç³»å…±åŒæ„æˆçš„å·¨å¤§<strong>å›¾ï¼ˆGraphï¼‰</strong>ã€‚åœ¨è¿™ä¸ªè§†è§’ä¸‹ï¼Œç”¨æˆ·çš„å…´è¶£ä¸å†ä»…ä»…ç”±å…¶å†å²è¡Œä¸ºåºåˆ—å®šä¹‰ï¼Œæ›´ç”±å…¶åœ¨æ•´ä¸ª&quot;ä¿¡æ¯ç”Ÿæ€&quot;ä¸­çš„ä½ç½®æ‰€å†³å®šã€‚</p>\n<h3 id=\"ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§\"><span>ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§ï¼Ÿ</span></a></h3>\n<ol>\n<li><strong>è¶…è¶Šä¸€é˜¶å…³ç³»</strong>ï¼šä½ çš„å…´è¶£ä¸ä»…å’Œä½ ç›´æ¥ç‚¹å‡»è¿‡çš„ç‰©å“ï¼ˆä¸€é˜¶é‚»å±…ï¼‰æœ‰å…³ï¼Œä¹Ÿå’Œ&quot;ç‚¹å‡»è¿‡åŒæ ·ç‰©å“çš„å…¶ä»–äºº&quot;ï¼ˆäºŒé˜¶é‚»å±…ï¼‰ä»¥åŠ&quot;é‚£äº›äººè¿˜å–œæ¬¢çš„å…¶ä»–ç‰©å“&quot;ï¼ˆä¸‰é˜¶é‚»å±…ï¼‰æœ‰å…³ã€‚GNNé€šè¿‡åœ¨å›¾ä¸Šä¼ æ’­ä¿¡æ¯ï¼Œèƒ½å¤Ÿè‡ªç„¶åœ°æ•æ‰è¿™ç§<strong>é«˜é˜¶ä¾èµ–ï¼ˆHigh-order Proximityï¼‰</strong>ï¼Œå‘æ˜å‡ºæ›´æ·±å±‚æ¬¡çš„å…³è”ã€‚</li>\n<li><strong>ç»“æ„åŒ–ä¿¡æ¯çš„åŠ›é‡</strong>ï¼šå›¾æœ¬èº«å°±æ˜¯ä¸€ç§å¼ºå¤§çš„ç»“æ„åŒ–ä¿¡æ¯ã€‚èŠ‚ç‚¹çš„åº¦æ•°ã€èšç±»æƒ…å†µã€åœ¨å›¾ä¸­çš„ä¸­å¿ƒæ€§ç­‰æ‹“æ‰‘ç‰¹å¾ï¼Œéƒ½ä¸ºç†è§£èŠ‚ç‚¹ï¼ˆç”¨æˆ·/ç‰©å“ï¼‰çš„å±æ€§æä¾›äº†ä¸°å¯Œçº¿ç´¢ã€‚</li>\n<li><strong>ç»Ÿä¸€çš„å»ºæ¨¡æ¡†æ¶</strong>ï¼šæ— è®ºæ˜¯ç”¨æˆ·ä¸ç‰©å“çš„äº¤äº’ï¼ˆäºŒéƒ¨å›¾ï¼‰ã€ç‰©å“ä¸ç‰©å“çš„ç›¸ä¼¼å…³ç³»ï¼ˆåŒè´¨å›¾ï¼‰ï¼Œè¿˜æ˜¯ç”¨æˆ·ä¹‹é—´çš„ç¤¾äº¤å…³ç³»ï¼ˆç¤¾äº¤ç½‘ç»œï¼‰ï¼Œç”šè‡³æ˜¯åŒ…å«å“ç‰Œã€ç±»åˆ«ç­‰å¤šç§èŠ‚ç‚¹çš„å¤æ‚åœºæ™¯ï¼ˆå¼‚è´¨å›¾ï¼‰ï¼ŒGNNéƒ½èƒ½æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å»ºæ¨¡æ¡†æ¶ã€‚</li>\n</ol>\n<Mermaid id=\"mermaid-26\" code=\"eJx1kstOAjEUhvc+RdONkMAbGBIGENjrirCA0CALgQzDwp0MF0UEjLgRFCSC4oIgkegww+Vl2un4FnY6XGRBF22ac/6v/zmncTGSPgMn3gPAViYbte5Qrw2M6h390qjWwcqQNguktaBaQ28XIE81lzsEsXJFyx+0WSL1EcuAYeB0uoAQgvRhoF//OFmQNHJYvf3ND1j8KCq6bKcZJDqDEjoHQiIdEaWEhIDffNYOw1s2B3kYiBNWINpS8Gy2BpkMC7RH7t364AftLbDa2/FhbvvkvhAkvSYda6RdITPZmGxKCCAJiak4SqJUNrMrR8kYPwWGYH18UcgyT55U/XEEOfTYBomm6oOuZQkrtVVpzQJtTfRanznE6j20c4qHU4xunxSLeNnVcyuKn1He5ENjMsTTT6yW3Hja2VyEw5Xau0cdsNSkPyf1ijnb4sT4fiXzMWlU11of15JeVX+W//sP2iD/E5dWFWb/HMAcggN4IhKKp8QLBxDESDJGh2Wzfe9V40am8pRx/wD4Xhxy\"></Mermaid><h2 id=\"ğŸš€-lightgcn-å¤§é“è‡³ç®€-è¿”ç’å½’çœŸ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸš€-lightgcn-å¤§é“è‡³ç®€-è¿”ç’å½’çœŸ\"><span>ğŸš€ LightGCNï¼šå¤§é“è‡³ç®€ï¼Œè¿”ç’å½’çœŸ</span></a></h2>\n<p>åœ¨GNNçš„æ—©æœŸæ¢ç´¢ä¸­ï¼Œç ”ç©¶è€…ä»¬å€¾å‘äºå°†ç”¨äºè®¡ç®—æœºè§†è§‰æˆ–è‡ªç„¶è¯­è¨€å¤„ç†çš„å¤æ‚GNNæ¨¡å‹ï¼ˆå¦‚GCN, GATï¼‰ç›´æ¥è¿ç§»åˆ°æ¨èåœºæ™¯ã€‚è¿™äº›æ¨¡å‹é€šå¸¸åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒæ“ä½œï¼š<strong>ç‰¹å¾å˜æ¢</strong>ï¼ˆé€šè¿‡æƒé‡çŸ©é˜µ<code v-pre>W</code>ï¼‰ã€<strong>é‚»å±…èšåˆ</strong>ï¼ˆå¦‚æ±‚å’Œæˆ–å–å¹³å‡ï¼‰å’Œ<strong>éçº¿æ€§æ¿€æ´»</strong>ï¼ˆå¦‚<code v-pre>ReLU</code>ï¼‰ã€‚</p>\n<p>ç„¶è€Œï¼Œä½•å‘å—æ•™æˆå›¢é˜Ÿåœ¨2020å¹´æå‡ºçš„ <strong>LightGCN</strong> é¢ è¦†äº†è¿™ä¸€æ€è·¯ã€‚ä»–ä»¬é€šè¿‡å¤§é‡çš„å®éªŒæ•é”åœ°å‘ç°ï¼Œåœ¨æ¨èç³»ç»Ÿçš„ååŒè¿‡æ»¤åœºæ™¯ä¸‹ï¼Œç‰¹å¾å˜æ¢å’Œéçº¿æ€§æ¿€æ´»è¿™ä¸¤ä¸ªæ“ä½œå¯¹äºæ€§èƒ½çš„æå‡æ˜¯<strong>éå¿…è¦ç”šè‡³æœ‰å®³çš„</strong>ã€‚</p>\n<h3 id=\"æ ¸å¿ƒæ€æƒ³-å‡æ³•å³æ˜¯åŠ æ³•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒæ€æƒ³-å‡æ³•å³æ˜¯åŠ æ³•\"><span>æ ¸å¿ƒæ€æƒ³ï¼šå‡æ³•å³æ˜¯åŠ æ³•</span></a></h3>\n<p>LightGCNçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨æ¨èçš„IDç±»ç‰¹å¾ä¸Šï¼Œæˆ‘ä»¬çœŸæ­£éœ€è¦çš„æ˜¯çº¯ç²¹çš„ã€æ— æŸçš„<strong>ä¿¡æ¯ä¼ æ’­ï¼ˆInformation Propagationï¼‰</strong>ï¼Œè€Œä¸æ˜¯å¤æ‚çš„ç‰¹å¾å˜æ¢ã€‚ç”¨æˆ·çš„æœ€ç»ˆåµŒå…¥ï¼Œåº”è¯¥æ˜¯å…¶è‡ªèº«åŸå§‹åµŒå…¥ä¸ä»é‚»å±…èŠ‚ç‚¹ï¼ˆå¦‚å…¶äº¤äº’è¿‡çš„ç‰©å“ï¼‰ä¼ æ’­è¿‡æ¥çš„ä¿¡æ¯çš„çº¿æ€§ç»„åˆã€‚</p>\n<p>å› æ­¤ï¼ŒLightGCNå¤§èƒ†åœ°å»é™¤äº†ç‰¹å¾å˜æ¢å’Œéçº¿æ€§æ¿€æ´»ï¼Œå…¶æ ¸å¿ƒä¼ æ’­å…¬å¼æå…¶ç®€æ´ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>=</mo><munder><mo>âˆ‘</mo><mrow><mi>i</mi><mo>âˆˆ</mo><msub><mi>N</mi><mi>u</mi></msub></mrow></munder><mfrac><mn>1</mn><msqrt><mrow><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>u</mi></msub><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>i</mi></msub><mi mathvariant=\"normal\">âˆ£</mi></mrow></msqrt></mfrac><msubsup><mi>e</mi><mi>i</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow></msubsup><mspace width=\"1em\"/><mtext>å’Œ</mtext><mspace width=\"1em\"/><msubsup><mi>e</mi><mi>i</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>=</mo><munder><mo>âˆ‘</mo><mrow><mi>u</mi><mo>âˆˆ</mo><msub><mi>N</mi><mi>i</mi></msub></mrow></munder><mfrac><mn>1</mn><msqrt><mrow><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>i</mi></msub><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>u</mi></msub><mi mathvariant=\"normal\">âˆ£</mi></mrow></msqrt></mfrac><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow></msubsup></mrow><annotation encoding=\"application/x-tex\">e_u^{(k+1)} = \\sum_{i \\in N_u} \\frac{1}{\\sqrt{|N_u||N_i|}} e_i^{(k)} \\quad \\text{å’Œ} \\quad e_i^{(k+1)} = \\sum_{u \\in N_i} \\frac{1}{\\sqrt{|N_i||N_u|}} e_u^{(k)} \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.185em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.938em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.7159em;vertical-align:-1.3944em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.8557em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.175em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.935em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-2.895em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.305em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.13em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0448em;\"><span style=\"top:-2.4231em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.2198em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2769em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord text\"><span class=\"mord cjk_fallback\">å’Œ</span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0448em;\"><span style=\"top:-2.4231em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.2198em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2769em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.7159em;vertical-align:-1.3944em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.8557em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.175em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.935em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-2.895em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.305em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.13em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.938em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span></span></p>\n<p>å…¶ä¸­ï¼Œ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow></msubsup></mrow><annotation encoding=\"application/x-tex\">e_u^{(k)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1614em;vertical-align:-0.1166em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0448em;\"><span style=\"top:-2.5834em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span><span style=\"top:-3.2198em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1166em;\"><span></span></span></span></span></span></span></span></span></span> æ˜¯ç”¨æˆ· <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> åœ¨ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> å±‚çš„åµŒå…¥ï¼Œ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"script\">N</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathcal{N}_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathcal\" style=\"margin-right:0.14736em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1474em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> æ˜¯ç”¨æˆ· <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> çš„é‚»å±…ï¼ˆç‰©å“ï¼‰é›†åˆã€‚è¿™ä¸ªå…¬å¼æœ¬è´¨ä¸Šå°±æ˜¯åœ¨åš<strong>å½’ä¸€åŒ–åçš„é‚»å±…ä¿¡æ¯èšåˆ</strong>ã€‚ç»è¿‡ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> å±‚ä¼ æ’­åï¼ŒLightGCNå°†æ¯ä¸€å±‚çš„åµŒå…¥è¿›è¡ŒåŠ æƒæ±‚å’Œï¼ˆé€šå¸¸æ˜¯ç®€å•å¹³å‡ï¼‰ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç”¨æˆ·å’Œç‰©å“è¡¨ç¤ºï¼Œç”¨äºè®¡ç®—æ¨èåˆ†æ•°ã€‚</p>\n<details class=\"hint-container details\"><summary>LightGCN å®Œæ•´ PyTorch å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> LightGCN</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_users</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_items</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">64</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_users (int): ç”¨æˆ·æ•°é‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_items (int): ç‰©å“æ•°é‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            adj_matrix (torch.sparse.Tensor): æ ‡å‡†åŒ–çš„é‚»æ¥çŸ©é˜µ D^(-1/2)AD^(-1/2)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            embed_dim (int): åµŒå…¥ç»´åº¦</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_layers (int): å›¾å·ç§¯å±‚æ•°</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">LightGCN</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_users </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_users</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_items </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_items</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adj_matrix </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_matrix</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å®šä¹‰ç”¨æˆ·å’Œç‰©å“çš„åˆå§‹åµŒå…¥ E_0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_embedding </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_users</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">item_embedding </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_items</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # åˆå§‹åŒ–åµŒå…¥æƒé‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">init</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">xavier_uniform_</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">init</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">xavier_uniform_</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">item_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è·å–æ‰€æœ‰èŠ‚ç‚¹çš„åˆå§‹åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # E_0 = [E_U, E_I]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        ego_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">item_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ç”¨äºå­˜å‚¨æ¯ä¸€å±‚ä¼ æ’­åçš„åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        all_layer_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ego_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è¿›è¡Œå¤šå±‚å›¾å·ç§¯ (ä¿¡æ¯ä¼ æ’­)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> layer </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # E_k+1 = A_hat * E_k</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            ego_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adj_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ego_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            all_layer_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ego_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å°†æ‰€æœ‰å±‚çš„åµŒå…¥è¿›è¡ŒåŠ æƒæ±‚å’Œï¼ˆè¿™é‡Œæ˜¯å¹³å‡ï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # E_final = (1/K+1) * (E_0 + E_1 + ... + E_K)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        final_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">all_layer_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä»æœ€ç»ˆåµŒå…¥ä¸­åˆ†ç¦»å‡ºç”¨æˆ·å’Œç‰©å“çš„åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">final_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_users</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_items</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> compute_loss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> user_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pos_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neg_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        è®¡ç®—BPRæŸå¤±</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        u_embeds </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        pos_i_embeds </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">pos_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        neg_i_embeds </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neg_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        pos_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">u_embeds </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pos_i_embeds</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        neg_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">u_embeds </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neg_i_embeds</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # BPR Loss</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        loss </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">pos_scores </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neg_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> loss</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<p>LightGCNçš„æˆåŠŸè¯æ˜äº†ï¼Œåœ¨ç‰¹å®šä»»åŠ¡ä¸­ï¼Œ<strong>é’ˆå¯¹æ€§çš„ç®€åŒ–è¿œèƒœäºç›²ç›®çš„å †ç Œå¤æ‚æ¨¡å—</strong>ã€‚å®ƒä¸ºæ¨èé¢†åŸŸçš„GNNè®¾è®¡æä¾›äº†ä¸€ä¸ªä¼˜é›…ã€é«˜æ•ˆä¸”å¼ºå¤§çš„åŸºçº¿ã€‚</p>\n<h2 id=\"ğŸ­-pinsage-åº”å¯¹web-scaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ­-pinsage-åº”å¯¹web-scaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº\"><span>ğŸ­ PinSageï¼šåº”å¯¹Web-ScaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº</span></a></h2>\n<p>LightGCNè™½ç„¶å¼ºå¤§ï¼Œä½†å®ƒä¾èµ–äºå¯¹æ•´ä¸ªå›¾è¿›è¡Œå…¨é‡è®¡ç®—ï¼ˆfull-batch trainingï¼‰ï¼Œè¿™åœ¨åŠ¨è¾„æ•°åäº¿èŠ‚ç‚¹ã€æ•°ç™¾äº¿è¾¹çš„å·¥ä¸šçº§å¤§å›¾ï¼ˆå¦‚Pinterestã€æ·˜å®ã€å¾®ä¿¡ï¼‰é¢å‰æ˜¯å®Œå…¨ä¸å¯è¡Œçš„ã€‚</p>\n<p><strong>PinSage</strong> æ˜¯ç”±Pinterestå›¢é˜Ÿåœ¨2018å¹´æå‡ºçš„ï¼Œæ˜¯ç¬¬ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸ŠæˆåŠŸåº”ç”¨åˆ°è¶…å¤§è§„æ¨¡å›¾ä¸Šçš„GNNæ¨èæ¨¡å‹ï¼Œæ˜¯GNNå·¥ä¸šè½åœ°çš„é‡è¦é‡Œç¨‹ç¢‘ã€‚å®ƒçš„ä¸€ç³»åˆ—è®¾è®¡ï¼Œæ ¸å¿ƒéƒ½æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼š<strong>å¯æ‰©å±•æ€§ï¼ˆScalabilityï¼‰</strong>ã€‚</p>\n<h3 id=\"æ ¸å¿ƒæ€æƒ³-é‡‡æ ·ä¸èšåˆ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒæ€æƒ³-é‡‡æ ·ä¸èšåˆ\"><span>æ ¸å¿ƒæ€æƒ³ï¼šé‡‡æ ·ä¸èšåˆ</span></a></h3>\n<p>PinSageçš„æ¶æ„å®Œå…¨æ‘’å¼ƒäº†å…¨å›¾è®¡ç®—çš„æ€è·¯ï¼Œè½¬è€Œé‡‡ç”¨<strong>åŸºäºé‡‡æ ·çš„å°æ‰¹é‡ï¼ˆmini-batchï¼‰è®­ç»ƒ</strong>æ¨¡å¼ã€‚å…¶æ ¸å¿ƒåˆ›æ–°å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p>\n<ol>\n<li>\n<p><strong>é‚»å±…é‡‡æ ·ï¼ˆNeighbor Samplingï¼‰</strong>ï¼šå¯¹äºä¸€ä¸ªä¸­å¿ƒèŠ‚ç‚¹ï¼Œä¸æ˜¯èšåˆå®ƒæ‰€æœ‰çš„é‚»å±…ä¿¡æ¯ï¼Œè€Œæ˜¯åª<strong>é‡‡æ ·å›ºå®šæ•°é‡çš„é‚»å±…</strong>ï¼ˆæ¯”å¦‚20ä¸ªï¼‰ã€‚è¿™æ ·ï¼Œæ— è®ºä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šå°‘é‚»å±…ï¼Œå®ƒçš„è®¡ç®—é‡éƒ½æ˜¯æ’å®šçš„ï¼Œä»è€Œè§£å†³äº†&quot;åº¦æ•°çˆ†ç‚¸&quot;é—®é¢˜ã€‚</p>\n</li>\n<li>\n<p><strong>åŸºäºéšæœºæ¸¸èµ°çš„é‡‡æ ·ç­–ç•¥</strong>ï¼šå¦‚ä½•é‡‡æ ·åˆ°&quot;é‡è¦&quot;çš„é‚»å±…ï¼ŸPinSageæ²¡æœ‰ä½¿ç”¨å‡åŒ€é‡‡æ ·ï¼Œè€Œæ˜¯è®¾è®¡äº†ä¸€ç§å·§å¦™çš„<strong>åŸºäºéšæœºæ¸¸èµ°çš„é‡‡æ ·</strong>ã€‚ä»ä¸­å¿ƒèŠ‚ç‚¹å‡ºå‘ï¼Œè¿›è¡Œå¤šæ¬¡çŸ­è·ç¦»çš„éšæœºæ¸¸èµ°ï¼Œå¹¶å°†æ¸¸èµ°ç»è¿‡çš„èŠ‚ç‚¹ä½œä¸ºé‚»å±…ã€‚è¿™ç§æ–¹æ³•èƒ½æ›´æœ‰æ•ˆåœ°é‡‡æ ·åˆ°ä¸ä¸­å¿ƒèŠ‚ç‚¹<strong>ç»“æ„æ›´ç›¸ä¼¼ã€å…³ç³»æ›´ç´§å¯†</strong>çš„èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ä»…ä»…æ˜¯ç›´æ¥ç›¸è¿çš„èŠ‚ç‚¹ã€‚</p>\n</li>\n<li>\n<p><strong>å¤šå±‚èšåˆï¼ˆOn-the-fly Computationï¼‰</strong>ï¼šPinSageçš„è®¡ç®—æ˜¯&quot;å³æ—¶&quot;çš„ã€‚å½“è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹çš„è¡¨ç¤ºæ—¶ï¼Œå®ƒä¼šå…ˆé‡‡æ ·å…¶ä¸€é˜¶é‚»å±…ï¼Œç„¶åä¸ºè¿™äº›é‚»å±…é‡‡æ ·å®ƒä»¬çš„é‚»å±…ï¼ˆå³ä¸­å¿ƒèŠ‚ç‚¹çš„äºŒé˜¶é‚»å±…ï¼‰ï¼Œå±‚å±‚é€’è¿›ã€‚æ•´ä¸ªè®¡ç®—å›¾æ˜¯åœ¨ä¸€ä¸ªæ‰¹æ¬¡ä¸­åŠ¨æ€æ„å»ºçš„ï¼Œè¿™è¢«ç§°ä¸º&quot;on-the-fly&quot;å·ç§¯ã€‚</p>\n</li>\n</ol>\n<details class=\"hint-container details\"><summary>PinSage æ ¸å¿ƒæ€æƒ³å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">functional </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> random</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„å®ç°ï¼Œæ—¨åœ¨è¯´æ˜PinSageçš„æ ¸å¿ƒæ€æƒ³ï¼Œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># å·¥ä¸šçº§çš„å®ç°ä¼šå¤æ‚å¾—å¤šï¼Œå¹¶éœ€è¦é«˜æ•ˆçš„å›¾æ•°æ®åº“æ”¯æŒã€‚</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SAGEConv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    PinSageçš„æ ¸å¿ƒå·ç§¯å±‚ï¼Œèšåˆé‡‡æ ·åˆ°çš„é‚»å±…ä¿¡æ¯</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> out_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SAGEConv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # èšåˆåçš„é‚»å±…ä¿¡æ¯å’ŒèŠ‚ç‚¹è‡ªèº«ä¿¡æ¯æ‹¼æ¥ï¼Œæ‰€ä»¥æ˜¯ in_dim * 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">agg_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_dim </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> out_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> self_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbor_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            self_feats (Tensor): ä¸­å¿ƒèŠ‚ç‚¹è‡ªèº«çš„ç‰¹å¾ [batch_size, in_dim]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            neighbor_feats (Tensor): é‡‡æ ·å¹¶èšåˆåçš„é‚»å±…ç‰¹å¾ [batch_size, in_dim]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        combined </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbor_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ›´æ–°</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        output </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">relu</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">agg_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">combined</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ ‡å‡†åŒ–</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">normalize</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> PinSage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">PinSage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # åˆ›å»ºå¤šå±‚SAGEConv</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            layer_in_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SAGEConv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layer_in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_samples_per_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        PinSageçš„å‰å‘ä¼ æ’­</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            node_ids (list): ä¸€ä¸ªmini-batchçš„ä¸­å¿ƒèŠ‚ç‚¹ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            full_feature_matrix (Tensor): åŒ…å«æ‰€æœ‰èŠ‚ç‚¹ç‰¹å¾çš„çŸ©é˜µ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            adj_list (dict): å›¾çš„é‚»æ¥è¡¨è¡¨ç¤º {node_id: [neighbor1, neighbor2, ...]}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_samples_per_layer (list): æ¯å±‚è¦é‡‡æ ·çš„é‚»å±…æ•°é‡, e.g., [20, 10] for 2 layers</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # h_l æ˜¯ç¬¬ l å±‚éœ€è¦çš„èŠ‚ç‚¹ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        h </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä»æœ€å¤–å±‚ (ç¬¬ k å±‚) å‘å†…å±‚ (ç¬¬ 1 å±‚) èšåˆ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> l </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # è·å–å½“å‰å±‚è®¡ç®—æ‰€éœ€è¦çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆä¸Šä¸€å±‚èšåˆçš„ç»“æœï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            current_nodes </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> h</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # å‡è®¾håŒ…å«äº†å½“å‰å±‚éœ€è¦çš„æ‰€æœ‰èŠ‚ç‚¹çš„ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # 1. é‡‡æ ·é‚»å±…</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            sampled_neighbors </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">            for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> node_id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # éå†æ‰¹æ¬¡ä¸­çš„æ¯ä¸ªä¸­å¿ƒèŠ‚ç‚¹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                neighbors </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">node_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                if</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> len</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_samples_per_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">l</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    sampled </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> random</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_samples_per_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">l</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                else</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    sampled </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbors </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ä¸è¶³åˆ™å…¨éƒ¨é‡‡æ ·</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                sampled_neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sampled</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # 2. è·å–é‚»å±…ç‰¹å¾å¹¶èšåˆï¼ˆè¿™é‡Œç®€åŒ–ä¸ºå¹³å‡èšåˆï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            neighbor_feats_list </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">            for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbors </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sampled_neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    neighbor_feats_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                else</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # å¤„ç†å­¤ç«‹ç‚¹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    neighbor_feats_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros_like</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            aggregated_neighbors </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbor_feats_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # 3. èšåˆè‡ªèº«ä¸é‚»å±…ï¼Œé€šè¿‡SAGEConvå±‚æ›´æ–°</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # æ³¨æ„ï¼šè¿™é‡Œçš„ h éœ€è¦æ­£ç¡®å¯¹åº”ä¸Š</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            self_feats </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # è·å–ä¸­å¿ƒèŠ‚ç‚¹å½“å‰å±‚çš„ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            h </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">l</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">](</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> aggregated_neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            node_ids </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # ... æ›´æ–°ä¸‹ä¸€å±‚éœ€è¦è®¡ç®—çš„èŠ‚ç‚¹ ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> h</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<p>PinSageä¸ä»…æä¾›äº†ä¸€ä¸ªå¯æ‰©å±•çš„GNNæ¶æ„ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå±•ç¤ºäº†ä¸€æ•´å¥—å°†GNNåº”ç”¨äºçœŸå®ã€æµ·é‡ã€å¤æ‚å·¥ä¸šåœºæ™¯çš„<strong>å·¥ç¨‹èŒƒå¼</strong>ï¼ŒåŒ…æ‹¬é‡‡æ ·ã€è´Ÿé‡‡æ ·ã€æ¨¡å‹éƒ¨ç½²ç­‰ï¼Œå½±å“æ·±è¿œã€‚</p>\n<h2 id=\"ğŸŒˆ-han-æ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸŒˆ-han-æ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§\"><span>ğŸŒˆ HANï¼šæ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§</span></a></h2>\n<p>ç°å®ä¸–ç•Œçš„å›¾å¾ˆå°‘æ˜¯åŒè´¨çš„ã€‚ä¸€ä¸ªç”µå•†æ¨èåœºæ™¯çš„å›¾ï¼Œè‡³å°‘åŒ…å«ç”¨æˆ·ã€ç‰©å“ã€å“ç‰Œã€ç±»åˆ«ç­‰å¤šç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œä»¥åŠç‚¹å‡»ã€è´­ä¹°ã€å±äºï¼ˆç‰©å“å±äºæŸç±»åˆ«ï¼‰ç­‰å¤šç§ç±»å‹çš„è¾¹ã€‚è¿™ç§å›¾è¢«ç§°ä¸º<strong>å¼‚è´¨ä¿¡æ¯ç½‘ç»œï¼ˆHeterogeneous Information Network, HINï¼‰</strong>ã€‚</p>\n<p>ç”¨åŒè´¨å›¾æ¨¡å‹ï¼ˆå¦‚LightGCNï¼‰æ¥å¤„ç†HINï¼Œä¼šä¸¢å¤±æ‰èŠ‚ç‚¹å’Œè¾¹çš„ç±»å‹ä¿¡æ¯ï¼Œæ— æ³•åŒºåˆ†&quot;ç”¨æˆ·è´­ä¹°ç‰©å“&quot;å’Œ&quot;ç‰©å“å±äºæŸå“ç‰Œ&quot;è¿™ä¸¤ç§å…³ç³»çš„è¯­ä¹‰å·®å¼‚ã€‚<strong>HAN (Heterogeneous Graph Attention Network)</strong> å°±æ˜¯ä¸ºè§£å†³è¿™ä¸€é—®é¢˜è€Œè®¾è®¡çš„ã€‚</p>\n<h3 id=\"æ ¸å¿ƒæ€æƒ³-åŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒæ€æƒ³-åŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›\"><span>æ ¸å¿ƒæ€æƒ³ï¼šåŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›</span></a></h3>\n<p>HANçš„ç²¾é«“åœ¨äºå…¶**å±‚æ¬¡åŒ–æ³¨æ„åŠ›ï¼ˆHierarchical Attentionï¼‰**æœºåˆ¶ï¼Œå®ƒåˆ†ä¸ºä¸¤ä¸ªå±‚çº§ï¼š</p>\n<ol>\n<li>\n<p><strong>èŠ‚ç‚¹çº§æ³¨æ„åŠ›ï¼ˆNode-level Attentionï¼‰</strong>ï¼šé¦–å…ˆï¼Œå®šä¹‰è‹¥å¹²æ¡<strong>å…ƒè·¯å¾„ï¼ˆMeta-pathï¼‰</strong>ã€‚å…ƒè·¯å¾„æ˜¯è¿æ¥ä¸åŒç±»å‹èŠ‚ç‚¹çš„è·¯å¾„ï¼Œä¾‹å¦‚ <code v-pre>ç”¨æˆ·-ç‰©å“-ç”¨æˆ·</code> (U-I-U) è¿™æ¡å…ƒè·¯å¾„å¯ä»¥æ•æ‰åˆ°&quot;è´­ä¹°äº†ç›¸åŒç‰©å“&quot;çš„ç›¸ä¼¼ç”¨æˆ·ã€‚æ²¿ç€æ¯ä¸€æ¡å…ƒè·¯å¾„ï¼ŒHANä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶èšåˆé‚»å±…èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆä¸€ä¸ªåŸºäºç‰¹å®šå…ƒè·¯å¾„çš„åµŒå…¥ã€‚</p>\n</li>\n<li>\n<p><strong>è¯­ä¹‰çº§æ³¨æ„åŠ›ï¼ˆSemantic-level Attentionï¼‰</strong>ï¼šä¸€ä¸ªèŠ‚ç‚¹é€šè¿‡ä¸åŒçš„å…ƒè·¯å¾„ï¼Œä¼šå¾—åˆ°å¤šä¸ªä¸åŒè¯­ä¹‰çš„åµŒå…¥ï¼ˆå¦‚åŸºäºU-I-Uçš„åµŒå…¥å’ŒåŸºäºU-C-Uçš„åµŒå…¥ï¼‰ã€‚è¿™äº›ä¸åŒè¯­ä¹‰çš„é‡è¦æ€§æ˜¾ç„¶æ˜¯ä¸åŒçš„ã€‚å› æ­¤ï¼ŒHANå¼•å…¥äº†ç¬¬äºŒå±‚æ³¨æ„åŠ›ï¼Œå³è¯­ä¹‰çº§æ³¨æ„åŠ›ï¼Œæ¥å­¦ä¹ ä¸åŒå…ƒè·¯å¾„çš„é‡è¦æ€§æƒé‡ï¼Œæœ€ç»ˆå°†å¤šä¸ªè¯­ä¹‰åµŒå…¥åŠ æƒèåˆæˆä¸€ä¸ªç»Ÿä¸€çš„èŠ‚ç‚¹è¡¨ç¤ºã€‚</p>\n</li>\n</ol>\n<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒHANèƒ½å¤Ÿæ™ºèƒ½åœ°è¯†åˆ«å¹¶èåˆæ¥è‡ªä¸åŒç±»å‹å…³ç³»çš„ä¿¡æ¯ï¼Œä»è€Œå­¦ä¹ åˆ°æ›´ä¸°å¯Œã€æ›´å…·è¡¨ç°åŠ›çš„èŠ‚ç‚¹è¡¨ç¤ºã€‚</p>\n<details class=\"hint-container details\"><summary>HAN æ ¸å¿ƒæ€æƒ³å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">functional </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SemanticAttention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    HANä¸­çš„è¯­ä¹‰å±‚æ³¨æ„åŠ›ï¼Œç”¨äºèåˆä¸åŒå…ƒè·¯å¾„å¸¦æ¥çš„åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">128</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SemanticAttention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">project </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Sequential</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Tanh</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> bias</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        )</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # zæ˜¯ [num_nodes, num_metapaths, in_dim]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è®¡ç®—æ¯ä¸ªå…ƒè·¯å¾„çš„é‡è¦æ€§ w_phi = q^T * tanh(W*z_phi + b)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        w </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">project</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">                    # [num_metapaths, 1]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        beta </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">w</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">                 # [num_metapaths, 1]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        beta </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beta</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expand</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">shape</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beta</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">shape</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # [num_nodes, num_metapaths, 1]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # åŠ æƒæ±‚å’Œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">beta </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">                       # [num_nodes, in_dim]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HANLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_metapaths</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> out_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_heads</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">HANLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # èŠ‚ç‚¹çº§æ³¨æ„åŠ›å±‚ (ä¸ºæ¯ç§å…ƒè·¯å¾„åˆ›å»ºä¸€ä¸ªGATå±‚)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gat_layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # è¿™é‡Œçš„GATConvéœ€è¦èƒ½å¤„ç†å¼‚è´¨å›¾çš„è¾¹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # åœ¨å®è·µä¸­ä¼šç”¨PyGæˆ–DGLç­‰åº“ä¸­çš„HANConvæˆ–HGTConv</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # GraphAttentionLayer(in_dim, out_dim, num_heads) for _ in range(num_metapaths)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è¯­ä¹‰çº§æ³¨æ„åŠ›å±‚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_attention </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> SemanticAttention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">out_dim </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_heads</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> g</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> h</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # gæ˜¯å¼‚è´¨å›¾, hæ˜¯èŠ‚ç‚¹ç‰¹å¾å­—å…¸</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        semantic_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å¯¹æ¯ä¸ªå…ƒè·¯å¾„ï¼ˆè¾¹ç±»å‹ï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> gat_layer </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> enumerate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gat_layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # ä½¿ç”¨å¯¹åº”çš„GATå±‚è¿›è¡ŒèŠ‚ç‚¹çº§èšåˆ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # semantic_embeddings.append(gat_layer(g.edge_type_subgraph([edge_type]), h))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">            pass</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # ä¼ªä»£ç </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å°†ä¸åŒå…ƒè·¯å¾„çš„åµŒå…¥å †å èµ·æ¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        semantic_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # [N, num_metapaths, D_out]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é€šè¿‡è¯­ä¹‰æ³¨æ„åŠ›è¿›è¡Œèåˆ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_attention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h2 id=\"âš”ï¸-gnnçš„ç°ä»£è®­ç»ƒå¿ƒæ³•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#âš”ï¸-gnnçš„ç°ä»£è®­ç»ƒå¿ƒæ³•\"><span>âš”ï¸ GNNçš„ç°ä»£è®­ç»ƒå¿ƒæ³•</span></a></h2>\n<p>é™¤äº†æ¨¡å‹æ¶æ„ï¼ŒGNNçš„è®­ç»ƒæ–¹å¼ä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ã€‚ç°ä»£çš„GNNè®­ç»ƒï¼Œå°¤å…¶æ˜¯è‡ªç›‘ç£å­¦ä¹ çš„å¼•å…¥ï¼Œæå¤§åœ°æå‡äº†æ¨¡å‹çš„æ€§èƒ½å’Œé²æ£’æ€§ã€‚</p>\n<h3 id=\"å›¾å¯¹æ¯”å­¦ä¹ -graph-contrastive-learning\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å›¾å¯¹æ¯”å­¦ä¹ -graph-contrastive-learning\"><span>å›¾å¯¹æ¯”å­¦ä¹ ï¼ˆGraph Contrastive Learningï¼‰</span></a></h3>\n<p>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>åœ¨åµŒå…¥ç©ºé—´ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„&quot;å¢å¼ºè§†å›¾&quot;åº”è¯¥ä¸å®ƒè‡ªèº«çš„å…¶ä»–&quot;å¢å¼ºè§†å›¾&quot;å°½å¯èƒ½ç›¸ä¼¼ï¼Œè€Œä¸å…¶ä»–èŠ‚ç‚¹çš„è§†å›¾å°½å¯èƒ½è¿œç¦»ã€‚</strong></p>\n<ul>\n<li><strong>å›¾å¢å¼ºï¼ˆGraph Augmentationï¼‰</strong>ï¼šå¦‚ä½•åˆ›é€ &quot;å¢å¼ºè§†å›¾&quot;ï¼Ÿé€šå¸¸é€šè¿‡å¯¹åŸå›¾è¿›è¡Œéšæœºæ‰°åŠ¨ï¼Œå¦‚<strong>éšæœºåˆ è¾¹ï¼ˆEdge Droppingï¼‰</strong>ã€ <strong>éšæœºèŠ‚ç‚¹ä¸¢å¼ƒï¼ˆNode Droppingï¼‰</strong> æˆ– <strong>ç‰¹å¾æ©ç ï¼ˆFeature Maskingï¼‰</strong> æ¥ç”Ÿæˆä¸¤ä¸ªç›¸å…³çš„å­å›¾ã€‚</li>\n<li><strong>å¯¹æ¯”æŸå¤±ï¼ˆContrastive Lossï¼‰</strong> ï¼šå°†æ¥è‡ªåŒä¸€åŸå§‹èŠ‚ç‚¹çš„è¡¨ç¤ºä½œä¸º<strong>æ­£æ ·æœ¬å¯¹</strong>ï¼Œæ¥è‡ªä¸åŒèŠ‚ç‚¹çš„è¡¨ç¤ºä½œä¸º<strong>è´Ÿæ ·æœ¬å¯¹</strong>ã€‚ç„¶åä½¿ç”¨InfoNCEç­‰å¯¹æ¯”æŸå¤±å‡½æ•°ï¼Œåœ¨åµŒå…¥ç©ºé—´ä¸­æ‹‰è¿‘æ­£æ ·æœ¬ï¼Œæ¨å¼€è´Ÿæ ·æœ¬ã€‚</li>\n</ul>\n<p>è¿™ç§è‡ªç›‘ç£çš„è®­ç»ƒæ–¹å¼ï¼Œå¯ä»¥å¸®åŠ©GNNå­¦ä¹ åˆ°å¯¹å™ªå£°ä¸æ•æ„Ÿçš„ã€æ›´å…·æœ¬è´¨æ€§çš„ç»“æ„ä¿¡æ¯ï¼Œå³ä½¿åœ¨æ ‡ç­¾æ•°æ®ç¨€ç–çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å–å¾—ä¼˜å¼‚æ•ˆæœã€‚</p>\n<details class=\"hint-container details\"><summary>å›¾å¯¹æ¯”å­¦ä¹ æŸå¤± (InfoNCE)</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> GraphContrastiveLoss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> temperature</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0.1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">GraphContrastiveLoss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">temperature </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> temperature</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">criterion </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">CrossEntropyLoss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            z1, z2: ä¸¤ä¸ªå›¾å¢å¼ºè§†å›¾çš„èŠ‚ç‚¹åµŒå…¥, shape [N, D]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        sim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">normalize</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">normalize</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">T</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">temperature</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ­£æ ·æœ¬åœ¨å¯¹è§’çº¿ä¸Š</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        labels </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">arange</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">to</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">device</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è®¡ç®—æŸå¤±</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        loss </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">criterion</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> labels</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> loss</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h2 id=\"ğŸ“–-å»¶ä¼¸é˜…è¯»\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ“–-å»¶ä¼¸é˜…è¯»\"><span>ğŸ“– å»¶ä¼¸é˜…è¯»</span></a></h2>\n<p><strong>ç»å…¸è®ºæ–‡</strong>ï¼š</p>\n<ul>\n<li><a href=\"https://arxiv.org/abs/2002.02126\" target=\"_blank\" rel=\"noopener noreferrer\">LightGCN: Simplifying and Powering Graph Convolution Network for Recommendation (SIGIR'20)</a></li>\n<li><a href=\"https://arxiv.org/abs/1806.01973\" target=\"_blank\" rel=\"noopener noreferrer\">Graph Convolutional Neural Networks for Web-Scale Recommender Systems (KDD'18, PinSage)</a></li>\n<li><a href=\"https://arxiv.org/abs/1903.07293\" target=\"_blank\" rel=\"noopener noreferrer\">Heterogeneous Graph Attention Network (WWW'19, HAN)</a></li>\n<li><a href=\"https://arxiv.org/abs/2010.10783\" target=\"_blank\" rel=\"noopener noreferrer\">Self-supervised Graph Learning for Recommendation (SIGIR'21, SGL)</a></li>\n</ul>\n<p><strong>å¼€æºæ¡†æ¶</strong>ï¼š</p>\n<ul>\n<li><a href=\"https://github.com/pyg-team/pytorch_geometric\" target=\"_blank\" rel=\"noopener noreferrer\">PyTorch Geometric (PyG)</a>ï¼šæœ€æµè¡Œçš„GNNåº“ä¹‹ä¸€ï¼Œæä¾›äº†å¤§é‡GNNæ¨¡å‹å’Œå·¥å…·ã€‚</li>\n<li><a href=\"https://github.com/dmlc/dgl\" target=\"_blank\" rel=\"noopener noreferrer\">DGL (Deep Graph Library)</a>ï¼šå¦ä¸€ä¸ªå¼ºå¤§çš„å›¾å­¦ä¹ æ¡†æ¶ï¼Œæ”¯æŒå¤šç§åç«¯ã€‚</li>\n<li><a href=\"https://github.com/RUCAIBox/RecBole\" target=\"_blank\" rel=\"noopener noreferrer\">RecBole</a>ï¼šä¸€ä¸ªç»Ÿä¸€ã€å…¨é¢çš„æ¨èç®—æ³•å¤ç°åº“ï¼ŒåŒ…å«äº†å¤šç§GNNæ¨¡å‹ã€‚</li>\n</ul>\n<blockquote>\n<p>ğŸ§  <strong>æ€è€ƒé¢˜</strong></p>\n<ol>\n<li><strong>LightGCN vs. GCN</strong>ï¼šä½ è®¤ä¸ºLightGCNç§»é™¤çš„éçº¿æ€§å’Œç‰¹å¾å˜æ¢ï¼Œä¸ºä»€ä¹ˆåœ¨ååŒè¿‡æ»¤åœºæ™¯ä¸‹æ˜¯&quot;å¤šä½™&quot;çš„ï¼Ÿå®ƒå¯èƒ½åœ¨ä»€ä¹ˆç±»å‹çš„å›¾æ•°æ®ä¸Šè¡¨ç°ä¸ä½³ï¼Ÿ</li>\n<li><strong>é‡‡æ ·ç­–ç•¥çš„æƒè¡¡</strong>ï¼šPinSageçš„éšæœºæ¸¸èµ°é‡‡æ ·ç›¸æ¯”å‡åŒ€é‚»å±…é‡‡æ ·ï¼Œå…¶ä¼˜åŠ¿å’ŒåŠ£åŠ¿åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½ å¯èƒ½ä¼šé€‰æ‹©åè€…ï¼Ÿ</li>\n<li><strong>å†·å¯åŠ¨é—®é¢˜</strong>ï¼šå¯¹äºä¸€ä¸ªæ²¡æœ‰ä»»ä½•äº¤äº’çš„æ–°ç”¨æˆ·ï¼ˆ&quot;å†·å¯åŠ¨&quot;ç”¨æˆ·ï¼‰ï¼ŒGNNæ¨¡å‹ï¼ˆç‰¹åˆ«æ˜¯LightGCNï¼‰å°†å¦‚ä½•ä¸ºä»–ç”ŸæˆåµŒå…¥å¹¶è¿›è¡Œæ¨èï¼Ÿä½ æœ‰ä»€ä¹ˆæ”¹è¿›çš„æ€è·¯å—ï¼Ÿ</li>\n<li><strong>å…ƒè·¯å¾„çš„è®¾è®¡</strong>ï¼šåœ¨ä¸€ä¸ªåŒ…å«&quot;ç”¨æˆ·-æœç´¢-ç‰©å“-è´­ä¹°&quot;è¡Œä¸ºçš„ç”µå•†åœºæ™¯ä¸­ï¼Œè¯·ä½ è®¾è®¡è‡³å°‘ä¸‰æ¡æœ‰æ„ä¹‰çš„å…ƒè·¯å¾„ï¼Œå¹¶è¯´æ˜å®ƒä»¬å„è‡ªèƒ½æ•æ‰åˆ°ä»€ä¹ˆæ¨èä¿¡å·ã€‚</li>\n<li><strong>å›¾å¢å¼ºçš„é£é™©</strong>ï¼šå›¾å¯¹æ¯”å­¦ä¹ ä¸­çš„æ•°æ®å¢å¼ºï¼ˆå¦‚åˆ è¾¹ã€åˆ ç‚¹ï¼‰å¦‚æœæ“ä½œä¸å½“ï¼Œå¯èƒ½ä¼šç ´åå›¾çš„å…³é”®ç»“æ„ä¿¡æ¯ã€‚ä½ è®¤ä¸ºè¯¥å¦‚ä½•è®¾ç½®å¢å¼ºçš„å¼ºåº¦ï¼ˆæ¯”å¦‚åˆ é™¤æ¯”ä¾‹ï¼‰ï¼Œä»¥åœ¨&quot;åˆ›é€ å¤šæ ·æ€§&quot;å’Œ&quot;ä¿æŒç»“æ„&quot;ä¹‹é—´å–å¾—å¹³è¡¡ï¼Ÿ</li>\n</ol>\n</blockquote>\n","env":{"base":"/search-rec-ads-cosmos-explorer/","filePath":"D:/softwore/user/git/work_code/WeBotDoc/docs/zh/3.ç¬¬ä¸‰ç« ï¼šæ¨èç®—æ³•--æ¯”ä½ æ›´æ‡‚ä½ çš„è´´å¿ƒå°æ£‰è¢„/2.æ·±åº¦å­¦ä¹ æ–‡è‰ºå¤å…´/7.gnn_models.md","filePathRelative":"zh/3.ç¬¬ä¸‰ç« ï¼šæ¨èç®—æ³•--æ¯”ä½ æ›´æ‡‚ä½ çš„è´´å¿ƒå°æ£‰è¢„/2.æ·±åº¦å­¦ä¹ æ–‡è‰ºå¤å…´/7.gnn_models.md","frontmatter":{"title":"å›¾ç¥ç»ç½‘ç»œï¼šå‘æ˜è¿æ¥çš„åŠ›é‡","createTime":"2025/06/05 09:34:56"},"sfcBlocks":{"template":{"type":"template","content":"<template><p>åœ¨æ¨èç³»ç»Ÿçš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¯»æ‰¾èƒ½æ›´æ·±åˆ»ç†è§£ç”¨æˆ·ä¸ç‰©å“ä¹‹é—´å¤æ‚å…³ç³»çš„æ–¹æ³•ã€‚ä¼ ç»Ÿçš„ååŒè¿‡æ»¤å…³æ³¨å…±ç°å…³ç³»ï¼Œè€Œæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆå¦‚DINã€BSTï¼‰åˆ™ç²¾äºæ•æ‰åºåˆ—ä¾èµ–ã€‚ç„¶è€Œï¼Œå®ƒä»¬åœ¨æŸç§ç¨‹åº¦ä¸Šéƒ½å°†ç”¨æˆ·å’Œç‰©å“è§†ä¸ºç‹¬ç«‹çš„ä¸ªä½“ï¼Œå¿½ç•¥äº†ä¸€ä¸ªè‡³å…³é‡è¦çš„ä¿¡æ¯ç»´åº¦â€”â€”<strong>è¿æ¥ï¼ˆConnectionsï¼‰</strong>ã€‚</p>\n<p><strong>å›¾ç¥ç»ç½‘ç»œï¼ˆGraph Neural Network, GNNï¼‰</strong> ä¸ºæ¨èç³»ç»Ÿå¸¦æ¥äº†å…¨æ–°çš„ä¸–ç•Œè§‚ã€‚å®ƒä¸å†å°†ç³»ç»Ÿè§†ä¸ºç”¨æˆ·çš„é›†åˆå’Œç‰©å“çš„é›†åˆï¼Œè€Œæ˜¯çœ‹ä½œä¸€ä¸ªç”±ç”¨æˆ·ã€ç‰©å“ä»¥åŠå®ƒä»¬ä¹‹é—´çº·ç¹å¤æ‚çš„äº¤äº’å…³ç³»å…±åŒæ„æˆçš„å·¨å¤§<strong>å›¾ï¼ˆGraphï¼‰</strong>ã€‚åœ¨è¿™ä¸ªè§†è§’ä¸‹ï¼Œç”¨æˆ·çš„å…´è¶£ä¸å†ä»…ä»…ç”±å…¶å†å²è¡Œä¸ºåºåˆ—å®šä¹‰ï¼Œæ›´ç”±å…¶åœ¨æ•´ä¸ª&quot;ä¿¡æ¯ç”Ÿæ€&quot;ä¸­çš„ä½ç½®æ‰€å†³å®šã€‚</p>\n<h3 id=\"ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§\"><span>ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§ï¼Ÿ</span></a></h3>\n<ol>\n<li><strong>è¶…è¶Šä¸€é˜¶å…³ç³»</strong>ï¼šä½ çš„å…´è¶£ä¸ä»…å’Œä½ ç›´æ¥ç‚¹å‡»è¿‡çš„ç‰©å“ï¼ˆä¸€é˜¶é‚»å±…ï¼‰æœ‰å…³ï¼Œä¹Ÿå’Œ&quot;ç‚¹å‡»è¿‡åŒæ ·ç‰©å“çš„å…¶ä»–äºº&quot;ï¼ˆäºŒé˜¶é‚»å±…ï¼‰ä»¥åŠ&quot;é‚£äº›äººè¿˜å–œæ¬¢çš„å…¶ä»–ç‰©å“&quot;ï¼ˆä¸‰é˜¶é‚»å±…ï¼‰æœ‰å…³ã€‚GNNé€šè¿‡åœ¨å›¾ä¸Šä¼ æ’­ä¿¡æ¯ï¼Œèƒ½å¤Ÿè‡ªç„¶åœ°æ•æ‰è¿™ç§<strong>é«˜é˜¶ä¾èµ–ï¼ˆHigh-order Proximityï¼‰</strong>ï¼Œå‘æ˜å‡ºæ›´æ·±å±‚æ¬¡çš„å…³è”ã€‚</li>\n<li><strong>ç»“æ„åŒ–ä¿¡æ¯çš„åŠ›é‡</strong>ï¼šå›¾æœ¬èº«å°±æ˜¯ä¸€ç§å¼ºå¤§çš„ç»“æ„åŒ–ä¿¡æ¯ã€‚èŠ‚ç‚¹çš„åº¦æ•°ã€èšç±»æƒ…å†µã€åœ¨å›¾ä¸­çš„ä¸­å¿ƒæ€§ç­‰æ‹“æ‰‘ç‰¹å¾ï¼Œéƒ½ä¸ºç†è§£èŠ‚ç‚¹ï¼ˆç”¨æˆ·/ç‰©å“ï¼‰çš„å±æ€§æä¾›äº†ä¸°å¯Œçº¿ç´¢ã€‚</li>\n<li><strong>ç»Ÿä¸€çš„å»ºæ¨¡æ¡†æ¶</strong>ï¼šæ— è®ºæ˜¯ç”¨æˆ·ä¸ç‰©å“çš„äº¤äº’ï¼ˆäºŒéƒ¨å›¾ï¼‰ã€ç‰©å“ä¸ç‰©å“çš„ç›¸ä¼¼å…³ç³»ï¼ˆåŒè´¨å›¾ï¼‰ï¼Œè¿˜æ˜¯ç”¨æˆ·ä¹‹é—´çš„ç¤¾äº¤å…³ç³»ï¼ˆç¤¾äº¤ç½‘ç»œï¼‰ï¼Œç”šè‡³æ˜¯åŒ…å«å“ç‰Œã€ç±»åˆ«ç­‰å¤šç§èŠ‚ç‚¹çš„å¤æ‚åœºæ™¯ï¼ˆå¼‚è´¨å›¾ï¼‰ï¼ŒGNNéƒ½èƒ½æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å»ºæ¨¡æ¡†æ¶ã€‚</li>\n</ol>\n<Mermaid id=\"mermaid-26\" code=\"eJx1kstOAjEUhvc+RdONkMAbGBIGENjrirCA0CALgQzDwp0MF0UEjLgRFCSC4oIgkegww+Vl2un4FnY6XGRBF22ac/6v/zmncTGSPgMn3gPAViYbte5Qrw2M6h390qjWwcqQNguktaBaQ28XIE81lzsEsXJFyx+0WSL1EcuAYeB0uoAQgvRhoF//OFmQNHJYvf3ND1j8KCq6bKcZJDqDEjoHQiIdEaWEhIDffNYOw1s2B3kYiBNWINpS8Gy2BpkMC7RH7t364AftLbDa2/FhbvvkvhAkvSYda6RdITPZmGxKCCAJiak4SqJUNrMrR8kYPwWGYH18UcgyT55U/XEEOfTYBomm6oOuZQkrtVVpzQJtTfRanznE6j20c4qHU4xunxSLeNnVcyuKn1He5ENjMsTTT6yW3Hja2VyEw5Xau0cdsNSkPyf1ijnb4sT4fiXzMWlU11of15JeVX+W//sP2iD/E5dWFWb/HMAcggN4IhKKp8QLBxDESDJGh2Wzfe9V40am8pRx/wD4Xhxy\"></Mermaid><h2 id=\"ğŸš€-lightgcn-å¤§é“è‡³ç®€-è¿”ç’å½’çœŸ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸš€-lightgcn-å¤§é“è‡³ç®€-è¿”ç’å½’çœŸ\"><span>ğŸš€ LightGCNï¼šå¤§é“è‡³ç®€ï¼Œè¿”ç’å½’çœŸ</span></a></h2>\n<p>åœ¨GNNçš„æ—©æœŸæ¢ç´¢ä¸­ï¼Œç ”ç©¶è€…ä»¬å€¾å‘äºå°†ç”¨äºè®¡ç®—æœºè§†è§‰æˆ–è‡ªç„¶è¯­è¨€å¤„ç†çš„å¤æ‚GNNæ¨¡å‹ï¼ˆå¦‚GCN, GATï¼‰ç›´æ¥è¿ç§»åˆ°æ¨èåœºæ™¯ã€‚è¿™äº›æ¨¡å‹é€šå¸¸åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒæ“ä½œï¼š<strong>ç‰¹å¾å˜æ¢</strong>ï¼ˆé€šè¿‡æƒé‡çŸ©é˜µ<code v-pre>W</code>ï¼‰ã€<strong>é‚»å±…èšåˆ</strong>ï¼ˆå¦‚æ±‚å’Œæˆ–å–å¹³å‡ï¼‰å’Œ<strong>éçº¿æ€§æ¿€æ´»</strong>ï¼ˆå¦‚<code v-pre>ReLU</code>ï¼‰ã€‚</p>\n<p>ç„¶è€Œï¼Œä½•å‘å—æ•™æˆå›¢é˜Ÿåœ¨2020å¹´æå‡ºçš„ <strong>LightGCN</strong> é¢ è¦†äº†è¿™ä¸€æ€è·¯ã€‚ä»–ä»¬é€šè¿‡å¤§é‡çš„å®éªŒæ•é”åœ°å‘ç°ï¼Œåœ¨æ¨èç³»ç»Ÿçš„ååŒè¿‡æ»¤åœºæ™¯ä¸‹ï¼Œç‰¹å¾å˜æ¢å’Œéçº¿æ€§æ¿€æ´»è¿™ä¸¤ä¸ªæ“ä½œå¯¹äºæ€§èƒ½çš„æå‡æ˜¯<strong>éå¿…è¦ç”šè‡³æœ‰å®³çš„</strong>ã€‚</p>\n<h3 id=\"æ ¸å¿ƒæ€æƒ³-å‡æ³•å³æ˜¯åŠ æ³•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒæ€æƒ³-å‡æ³•å³æ˜¯åŠ æ³•\"><span>æ ¸å¿ƒæ€æƒ³ï¼šå‡æ³•å³æ˜¯åŠ æ³•</span></a></h3>\n<p>LightGCNçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨æ¨èçš„IDç±»ç‰¹å¾ä¸Šï¼Œæˆ‘ä»¬çœŸæ­£éœ€è¦çš„æ˜¯çº¯ç²¹çš„ã€æ— æŸçš„<strong>ä¿¡æ¯ä¼ æ’­ï¼ˆInformation Propagationï¼‰</strong>ï¼Œè€Œä¸æ˜¯å¤æ‚çš„ç‰¹å¾å˜æ¢ã€‚ç”¨æˆ·çš„æœ€ç»ˆåµŒå…¥ï¼Œåº”è¯¥æ˜¯å…¶è‡ªèº«åŸå§‹åµŒå…¥ä¸ä»é‚»å±…èŠ‚ç‚¹ï¼ˆå¦‚å…¶äº¤äº’è¿‡çš„ç‰©å“ï¼‰ä¼ æ’­è¿‡æ¥çš„ä¿¡æ¯çš„çº¿æ€§ç»„åˆã€‚</p>\n<p>å› æ­¤ï¼ŒLightGCNå¤§èƒ†åœ°å»é™¤äº†ç‰¹å¾å˜æ¢å’Œéçº¿æ€§æ¿€æ´»ï¼Œå…¶æ ¸å¿ƒä¼ æ’­å…¬å¼æå…¶ç®€æ´ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>=</mo><munder><mo>âˆ‘</mo><mrow><mi>i</mi><mo>âˆˆ</mo><msub><mi>N</mi><mi>u</mi></msub></mrow></munder><mfrac><mn>1</mn><msqrt><mrow><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>u</mi></msub><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>i</mi></msub><mi mathvariant=\"normal\">âˆ£</mi></mrow></msqrt></mfrac><msubsup><mi>e</mi><mi>i</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow></msubsup><mspace width=\"1em\"/><mtext>å’Œ</mtext><mspace width=\"1em\"/><msubsup><mi>e</mi><mi>i</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>=</mo><munder><mo>âˆ‘</mo><mrow><mi>u</mi><mo>âˆˆ</mo><msub><mi>N</mi><mi>i</mi></msub></mrow></munder><mfrac><mn>1</mn><msqrt><mrow><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>i</mi></msub><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>u</mi></msub><mi mathvariant=\"normal\">âˆ£</mi></mrow></msqrt></mfrac><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow></msubsup></mrow><annotation encoding=\"application/x-tex\">e_u^{(k+1)} = \\sum_{i \\in N_u} \\frac{1}{\\sqrt{|N_u||N_i|}} e_i^{(k)} \\quad \\text{å’Œ} \\quad e_i^{(k+1)} = \\sum_{u \\in N_i} \\frac{1}{\\sqrt{|N_i||N_u|}} e_u^{(k)} \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.185em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.938em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.7159em;vertical-align:-1.3944em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.8557em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.175em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.935em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-2.895em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.305em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.13em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0448em;\"><span style=\"top:-2.4231em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.2198em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2769em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord text\"><span class=\"mord cjk_fallback\">å’Œ</span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0448em;\"><span style=\"top:-2.4231em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.2198em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2769em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.7159em;vertical-align:-1.3944em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.8557em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.175em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.935em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-2.895em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.305em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.13em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.938em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span></span></p>\n<p>å…¶ä¸­ï¼Œ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow></msubsup></mrow><annotation encoding=\"application/x-tex\">e_u^{(k)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1614em;vertical-align:-0.1166em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0448em;\"><span style=\"top:-2.5834em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span><span style=\"top:-3.2198em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1166em;\"><span></span></span></span></span></span></span></span></span></span> æ˜¯ç”¨æˆ· <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> åœ¨ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> å±‚çš„åµŒå…¥ï¼Œ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"script\">N</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathcal{N}_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathcal\" style=\"margin-right:0.14736em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1474em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> æ˜¯ç”¨æˆ· <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> çš„é‚»å±…ï¼ˆç‰©å“ï¼‰é›†åˆã€‚è¿™ä¸ªå…¬å¼æœ¬è´¨ä¸Šå°±æ˜¯åœ¨åš<strong>å½’ä¸€åŒ–åçš„é‚»å±…ä¿¡æ¯èšåˆ</strong>ã€‚ç»è¿‡ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> å±‚ä¼ æ’­åï¼ŒLightGCNå°†æ¯ä¸€å±‚çš„åµŒå…¥è¿›è¡ŒåŠ æƒæ±‚å’Œï¼ˆé€šå¸¸æ˜¯ç®€å•å¹³å‡ï¼‰ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç”¨æˆ·å’Œç‰©å“è¡¨ç¤ºï¼Œç”¨äºè®¡ç®—æ¨èåˆ†æ•°ã€‚</p>\n<details class=\"hint-container details\"><summary>LightGCN å®Œæ•´ PyTorch å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> LightGCN</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_users</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_items</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">64</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_users (int): ç”¨æˆ·æ•°é‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_items (int): ç‰©å“æ•°é‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            adj_matrix (torch.sparse.Tensor): æ ‡å‡†åŒ–çš„é‚»æ¥çŸ©é˜µ D^(-1/2)AD^(-1/2)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            embed_dim (int): åµŒå…¥ç»´åº¦</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_layers (int): å›¾å·ç§¯å±‚æ•°</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">LightGCN</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_users </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_users</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_items </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_items</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adj_matrix </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_matrix</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å®šä¹‰ç”¨æˆ·å’Œç‰©å“çš„åˆå§‹åµŒå…¥ E_0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_embedding </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_users</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">item_embedding </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_items</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # åˆå§‹åŒ–åµŒå…¥æƒé‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">init</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">xavier_uniform_</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">init</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">xavier_uniform_</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">item_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è·å–æ‰€æœ‰èŠ‚ç‚¹çš„åˆå§‹åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # E_0 = [E_U, E_I]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        ego_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">item_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ç”¨äºå­˜å‚¨æ¯ä¸€å±‚ä¼ æ’­åçš„åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        all_layer_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ego_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è¿›è¡Œå¤šå±‚å›¾å·ç§¯ (ä¿¡æ¯ä¼ æ’­)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> layer </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # E_k+1 = A_hat * E_k</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            ego_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adj_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ego_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            all_layer_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ego_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å°†æ‰€æœ‰å±‚çš„åµŒå…¥è¿›è¡ŒåŠ æƒæ±‚å’Œï¼ˆè¿™é‡Œæ˜¯å¹³å‡ï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # E_final = (1/K+1) * (E_0 + E_1 + ... + E_K)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        final_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">all_layer_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä»æœ€ç»ˆåµŒå…¥ä¸­åˆ†ç¦»å‡ºç”¨æˆ·å’Œç‰©å“çš„åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">final_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_users</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_items</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> compute_loss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> user_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pos_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neg_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        è®¡ç®—BPRæŸå¤±</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        u_embeds </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        pos_i_embeds </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">pos_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        neg_i_embeds </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neg_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        pos_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">u_embeds </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pos_i_embeds</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        neg_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">u_embeds </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neg_i_embeds</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # BPR Loss</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        loss </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">pos_scores </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neg_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> loss</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<p>LightGCNçš„æˆåŠŸè¯æ˜äº†ï¼Œåœ¨ç‰¹å®šä»»åŠ¡ä¸­ï¼Œ<strong>é’ˆå¯¹æ€§çš„ç®€åŒ–è¿œèƒœäºç›²ç›®çš„å †ç Œå¤æ‚æ¨¡å—</strong>ã€‚å®ƒä¸ºæ¨èé¢†åŸŸçš„GNNè®¾è®¡æä¾›äº†ä¸€ä¸ªä¼˜é›…ã€é«˜æ•ˆä¸”å¼ºå¤§çš„åŸºçº¿ã€‚</p>\n<h2 id=\"ğŸ­-pinsage-åº”å¯¹web-scaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ­-pinsage-åº”å¯¹web-scaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº\"><span>ğŸ­ PinSageï¼šåº”å¯¹Web-ScaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº</span></a></h2>\n<p>LightGCNè™½ç„¶å¼ºå¤§ï¼Œä½†å®ƒä¾èµ–äºå¯¹æ•´ä¸ªå›¾è¿›è¡Œå…¨é‡è®¡ç®—ï¼ˆfull-batch trainingï¼‰ï¼Œè¿™åœ¨åŠ¨è¾„æ•°åäº¿èŠ‚ç‚¹ã€æ•°ç™¾äº¿è¾¹çš„å·¥ä¸šçº§å¤§å›¾ï¼ˆå¦‚Pinterestã€æ·˜å®ã€å¾®ä¿¡ï¼‰é¢å‰æ˜¯å®Œå…¨ä¸å¯è¡Œçš„ã€‚</p>\n<p><strong>PinSage</strong> æ˜¯ç”±Pinterestå›¢é˜Ÿåœ¨2018å¹´æå‡ºçš„ï¼Œæ˜¯ç¬¬ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸ŠæˆåŠŸåº”ç”¨åˆ°è¶…å¤§è§„æ¨¡å›¾ä¸Šçš„GNNæ¨èæ¨¡å‹ï¼Œæ˜¯GNNå·¥ä¸šè½åœ°çš„é‡è¦é‡Œç¨‹ç¢‘ã€‚å®ƒçš„ä¸€ç³»åˆ—è®¾è®¡ï¼Œæ ¸å¿ƒéƒ½æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼š<strong>å¯æ‰©å±•æ€§ï¼ˆScalabilityï¼‰</strong>ã€‚</p>\n<h3 id=\"æ ¸å¿ƒæ€æƒ³-é‡‡æ ·ä¸èšåˆ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒæ€æƒ³-é‡‡æ ·ä¸èšåˆ\"><span>æ ¸å¿ƒæ€æƒ³ï¼šé‡‡æ ·ä¸èšåˆ</span></a></h3>\n<p>PinSageçš„æ¶æ„å®Œå…¨æ‘’å¼ƒäº†å…¨å›¾è®¡ç®—çš„æ€è·¯ï¼Œè½¬è€Œé‡‡ç”¨<strong>åŸºäºé‡‡æ ·çš„å°æ‰¹é‡ï¼ˆmini-batchï¼‰è®­ç»ƒ</strong>æ¨¡å¼ã€‚å…¶æ ¸å¿ƒåˆ›æ–°å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p>\n<ol>\n<li>\n<p><strong>é‚»å±…é‡‡æ ·ï¼ˆNeighbor Samplingï¼‰</strong>ï¼šå¯¹äºä¸€ä¸ªä¸­å¿ƒèŠ‚ç‚¹ï¼Œä¸æ˜¯èšåˆå®ƒæ‰€æœ‰çš„é‚»å±…ä¿¡æ¯ï¼Œè€Œæ˜¯åª<strong>é‡‡æ ·å›ºå®šæ•°é‡çš„é‚»å±…</strong>ï¼ˆæ¯”å¦‚20ä¸ªï¼‰ã€‚è¿™æ ·ï¼Œæ— è®ºä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šå°‘é‚»å±…ï¼Œå®ƒçš„è®¡ç®—é‡éƒ½æ˜¯æ’å®šçš„ï¼Œä»è€Œè§£å†³äº†&quot;åº¦æ•°çˆ†ç‚¸&quot;é—®é¢˜ã€‚</p>\n</li>\n<li>\n<p><strong>åŸºäºéšæœºæ¸¸èµ°çš„é‡‡æ ·ç­–ç•¥</strong>ï¼šå¦‚ä½•é‡‡æ ·åˆ°&quot;é‡è¦&quot;çš„é‚»å±…ï¼ŸPinSageæ²¡æœ‰ä½¿ç”¨å‡åŒ€é‡‡æ ·ï¼Œè€Œæ˜¯è®¾è®¡äº†ä¸€ç§å·§å¦™çš„<strong>åŸºäºéšæœºæ¸¸èµ°çš„é‡‡æ ·</strong>ã€‚ä»ä¸­å¿ƒèŠ‚ç‚¹å‡ºå‘ï¼Œè¿›è¡Œå¤šæ¬¡çŸ­è·ç¦»çš„éšæœºæ¸¸èµ°ï¼Œå¹¶å°†æ¸¸èµ°ç»è¿‡çš„èŠ‚ç‚¹ä½œä¸ºé‚»å±…ã€‚è¿™ç§æ–¹æ³•èƒ½æ›´æœ‰æ•ˆåœ°é‡‡æ ·åˆ°ä¸ä¸­å¿ƒèŠ‚ç‚¹<strong>ç»“æ„æ›´ç›¸ä¼¼ã€å…³ç³»æ›´ç´§å¯†</strong>çš„èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ä»…ä»…æ˜¯ç›´æ¥ç›¸è¿çš„èŠ‚ç‚¹ã€‚</p>\n</li>\n<li>\n<p><strong>å¤šå±‚èšåˆï¼ˆOn-the-fly Computationï¼‰</strong>ï¼šPinSageçš„è®¡ç®—æ˜¯&quot;å³æ—¶&quot;çš„ã€‚å½“è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹çš„è¡¨ç¤ºæ—¶ï¼Œå®ƒä¼šå…ˆé‡‡æ ·å…¶ä¸€é˜¶é‚»å±…ï¼Œç„¶åä¸ºè¿™äº›é‚»å±…é‡‡æ ·å®ƒä»¬çš„é‚»å±…ï¼ˆå³ä¸­å¿ƒèŠ‚ç‚¹çš„äºŒé˜¶é‚»å±…ï¼‰ï¼Œå±‚å±‚é€’è¿›ã€‚æ•´ä¸ªè®¡ç®—å›¾æ˜¯åœ¨ä¸€ä¸ªæ‰¹æ¬¡ä¸­åŠ¨æ€æ„å»ºçš„ï¼Œè¿™è¢«ç§°ä¸º&quot;on-the-fly&quot;å·ç§¯ã€‚</p>\n</li>\n</ol>\n<details class=\"hint-container details\"><summary>PinSage æ ¸å¿ƒæ€æƒ³å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">functional </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> random</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„å®ç°ï¼Œæ—¨åœ¨è¯´æ˜PinSageçš„æ ¸å¿ƒæ€æƒ³ï¼Œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># å·¥ä¸šçº§çš„å®ç°ä¼šå¤æ‚å¾—å¤šï¼Œå¹¶éœ€è¦é«˜æ•ˆçš„å›¾æ•°æ®åº“æ”¯æŒã€‚</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SAGEConv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    PinSageçš„æ ¸å¿ƒå·ç§¯å±‚ï¼Œèšåˆé‡‡æ ·åˆ°çš„é‚»å±…ä¿¡æ¯</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> out_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SAGEConv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # èšåˆåçš„é‚»å±…ä¿¡æ¯å’ŒèŠ‚ç‚¹è‡ªèº«ä¿¡æ¯æ‹¼æ¥ï¼Œæ‰€ä»¥æ˜¯ in_dim * 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">agg_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_dim </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> out_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> self_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbor_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            self_feats (Tensor): ä¸­å¿ƒèŠ‚ç‚¹è‡ªèº«çš„ç‰¹å¾ [batch_size, in_dim]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            neighbor_feats (Tensor): é‡‡æ ·å¹¶èšåˆåçš„é‚»å±…ç‰¹å¾ [batch_size, in_dim]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        combined </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbor_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ›´æ–°</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        output </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">relu</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">agg_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">combined</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ ‡å‡†åŒ–</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">normalize</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> PinSage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">PinSage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # åˆ›å»ºå¤šå±‚SAGEConv</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            layer_in_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SAGEConv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layer_in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_samples_per_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        PinSageçš„å‰å‘ä¼ æ’­</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            node_ids (list): ä¸€ä¸ªmini-batchçš„ä¸­å¿ƒèŠ‚ç‚¹ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            full_feature_matrix (Tensor): åŒ…å«æ‰€æœ‰èŠ‚ç‚¹ç‰¹å¾çš„çŸ©é˜µ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            adj_list (dict): å›¾çš„é‚»æ¥è¡¨è¡¨ç¤º {node_id: [neighbor1, neighbor2, ...]}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_samples_per_layer (list): æ¯å±‚è¦é‡‡æ ·çš„é‚»å±…æ•°é‡, e.g., [20, 10] for 2 layers</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # h_l æ˜¯ç¬¬ l å±‚éœ€è¦çš„èŠ‚ç‚¹ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        h </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä»æœ€å¤–å±‚ (ç¬¬ k å±‚) å‘å†…å±‚ (ç¬¬ 1 å±‚) èšåˆ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> l </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # è·å–å½“å‰å±‚è®¡ç®—æ‰€éœ€è¦çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆä¸Šä¸€å±‚èšåˆçš„ç»“æœï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            current_nodes </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> h</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # å‡è®¾håŒ…å«äº†å½“å‰å±‚éœ€è¦çš„æ‰€æœ‰èŠ‚ç‚¹çš„ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # 1. é‡‡æ ·é‚»å±…</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            sampled_neighbors </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">            for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> node_id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # éå†æ‰¹æ¬¡ä¸­çš„æ¯ä¸ªä¸­å¿ƒèŠ‚ç‚¹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                neighbors </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">node_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                if</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> len</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_samples_per_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">l</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    sampled </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> random</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_samples_per_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">l</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                else</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    sampled </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbors </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ä¸è¶³åˆ™å…¨éƒ¨é‡‡æ ·</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                sampled_neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sampled</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # 2. è·å–é‚»å±…ç‰¹å¾å¹¶èšåˆï¼ˆè¿™é‡Œç®€åŒ–ä¸ºå¹³å‡èšåˆï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            neighbor_feats_list </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">            for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbors </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sampled_neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    neighbor_feats_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                else</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # å¤„ç†å­¤ç«‹ç‚¹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    neighbor_feats_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros_like</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            aggregated_neighbors </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbor_feats_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # 3. èšåˆè‡ªèº«ä¸é‚»å±…ï¼Œé€šè¿‡SAGEConvå±‚æ›´æ–°</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # æ³¨æ„ï¼šè¿™é‡Œçš„ h éœ€è¦æ­£ç¡®å¯¹åº”ä¸Š</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            self_feats </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # è·å–ä¸­å¿ƒèŠ‚ç‚¹å½“å‰å±‚çš„ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            h </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">l</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">](</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> aggregated_neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            node_ids </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # ... æ›´æ–°ä¸‹ä¸€å±‚éœ€è¦è®¡ç®—çš„èŠ‚ç‚¹ ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> h</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<p>PinSageä¸ä»…æä¾›äº†ä¸€ä¸ªå¯æ‰©å±•çš„GNNæ¶æ„ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå±•ç¤ºäº†ä¸€æ•´å¥—å°†GNNåº”ç”¨äºçœŸå®ã€æµ·é‡ã€å¤æ‚å·¥ä¸šåœºæ™¯çš„<strong>å·¥ç¨‹èŒƒå¼</strong>ï¼ŒåŒ…æ‹¬é‡‡æ ·ã€è´Ÿé‡‡æ ·ã€æ¨¡å‹éƒ¨ç½²ç­‰ï¼Œå½±å“æ·±è¿œã€‚</p>\n<h2 id=\"ğŸŒˆ-han-æ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸŒˆ-han-æ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§\"><span>ğŸŒˆ HANï¼šæ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§</span></a></h2>\n<p>ç°å®ä¸–ç•Œçš„å›¾å¾ˆå°‘æ˜¯åŒè´¨çš„ã€‚ä¸€ä¸ªç”µå•†æ¨èåœºæ™¯çš„å›¾ï¼Œè‡³å°‘åŒ…å«ç”¨æˆ·ã€ç‰©å“ã€å“ç‰Œã€ç±»åˆ«ç­‰å¤šç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œä»¥åŠç‚¹å‡»ã€è´­ä¹°ã€å±äºï¼ˆç‰©å“å±äºæŸç±»åˆ«ï¼‰ç­‰å¤šç§ç±»å‹çš„è¾¹ã€‚è¿™ç§å›¾è¢«ç§°ä¸º<strong>å¼‚è´¨ä¿¡æ¯ç½‘ç»œï¼ˆHeterogeneous Information Network, HINï¼‰</strong>ã€‚</p>\n<p>ç”¨åŒè´¨å›¾æ¨¡å‹ï¼ˆå¦‚LightGCNï¼‰æ¥å¤„ç†HINï¼Œä¼šä¸¢å¤±æ‰èŠ‚ç‚¹å’Œè¾¹çš„ç±»å‹ä¿¡æ¯ï¼Œæ— æ³•åŒºåˆ†&quot;ç”¨æˆ·è´­ä¹°ç‰©å“&quot;å’Œ&quot;ç‰©å“å±äºæŸå“ç‰Œ&quot;è¿™ä¸¤ç§å…³ç³»çš„è¯­ä¹‰å·®å¼‚ã€‚<strong>HAN (Heterogeneous Graph Attention Network)</strong> å°±æ˜¯ä¸ºè§£å†³è¿™ä¸€é—®é¢˜è€Œè®¾è®¡çš„ã€‚</p>\n<h3 id=\"æ ¸å¿ƒæ€æƒ³-åŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒæ€æƒ³-åŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›\"><span>æ ¸å¿ƒæ€æƒ³ï¼šåŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›</span></a></h3>\n<p>HANçš„ç²¾é«“åœ¨äºå…¶**å±‚æ¬¡åŒ–æ³¨æ„åŠ›ï¼ˆHierarchical Attentionï¼‰**æœºåˆ¶ï¼Œå®ƒåˆ†ä¸ºä¸¤ä¸ªå±‚çº§ï¼š</p>\n<ol>\n<li>\n<p><strong>èŠ‚ç‚¹çº§æ³¨æ„åŠ›ï¼ˆNode-level Attentionï¼‰</strong>ï¼šé¦–å…ˆï¼Œå®šä¹‰è‹¥å¹²æ¡<strong>å…ƒè·¯å¾„ï¼ˆMeta-pathï¼‰</strong>ã€‚å…ƒè·¯å¾„æ˜¯è¿æ¥ä¸åŒç±»å‹èŠ‚ç‚¹çš„è·¯å¾„ï¼Œä¾‹å¦‚ <code v-pre>ç”¨æˆ·-ç‰©å“-ç”¨æˆ·</code> (U-I-U) è¿™æ¡å…ƒè·¯å¾„å¯ä»¥æ•æ‰åˆ°&quot;è´­ä¹°äº†ç›¸åŒç‰©å“&quot;çš„ç›¸ä¼¼ç”¨æˆ·ã€‚æ²¿ç€æ¯ä¸€æ¡å…ƒè·¯å¾„ï¼ŒHANä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶èšåˆé‚»å±…èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆä¸€ä¸ªåŸºäºç‰¹å®šå…ƒè·¯å¾„çš„åµŒå…¥ã€‚</p>\n</li>\n<li>\n<p><strong>è¯­ä¹‰çº§æ³¨æ„åŠ›ï¼ˆSemantic-level Attentionï¼‰</strong>ï¼šä¸€ä¸ªèŠ‚ç‚¹é€šè¿‡ä¸åŒçš„å…ƒè·¯å¾„ï¼Œä¼šå¾—åˆ°å¤šä¸ªä¸åŒè¯­ä¹‰çš„åµŒå…¥ï¼ˆå¦‚åŸºäºU-I-Uçš„åµŒå…¥å’ŒåŸºäºU-C-Uçš„åµŒå…¥ï¼‰ã€‚è¿™äº›ä¸åŒè¯­ä¹‰çš„é‡è¦æ€§æ˜¾ç„¶æ˜¯ä¸åŒçš„ã€‚å› æ­¤ï¼ŒHANå¼•å…¥äº†ç¬¬äºŒå±‚æ³¨æ„åŠ›ï¼Œå³è¯­ä¹‰çº§æ³¨æ„åŠ›ï¼Œæ¥å­¦ä¹ ä¸åŒå…ƒè·¯å¾„çš„é‡è¦æ€§æƒé‡ï¼Œæœ€ç»ˆå°†å¤šä¸ªè¯­ä¹‰åµŒå…¥åŠ æƒèåˆæˆä¸€ä¸ªç»Ÿä¸€çš„èŠ‚ç‚¹è¡¨ç¤ºã€‚</p>\n</li>\n</ol>\n<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒHANèƒ½å¤Ÿæ™ºèƒ½åœ°è¯†åˆ«å¹¶èåˆæ¥è‡ªä¸åŒç±»å‹å…³ç³»çš„ä¿¡æ¯ï¼Œä»è€Œå­¦ä¹ åˆ°æ›´ä¸°å¯Œã€æ›´å…·è¡¨ç°åŠ›çš„èŠ‚ç‚¹è¡¨ç¤ºã€‚</p>\n<details class=\"hint-container details\"><summary>HAN æ ¸å¿ƒæ€æƒ³å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">functional </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SemanticAttention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    HANä¸­çš„è¯­ä¹‰å±‚æ³¨æ„åŠ›ï¼Œç”¨äºèåˆä¸åŒå…ƒè·¯å¾„å¸¦æ¥çš„åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">128</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SemanticAttention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">project </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Sequential</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Tanh</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> bias</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        )</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # zæ˜¯ [num_nodes, num_metapaths, in_dim]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è®¡ç®—æ¯ä¸ªå…ƒè·¯å¾„çš„é‡è¦æ€§ w_phi = q^T * tanh(W*z_phi + b)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        w </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">project</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">                    # [num_metapaths, 1]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        beta </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">w</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">                 # [num_metapaths, 1]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        beta </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beta</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expand</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">shape</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beta</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">shape</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # [num_nodes, num_metapaths, 1]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # åŠ æƒæ±‚å’Œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">beta </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">                       # [num_nodes, in_dim]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HANLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_metapaths</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> out_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_heads</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">HANLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # èŠ‚ç‚¹çº§æ³¨æ„åŠ›å±‚ (ä¸ºæ¯ç§å…ƒè·¯å¾„åˆ›å»ºä¸€ä¸ªGATå±‚)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gat_layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # è¿™é‡Œçš„GATConvéœ€è¦èƒ½å¤„ç†å¼‚è´¨å›¾çš„è¾¹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # åœ¨å®è·µä¸­ä¼šç”¨PyGæˆ–DGLç­‰åº“ä¸­çš„HANConvæˆ–HGTConv</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # GraphAttentionLayer(in_dim, out_dim, num_heads) for _ in range(num_metapaths)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è¯­ä¹‰çº§æ³¨æ„åŠ›å±‚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_attention </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> SemanticAttention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">out_dim </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_heads</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> g</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> h</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # gæ˜¯å¼‚è´¨å›¾, hæ˜¯èŠ‚ç‚¹ç‰¹å¾å­—å…¸</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        semantic_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å¯¹æ¯ä¸ªå…ƒè·¯å¾„ï¼ˆè¾¹ç±»å‹ï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> gat_layer </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> enumerate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gat_layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # ä½¿ç”¨å¯¹åº”çš„GATå±‚è¿›è¡ŒèŠ‚ç‚¹çº§èšåˆ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # semantic_embeddings.append(gat_layer(g.edge_type_subgraph([edge_type]), h))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">            pass</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # ä¼ªä»£ç </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å°†ä¸åŒå…ƒè·¯å¾„çš„åµŒå…¥å †å èµ·æ¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        semantic_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # [N, num_metapaths, D_out]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é€šè¿‡è¯­ä¹‰æ³¨æ„åŠ›è¿›è¡Œèåˆ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_attention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h2 id=\"âš”ï¸-gnnçš„ç°ä»£è®­ç»ƒå¿ƒæ³•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#âš”ï¸-gnnçš„ç°ä»£è®­ç»ƒå¿ƒæ³•\"><span>âš”ï¸ GNNçš„ç°ä»£è®­ç»ƒå¿ƒæ³•</span></a></h2>\n<p>é™¤äº†æ¨¡å‹æ¶æ„ï¼ŒGNNçš„è®­ç»ƒæ–¹å¼ä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ã€‚ç°ä»£çš„GNNè®­ç»ƒï¼Œå°¤å…¶æ˜¯è‡ªç›‘ç£å­¦ä¹ çš„å¼•å…¥ï¼Œæå¤§åœ°æå‡äº†æ¨¡å‹çš„æ€§èƒ½å’Œé²æ£’æ€§ã€‚</p>\n<h3 id=\"å›¾å¯¹æ¯”å­¦ä¹ -graph-contrastive-learning\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å›¾å¯¹æ¯”å­¦ä¹ -graph-contrastive-learning\"><span>å›¾å¯¹æ¯”å­¦ä¹ ï¼ˆGraph Contrastive Learningï¼‰</span></a></h3>\n<p>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>åœ¨åµŒå…¥ç©ºé—´ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„&quot;å¢å¼ºè§†å›¾&quot;åº”è¯¥ä¸å®ƒè‡ªèº«çš„å…¶ä»–&quot;å¢å¼ºè§†å›¾&quot;å°½å¯èƒ½ç›¸ä¼¼ï¼Œè€Œä¸å…¶ä»–èŠ‚ç‚¹çš„è§†å›¾å°½å¯èƒ½è¿œç¦»ã€‚</strong></p>\n<ul>\n<li><strong>å›¾å¢å¼ºï¼ˆGraph Augmentationï¼‰</strong>ï¼šå¦‚ä½•åˆ›é€ &quot;å¢å¼ºè§†å›¾&quot;ï¼Ÿé€šå¸¸é€šè¿‡å¯¹åŸå›¾è¿›è¡Œéšæœºæ‰°åŠ¨ï¼Œå¦‚<strong>éšæœºåˆ è¾¹ï¼ˆEdge Droppingï¼‰</strong>ã€ <strong>éšæœºèŠ‚ç‚¹ä¸¢å¼ƒï¼ˆNode Droppingï¼‰</strong> æˆ– <strong>ç‰¹å¾æ©ç ï¼ˆFeature Maskingï¼‰</strong> æ¥ç”Ÿæˆä¸¤ä¸ªç›¸å…³çš„å­å›¾ã€‚</li>\n<li><strong>å¯¹æ¯”æŸå¤±ï¼ˆContrastive Lossï¼‰</strong> ï¼šå°†æ¥è‡ªåŒä¸€åŸå§‹èŠ‚ç‚¹çš„è¡¨ç¤ºä½œä¸º<strong>æ­£æ ·æœ¬å¯¹</strong>ï¼Œæ¥è‡ªä¸åŒèŠ‚ç‚¹çš„è¡¨ç¤ºä½œä¸º<strong>è´Ÿæ ·æœ¬å¯¹</strong>ã€‚ç„¶åä½¿ç”¨InfoNCEç­‰å¯¹æ¯”æŸå¤±å‡½æ•°ï¼Œåœ¨åµŒå…¥ç©ºé—´ä¸­æ‹‰è¿‘æ­£æ ·æœ¬ï¼Œæ¨å¼€è´Ÿæ ·æœ¬ã€‚</li>\n</ul>\n<p>è¿™ç§è‡ªç›‘ç£çš„è®­ç»ƒæ–¹å¼ï¼Œå¯ä»¥å¸®åŠ©GNNå­¦ä¹ åˆ°å¯¹å™ªå£°ä¸æ•æ„Ÿçš„ã€æ›´å…·æœ¬è´¨æ€§çš„ç»“æ„ä¿¡æ¯ï¼Œå³ä½¿åœ¨æ ‡ç­¾æ•°æ®ç¨€ç–çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å–å¾—ä¼˜å¼‚æ•ˆæœã€‚</p>\n<details class=\"hint-container details\"><summary>å›¾å¯¹æ¯”å­¦ä¹ æŸå¤± (InfoNCE)</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> GraphContrastiveLoss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> temperature</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0.1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">GraphContrastiveLoss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">temperature </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> temperature</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">criterion </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">CrossEntropyLoss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            z1, z2: ä¸¤ä¸ªå›¾å¢å¼ºè§†å›¾çš„èŠ‚ç‚¹åµŒå…¥, shape [N, D]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        sim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">normalize</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">normalize</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">T</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">temperature</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ­£æ ·æœ¬åœ¨å¯¹è§’çº¿ä¸Š</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        labels </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">arange</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">to</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">device</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è®¡ç®—æŸå¤±</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        loss </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">criterion</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> labels</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> loss</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h2 id=\"ğŸ“–-å»¶ä¼¸é˜…è¯»\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ“–-å»¶ä¼¸é˜…è¯»\"><span>ğŸ“– å»¶ä¼¸é˜…è¯»</span></a></h2>\n<p><strong>ç»å…¸è®ºæ–‡</strong>ï¼š</p>\n<ul>\n<li><a href=\"https://arxiv.org/abs/2002.02126\" target=\"_blank\" rel=\"noopener noreferrer\">LightGCN: Simplifying and Powering Graph Convolution Network for Recommendation (SIGIR'20)</a></li>\n<li><a href=\"https://arxiv.org/abs/1806.01973\" target=\"_blank\" rel=\"noopener noreferrer\">Graph Convolutional Neural Networks for Web-Scale Recommender Systems (KDD'18, PinSage)</a></li>\n<li><a href=\"https://arxiv.org/abs/1903.07293\" target=\"_blank\" rel=\"noopener noreferrer\">Heterogeneous Graph Attention Network (WWW'19, HAN)</a></li>\n<li><a href=\"https://arxiv.org/abs/2010.10783\" target=\"_blank\" rel=\"noopener noreferrer\">Self-supervised Graph Learning for Recommendation (SIGIR'21, SGL)</a></li>\n</ul>\n<p><strong>å¼€æºæ¡†æ¶</strong>ï¼š</p>\n<ul>\n<li><a href=\"https://github.com/pyg-team/pytorch_geometric\" target=\"_blank\" rel=\"noopener noreferrer\">PyTorch Geometric (PyG)</a>ï¼šæœ€æµè¡Œçš„GNNåº“ä¹‹ä¸€ï¼Œæä¾›äº†å¤§é‡GNNæ¨¡å‹å’Œå·¥å…·ã€‚</li>\n<li><a href=\"https://github.com/dmlc/dgl\" target=\"_blank\" rel=\"noopener noreferrer\">DGL (Deep Graph Library)</a>ï¼šå¦ä¸€ä¸ªå¼ºå¤§çš„å›¾å­¦ä¹ æ¡†æ¶ï¼Œæ”¯æŒå¤šç§åç«¯ã€‚</li>\n<li><a href=\"https://github.com/RUCAIBox/RecBole\" target=\"_blank\" rel=\"noopener noreferrer\">RecBole</a>ï¼šä¸€ä¸ªç»Ÿä¸€ã€å…¨é¢çš„æ¨èç®—æ³•å¤ç°åº“ï¼ŒåŒ…å«äº†å¤šç§GNNæ¨¡å‹ã€‚</li>\n</ul>\n<blockquote>\n<p>ğŸ§  <strong>æ€è€ƒé¢˜</strong></p>\n<ol>\n<li><strong>LightGCN vs. GCN</strong>ï¼šä½ è®¤ä¸ºLightGCNç§»é™¤çš„éçº¿æ€§å’Œç‰¹å¾å˜æ¢ï¼Œä¸ºä»€ä¹ˆåœ¨ååŒè¿‡æ»¤åœºæ™¯ä¸‹æ˜¯&quot;å¤šä½™&quot;çš„ï¼Ÿå®ƒå¯èƒ½åœ¨ä»€ä¹ˆç±»å‹çš„å›¾æ•°æ®ä¸Šè¡¨ç°ä¸ä½³ï¼Ÿ</li>\n<li><strong>é‡‡æ ·ç­–ç•¥çš„æƒè¡¡</strong>ï¼šPinSageçš„éšæœºæ¸¸èµ°é‡‡æ ·ç›¸æ¯”å‡åŒ€é‚»å±…é‡‡æ ·ï¼Œå…¶ä¼˜åŠ¿å’ŒåŠ£åŠ¿åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½ å¯èƒ½ä¼šé€‰æ‹©åè€…ï¼Ÿ</li>\n<li><strong>å†·å¯åŠ¨é—®é¢˜</strong>ï¼šå¯¹äºä¸€ä¸ªæ²¡æœ‰ä»»ä½•äº¤äº’çš„æ–°ç”¨æˆ·ï¼ˆ&quot;å†·å¯åŠ¨&quot;ç”¨æˆ·ï¼‰ï¼ŒGNNæ¨¡å‹ï¼ˆç‰¹åˆ«æ˜¯LightGCNï¼‰å°†å¦‚ä½•ä¸ºä»–ç”ŸæˆåµŒå…¥å¹¶è¿›è¡Œæ¨èï¼Ÿä½ æœ‰ä»€ä¹ˆæ”¹è¿›çš„æ€è·¯å—ï¼Ÿ</li>\n<li><strong>å…ƒè·¯å¾„çš„è®¾è®¡</strong>ï¼šåœ¨ä¸€ä¸ªåŒ…å«&quot;ç”¨æˆ·-æœç´¢-ç‰©å“-è´­ä¹°&quot;è¡Œä¸ºçš„ç”µå•†åœºæ™¯ä¸­ï¼Œè¯·ä½ è®¾è®¡è‡³å°‘ä¸‰æ¡æœ‰æ„ä¹‰çš„å…ƒè·¯å¾„ï¼Œå¹¶è¯´æ˜å®ƒä»¬å„è‡ªèƒ½æ•æ‰åˆ°ä»€ä¹ˆæ¨èä¿¡å·ã€‚</li>\n<li><strong>å›¾å¢å¼ºçš„é£é™©</strong>ï¼šå›¾å¯¹æ¯”å­¦ä¹ ä¸­çš„æ•°æ®å¢å¼ºï¼ˆå¦‚åˆ è¾¹ã€åˆ ç‚¹ï¼‰å¦‚æœæ“ä½œä¸å½“ï¼Œå¯èƒ½ä¼šç ´åå›¾çš„å…³é”®ç»“æ„ä¿¡æ¯ã€‚ä½ è®¤ä¸ºè¯¥å¦‚ä½•è®¾ç½®å¢å¼ºçš„å¼ºåº¦ï¼ˆæ¯”å¦‚åˆ é™¤æ¯”ä¾‹ï¼‰ï¼Œä»¥åœ¨&quot;åˆ›é€ å¤šæ ·æ€§&quot;å’Œ&quot;ä¿æŒç»“æ„&quot;ä¹‹é—´å–å¾—å¹³è¡¡ï¼Ÿ</li>\n</ol>\n</blockquote>\n</template>","contentStripped":"<p>åœ¨æ¨èç³»ç»Ÿçš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¯»æ‰¾èƒ½æ›´æ·±åˆ»ç†è§£ç”¨æˆ·ä¸ç‰©å“ä¹‹é—´å¤æ‚å…³ç³»çš„æ–¹æ³•ã€‚ä¼ ç»Ÿçš„ååŒè¿‡æ»¤å…³æ³¨å…±ç°å…³ç³»ï¼Œè€Œæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆå¦‚DINã€BSTï¼‰åˆ™ç²¾äºæ•æ‰åºåˆ—ä¾èµ–ã€‚ç„¶è€Œï¼Œå®ƒä»¬åœ¨æŸç§ç¨‹åº¦ä¸Šéƒ½å°†ç”¨æˆ·å’Œç‰©å“è§†ä¸ºç‹¬ç«‹çš„ä¸ªä½“ï¼Œå¿½ç•¥äº†ä¸€ä¸ªè‡³å…³é‡è¦çš„ä¿¡æ¯ç»´åº¦â€”â€”<strong>è¿æ¥ï¼ˆConnectionsï¼‰</strong>ã€‚</p>\n<p><strong>å›¾ç¥ç»ç½‘ç»œï¼ˆGraph Neural Network, GNNï¼‰</strong> ä¸ºæ¨èç³»ç»Ÿå¸¦æ¥äº†å…¨æ–°çš„ä¸–ç•Œè§‚ã€‚å®ƒä¸å†å°†ç³»ç»Ÿè§†ä¸ºç”¨æˆ·çš„é›†åˆå’Œç‰©å“çš„é›†åˆï¼Œè€Œæ˜¯çœ‹ä½œä¸€ä¸ªç”±ç”¨æˆ·ã€ç‰©å“ä»¥åŠå®ƒä»¬ä¹‹é—´çº·ç¹å¤æ‚çš„äº¤äº’å…³ç³»å…±åŒæ„æˆçš„å·¨å¤§<strong>å›¾ï¼ˆGraphï¼‰</strong>ã€‚åœ¨è¿™ä¸ªè§†è§’ä¸‹ï¼Œç”¨æˆ·çš„å…´è¶£ä¸å†ä»…ä»…ç”±å…¶å†å²è¡Œä¸ºåºåˆ—å®šä¹‰ï¼Œæ›´ç”±å…¶åœ¨æ•´ä¸ª&quot;ä¿¡æ¯ç”Ÿæ€&quot;ä¸­çš„ä½ç½®æ‰€å†³å®šã€‚</p>\n<h3 id=\"ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§\"><span>ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§ï¼Ÿ</span></a></h3>\n<ol>\n<li><strong>è¶…è¶Šä¸€é˜¶å…³ç³»</strong>ï¼šä½ çš„å…´è¶£ä¸ä»…å’Œä½ ç›´æ¥ç‚¹å‡»è¿‡çš„ç‰©å“ï¼ˆä¸€é˜¶é‚»å±…ï¼‰æœ‰å…³ï¼Œä¹Ÿå’Œ&quot;ç‚¹å‡»è¿‡åŒæ ·ç‰©å“çš„å…¶ä»–äºº&quot;ï¼ˆäºŒé˜¶é‚»å±…ï¼‰ä»¥åŠ&quot;é‚£äº›äººè¿˜å–œæ¬¢çš„å…¶ä»–ç‰©å“&quot;ï¼ˆä¸‰é˜¶é‚»å±…ï¼‰æœ‰å…³ã€‚GNNé€šè¿‡åœ¨å›¾ä¸Šä¼ æ’­ä¿¡æ¯ï¼Œèƒ½å¤Ÿè‡ªç„¶åœ°æ•æ‰è¿™ç§<strong>é«˜é˜¶ä¾èµ–ï¼ˆHigh-order Proximityï¼‰</strong>ï¼Œå‘æ˜å‡ºæ›´æ·±å±‚æ¬¡çš„å…³è”ã€‚</li>\n<li><strong>ç»“æ„åŒ–ä¿¡æ¯çš„åŠ›é‡</strong>ï¼šå›¾æœ¬èº«å°±æ˜¯ä¸€ç§å¼ºå¤§çš„ç»“æ„åŒ–ä¿¡æ¯ã€‚èŠ‚ç‚¹çš„åº¦æ•°ã€èšç±»æƒ…å†µã€åœ¨å›¾ä¸­çš„ä¸­å¿ƒæ€§ç­‰æ‹“æ‰‘ç‰¹å¾ï¼Œéƒ½ä¸ºç†è§£èŠ‚ç‚¹ï¼ˆç”¨æˆ·/ç‰©å“ï¼‰çš„å±æ€§æä¾›äº†ä¸°å¯Œçº¿ç´¢ã€‚</li>\n<li><strong>ç»Ÿä¸€çš„å»ºæ¨¡æ¡†æ¶</strong>ï¼šæ— è®ºæ˜¯ç”¨æˆ·ä¸ç‰©å“çš„äº¤äº’ï¼ˆäºŒéƒ¨å›¾ï¼‰ã€ç‰©å“ä¸ç‰©å“çš„ç›¸ä¼¼å…³ç³»ï¼ˆåŒè´¨å›¾ï¼‰ï¼Œè¿˜æ˜¯ç”¨æˆ·ä¹‹é—´çš„ç¤¾äº¤å…³ç³»ï¼ˆç¤¾äº¤ç½‘ç»œï¼‰ï¼Œç”šè‡³æ˜¯åŒ…å«å“ç‰Œã€ç±»åˆ«ç­‰å¤šç§èŠ‚ç‚¹çš„å¤æ‚åœºæ™¯ï¼ˆå¼‚è´¨å›¾ï¼‰ï¼ŒGNNéƒ½èƒ½æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å»ºæ¨¡æ¡†æ¶ã€‚</li>\n</ol>\n<Mermaid id=\"mermaid-26\" code=\"eJx1kstOAjEUhvc+RdONkMAbGBIGENjrirCA0CALgQzDwp0MF0UEjLgRFCSC4oIgkegww+Vl2un4FnY6XGRBF22ac/6v/zmncTGSPgMn3gPAViYbte5Qrw2M6h390qjWwcqQNguktaBaQ28XIE81lzsEsXJFyx+0WSL1EcuAYeB0uoAQgvRhoF//OFmQNHJYvf3ND1j8KCq6bKcZJDqDEjoHQiIdEaWEhIDffNYOw1s2B3kYiBNWINpS8Gy2BpkMC7RH7t364AftLbDa2/FhbvvkvhAkvSYda6RdITPZmGxKCCAJiak4SqJUNrMrR8kYPwWGYH18UcgyT55U/XEEOfTYBomm6oOuZQkrtVVpzQJtTfRanznE6j20c4qHU4xunxSLeNnVcyuKn1He5ENjMsTTT6yW3Hja2VyEw5Xau0cdsNSkPyf1ijnb4sT4fiXzMWlU11of15JeVX+W//sP2iD/E5dWFWb/HMAcggN4IhKKp8QLBxDESDJGh2Wzfe9V40am8pRx/wD4Xhxy\"></Mermaid><h2 id=\"ğŸš€-lightgcn-å¤§é“è‡³ç®€-è¿”ç’å½’çœŸ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸš€-lightgcn-å¤§é“è‡³ç®€-è¿”ç’å½’çœŸ\"><span>ğŸš€ LightGCNï¼šå¤§é“è‡³ç®€ï¼Œè¿”ç’å½’çœŸ</span></a></h2>\n<p>åœ¨GNNçš„æ—©æœŸæ¢ç´¢ä¸­ï¼Œç ”ç©¶è€…ä»¬å€¾å‘äºå°†ç”¨äºè®¡ç®—æœºè§†è§‰æˆ–è‡ªç„¶è¯­è¨€å¤„ç†çš„å¤æ‚GNNæ¨¡å‹ï¼ˆå¦‚GCN, GATï¼‰ç›´æ¥è¿ç§»åˆ°æ¨èåœºæ™¯ã€‚è¿™äº›æ¨¡å‹é€šå¸¸åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒæ“ä½œï¼š<strong>ç‰¹å¾å˜æ¢</strong>ï¼ˆé€šè¿‡æƒé‡çŸ©é˜µ<code v-pre>W</code>ï¼‰ã€<strong>é‚»å±…èšåˆ</strong>ï¼ˆå¦‚æ±‚å’Œæˆ–å–å¹³å‡ï¼‰å’Œ<strong>éçº¿æ€§æ¿€æ´»</strong>ï¼ˆå¦‚<code v-pre>ReLU</code>ï¼‰ã€‚</p>\n<p>ç„¶è€Œï¼Œä½•å‘å—æ•™æˆå›¢é˜Ÿåœ¨2020å¹´æå‡ºçš„ <strong>LightGCN</strong> é¢ è¦†äº†è¿™ä¸€æ€è·¯ã€‚ä»–ä»¬é€šè¿‡å¤§é‡çš„å®éªŒæ•é”åœ°å‘ç°ï¼Œåœ¨æ¨èç³»ç»Ÿçš„ååŒè¿‡æ»¤åœºæ™¯ä¸‹ï¼Œç‰¹å¾å˜æ¢å’Œéçº¿æ€§æ¿€æ´»è¿™ä¸¤ä¸ªæ“ä½œå¯¹äºæ€§èƒ½çš„æå‡æ˜¯<strong>éå¿…è¦ç”šè‡³æœ‰å®³çš„</strong>ã€‚</p>\n<h3 id=\"æ ¸å¿ƒæ€æƒ³-å‡æ³•å³æ˜¯åŠ æ³•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒæ€æƒ³-å‡æ³•å³æ˜¯åŠ æ³•\"><span>æ ¸å¿ƒæ€æƒ³ï¼šå‡æ³•å³æ˜¯åŠ æ³•</span></a></h3>\n<p>LightGCNçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨æ¨èçš„IDç±»ç‰¹å¾ä¸Šï¼Œæˆ‘ä»¬çœŸæ­£éœ€è¦çš„æ˜¯çº¯ç²¹çš„ã€æ— æŸçš„<strong>ä¿¡æ¯ä¼ æ’­ï¼ˆInformation Propagationï¼‰</strong>ï¼Œè€Œä¸æ˜¯å¤æ‚çš„ç‰¹å¾å˜æ¢ã€‚ç”¨æˆ·çš„æœ€ç»ˆåµŒå…¥ï¼Œåº”è¯¥æ˜¯å…¶è‡ªèº«åŸå§‹åµŒå…¥ä¸ä»é‚»å±…èŠ‚ç‚¹ï¼ˆå¦‚å…¶äº¤äº’è¿‡çš„ç‰©å“ï¼‰ä¼ æ’­è¿‡æ¥çš„ä¿¡æ¯çš„çº¿æ€§ç»„åˆã€‚</p>\n<p>å› æ­¤ï¼ŒLightGCNå¤§èƒ†åœ°å»é™¤äº†ç‰¹å¾å˜æ¢å’Œéçº¿æ€§æ¿€æ´»ï¼Œå…¶æ ¸å¿ƒä¼ æ’­å…¬å¼æå…¶ç®€æ´ï¼š</p>\n<p v-pre class='katex-block'><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>=</mo><munder><mo>âˆ‘</mo><mrow><mi>i</mi><mo>âˆˆ</mo><msub><mi>N</mi><mi>u</mi></msub></mrow></munder><mfrac><mn>1</mn><msqrt><mrow><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>u</mi></msub><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>i</mi></msub><mi mathvariant=\"normal\">âˆ£</mi></mrow></msqrt></mfrac><msubsup><mi>e</mi><mi>i</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow></msubsup><mspace width=\"1em\"/><mtext>å’Œ</mtext><mspace width=\"1em\"/><msubsup><mi>e</mi><mi>i</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></msubsup><mo>=</mo><munder><mo>âˆ‘</mo><mrow><mi>u</mi><mo>âˆˆ</mo><msub><mi>N</mi><mi>i</mi></msub></mrow></munder><mfrac><mn>1</mn><msqrt><mrow><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>i</mi></msub><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"normal\">âˆ£</mi><msub><mi>N</mi><mi>u</mi></msub><mi mathvariant=\"normal\">âˆ£</mi></mrow></msqrt></mfrac><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow></msubsup></mrow><annotation encoding=\"application/x-tex\">e_u^{(k+1)} = \\sum_{i \\in N_u} \\frac{1}{\\sqrt{|N_u||N_i|}} e_i^{(k)} \\quad \\text{å’Œ} \\quad e_i^{(k+1)} = \\sum_{u \\in N_i} \\frac{1}{\\sqrt{|N_i||N_u|}} e_u^{(k)} \n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.185em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.938em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.7159em;vertical-align:-1.3944em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.8557em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1645em;\"><span style=\"top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.175em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.935em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-2.895em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.305em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.13em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0448em;\"><span style=\"top:-2.4231em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.2198em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2769em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord text\"><span class=\"mord cjk_fallback\">å’Œ</span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0448em;\"><span style=\"top:-2.4231em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.2198em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2769em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.7159em;vertical-align:-1.3944em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.05em;\"><span style=\"top:-1.8557em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"mrel mtight\">âˆˆ</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3281em;\"><span style=\"top:-2.357em;margin-left:-0.109em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">âˆ‘</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3214em;\"><span style=\"top:-2.175em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.935em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\">âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£âˆ£</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.109em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">âˆ£</span></span></span><span style=\"top:-2.895em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.28em\" viewBox=\"0 0 400000 1296\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z\"/></svg></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.305em;\"><span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.13em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.938em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span></span></span></span></span></p>\n<p>å…¶ä¸­ï¼Œ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>e</mi><mi>u</mi><mrow><mo stretchy=\"false\">(</mo><mi>k</mi><mo stretchy=\"false\">)</mo></mrow></msubsup></mrow><annotation encoding=\"application/x-tex\">e_u^{(k)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1614em;vertical-align:-0.1166em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0448em;\"><span style=\"top:-2.5834em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span><span style=\"top:-3.2198em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1166em;\"><span></span></span></span></span></span></span></span></span></span> æ˜¯ç”¨æˆ· <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> åœ¨ç¬¬ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> å±‚çš„åµŒå…¥ï¼Œ<span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"script\">N</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathcal{N}_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathcal\" style=\"margin-right:0.14736em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1474em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">â€‹</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> æ˜¯ç”¨æˆ· <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span> çš„é‚»å±…ï¼ˆç‰©å“ï¼‰é›†åˆã€‚è¿™ä¸ªå…¬å¼æœ¬è´¨ä¸Šå°±æ˜¯åœ¨åš<strong>å½’ä¸€åŒ–åçš„é‚»å±…ä¿¡æ¯èšåˆ</strong>ã€‚ç»è¿‡ <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span> å±‚ä¼ æ’­åï¼ŒLightGCNå°†æ¯ä¸€å±‚çš„åµŒå…¥è¿›è¡ŒåŠ æƒæ±‚å’Œï¼ˆé€šå¸¸æ˜¯ç®€å•å¹³å‡ï¼‰ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç”¨æˆ·å’Œç‰©å“è¡¨ç¤ºï¼Œç”¨äºè®¡ç®—æ¨èåˆ†æ•°ã€‚</p>\n<details class=\"hint-container details\"><summary>LightGCN å®Œæ•´ PyTorch å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> LightGCN</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_users</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_items</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">64</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_users (int): ç”¨æˆ·æ•°é‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_items (int): ç‰©å“æ•°é‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            adj_matrix (torch.sparse.Tensor): æ ‡å‡†åŒ–çš„é‚»æ¥çŸ©é˜µ D^(-1/2)AD^(-1/2)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            embed_dim (int): åµŒå…¥ç»´åº¦</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_layers (int): å›¾å·ç§¯å±‚æ•°</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">LightGCN</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_users </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_users</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_items </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_items</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adj_matrix </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_matrix</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">embed_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å®šä¹‰ç”¨æˆ·å’Œç‰©å“çš„åˆå§‹åµŒå…¥ E_0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_embedding </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_users</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">item_embedding </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_items</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> embed_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # åˆå§‹åŒ–åµŒå…¥æƒé‡</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">init</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">xavier_uniform_</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">init</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">xavier_uniform_</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">item_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è·å–æ‰€æœ‰èŠ‚ç‚¹çš„åˆå§‹åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # E_0 = [E_U, E_I]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        ego_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">item_embedding</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">weight</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ç”¨äºå­˜å‚¨æ¯ä¸€å±‚ä¼ æ’­åçš„åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        all_layer_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ego_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è¿›è¡Œå¤šå±‚å›¾å·ç§¯ (ä¿¡æ¯ä¼ æ’­)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> layer </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # E_k+1 = A_hat * E_k</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            ego_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">adj_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ego_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            all_layer_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ego_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å°†æ‰€æœ‰å±‚çš„åµŒå…¥è¿›è¡ŒåŠ æƒæ±‚å’Œï¼ˆè¿™é‡Œæ˜¯å¹³å‡ï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # E_final = (1/K+1) * (E_0 + E_1 + ... + E_K)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        final_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">all_layer_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä»æœ€ç»ˆåµŒå…¥ä¸­åˆ†ç¦»å‡ºç”¨æˆ·å’Œç‰©å“çš„åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">split</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">final_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_users</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_items</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> compute_loss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> user_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pos_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neg_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        è®¡ç®—BPRæŸå¤±</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        u_embeds </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> users_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">user_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        pos_i_embeds </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">pos_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        neg_i_embeds </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> items_emb</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neg_item_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        pos_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">u_embeds </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> pos_i_embeds</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        neg_scores </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">u_embeds </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neg_i_embeds</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # BPR Loss</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        loss </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">log</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sigmoid</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">pos_scores </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neg_scores</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> loss</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<p>LightGCNçš„æˆåŠŸè¯æ˜äº†ï¼Œåœ¨ç‰¹å®šä»»åŠ¡ä¸­ï¼Œ<strong>é’ˆå¯¹æ€§çš„ç®€åŒ–è¿œèƒœäºç›²ç›®çš„å †ç Œå¤æ‚æ¨¡å—</strong>ã€‚å®ƒä¸ºæ¨èé¢†åŸŸçš„GNNè®¾è®¡æä¾›äº†ä¸€ä¸ªä¼˜é›…ã€é«˜æ•ˆä¸”å¼ºå¤§çš„åŸºçº¿ã€‚</p>\n<h2 id=\"ğŸ­-pinsage-åº”å¯¹web-scaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ­-pinsage-åº”å¯¹web-scaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº\"><span>ğŸ­ PinSageï¼šåº”å¯¹Web-ScaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº</span></a></h2>\n<p>LightGCNè™½ç„¶å¼ºå¤§ï¼Œä½†å®ƒä¾èµ–äºå¯¹æ•´ä¸ªå›¾è¿›è¡Œå…¨é‡è®¡ç®—ï¼ˆfull-batch trainingï¼‰ï¼Œè¿™åœ¨åŠ¨è¾„æ•°åäº¿èŠ‚ç‚¹ã€æ•°ç™¾äº¿è¾¹çš„å·¥ä¸šçº§å¤§å›¾ï¼ˆå¦‚Pinterestã€æ·˜å®ã€å¾®ä¿¡ï¼‰é¢å‰æ˜¯å®Œå…¨ä¸å¯è¡Œçš„ã€‚</p>\n<p><strong>PinSage</strong> æ˜¯ç”±Pinterestå›¢é˜Ÿåœ¨2018å¹´æå‡ºçš„ï¼Œæ˜¯ç¬¬ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸ŠæˆåŠŸåº”ç”¨åˆ°è¶…å¤§è§„æ¨¡å›¾ä¸Šçš„GNNæ¨èæ¨¡å‹ï¼Œæ˜¯GNNå·¥ä¸šè½åœ°çš„é‡è¦é‡Œç¨‹ç¢‘ã€‚å®ƒçš„ä¸€ç³»åˆ—è®¾è®¡ï¼Œæ ¸å¿ƒéƒ½æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼š<strong>å¯æ‰©å±•æ€§ï¼ˆScalabilityï¼‰</strong>ã€‚</p>\n<h3 id=\"æ ¸å¿ƒæ€æƒ³-é‡‡æ ·ä¸èšåˆ\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒæ€æƒ³-é‡‡æ ·ä¸èšåˆ\"><span>æ ¸å¿ƒæ€æƒ³ï¼šé‡‡æ ·ä¸èšåˆ</span></a></h3>\n<p>PinSageçš„æ¶æ„å®Œå…¨æ‘’å¼ƒäº†å…¨å›¾è®¡ç®—çš„æ€è·¯ï¼Œè½¬è€Œé‡‡ç”¨<strong>åŸºäºé‡‡æ ·çš„å°æ‰¹é‡ï¼ˆmini-batchï¼‰è®­ç»ƒ</strong>æ¨¡å¼ã€‚å…¶æ ¸å¿ƒåˆ›æ–°å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š</p>\n<ol>\n<li>\n<p><strong>é‚»å±…é‡‡æ ·ï¼ˆNeighbor Samplingï¼‰</strong>ï¼šå¯¹äºä¸€ä¸ªä¸­å¿ƒèŠ‚ç‚¹ï¼Œä¸æ˜¯èšåˆå®ƒæ‰€æœ‰çš„é‚»å±…ä¿¡æ¯ï¼Œè€Œæ˜¯åª<strong>é‡‡æ ·å›ºå®šæ•°é‡çš„é‚»å±…</strong>ï¼ˆæ¯”å¦‚20ä¸ªï¼‰ã€‚è¿™æ ·ï¼Œæ— è®ºä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šå°‘é‚»å±…ï¼Œå®ƒçš„è®¡ç®—é‡éƒ½æ˜¯æ’å®šçš„ï¼Œä»è€Œè§£å†³äº†&quot;åº¦æ•°çˆ†ç‚¸&quot;é—®é¢˜ã€‚</p>\n</li>\n<li>\n<p><strong>åŸºäºéšæœºæ¸¸èµ°çš„é‡‡æ ·ç­–ç•¥</strong>ï¼šå¦‚ä½•é‡‡æ ·åˆ°&quot;é‡è¦&quot;çš„é‚»å±…ï¼ŸPinSageæ²¡æœ‰ä½¿ç”¨å‡åŒ€é‡‡æ ·ï¼Œè€Œæ˜¯è®¾è®¡äº†ä¸€ç§å·§å¦™çš„<strong>åŸºäºéšæœºæ¸¸èµ°çš„é‡‡æ ·</strong>ã€‚ä»ä¸­å¿ƒèŠ‚ç‚¹å‡ºå‘ï¼Œè¿›è¡Œå¤šæ¬¡çŸ­è·ç¦»çš„éšæœºæ¸¸èµ°ï¼Œå¹¶å°†æ¸¸èµ°ç»è¿‡çš„èŠ‚ç‚¹ä½œä¸ºé‚»å±…ã€‚è¿™ç§æ–¹æ³•èƒ½æ›´æœ‰æ•ˆåœ°é‡‡æ ·åˆ°ä¸ä¸­å¿ƒèŠ‚ç‚¹<strong>ç»“æ„æ›´ç›¸ä¼¼ã€å…³ç³»æ›´ç´§å¯†</strong>çš„èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ä»…ä»…æ˜¯ç›´æ¥ç›¸è¿çš„èŠ‚ç‚¹ã€‚</p>\n</li>\n<li>\n<p><strong>å¤šå±‚èšåˆï¼ˆOn-the-fly Computationï¼‰</strong>ï¼šPinSageçš„è®¡ç®—æ˜¯&quot;å³æ—¶&quot;çš„ã€‚å½“è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹çš„è¡¨ç¤ºæ—¶ï¼Œå®ƒä¼šå…ˆé‡‡æ ·å…¶ä¸€é˜¶é‚»å±…ï¼Œç„¶åä¸ºè¿™äº›é‚»å±…é‡‡æ ·å®ƒä»¬çš„é‚»å±…ï¼ˆå³ä¸­å¿ƒèŠ‚ç‚¹çš„äºŒé˜¶é‚»å±…ï¼‰ï¼Œå±‚å±‚é€’è¿›ã€‚æ•´ä¸ªè®¡ç®—å›¾æ˜¯åœ¨ä¸€ä¸ªæ‰¹æ¬¡ä¸­åŠ¨æ€æ„å»ºçš„ï¼Œè¿™è¢«ç§°ä¸º&quot;on-the-fly&quot;å·ç§¯ã€‚</p>\n</li>\n</ol>\n<details class=\"hint-container details\"><summary>PinSage æ ¸å¿ƒæ€æƒ³å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">functional </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> random</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„å®ç°ï¼Œæ—¨åœ¨è¯´æ˜PinSageçš„æ ¸å¿ƒæ€æƒ³ï¼Œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># å·¥ä¸šçº§çš„å®ç°ä¼šå¤æ‚å¾—å¤šï¼Œå¹¶éœ€è¦é«˜æ•ˆçš„å›¾æ•°æ®åº“æ”¯æŒã€‚</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SAGEConv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    PinSageçš„æ ¸å¿ƒå·ç§¯å±‚ï¼Œèšåˆé‡‡æ ·åˆ°çš„é‚»å±…ä¿¡æ¯</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> out_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SAGEConv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # èšåˆåçš„é‚»å±…ä¿¡æ¯å’ŒèŠ‚ç‚¹è‡ªèº«ä¿¡æ¯æ‹¼æ¥ï¼Œæ‰€ä»¥æ˜¯ in_dim * 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">agg_layer </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_dim </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> out_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> self_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbor_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            self_feats (Tensor): ä¸­å¿ƒèŠ‚ç‚¹è‡ªèº«çš„ç‰¹å¾ [batch_size, in_dim]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            neighbor_feats (Tensor): é‡‡æ ·å¹¶èšåˆåçš„é‚»å±…ç‰¹å¾ [batch_size, in_dim]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ‹¼æ¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        combined </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">cat</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbor_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ›´æ–°</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        output </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">relu</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">agg_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">combined</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ ‡å‡†åŒ–</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">normalize</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">output</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> PinSage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">PinSage</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_layers</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # åˆ›å»ºå¤šå±‚SAGEConv</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            layer_in_dim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">            self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SAGEConv</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layer_in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_samples_per_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        PinSageçš„å‰å‘ä¼ æ’­</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            node_ids (list): ä¸€ä¸ªmini-batchçš„ä¸­å¿ƒèŠ‚ç‚¹ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            full_feature_matrix (Tensor): åŒ…å«æ‰€æœ‰èŠ‚ç‚¹ç‰¹å¾çš„çŸ©é˜µ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            adj_list (dict): å›¾çš„é‚»æ¥è¡¨è¡¨ç¤º {node_id: [neighbor1, neighbor2, ...]}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            num_samples_per_layer (list): æ¯å±‚è¦é‡‡æ ·çš„é‚»å±…æ•°é‡, e.g., [20, 10] for 2 layers</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # h_l æ˜¯ç¬¬ l å±‚éœ€è¦çš„èŠ‚ç‚¹ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        h </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # ä»æœ€å¤–å±‚ (ç¬¬ k å±‚) å‘å†…å±‚ (ç¬¬ 1 å±‚) èšåˆ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> l </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">num_layers </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # è·å–å½“å‰å±‚è®¡ç®—æ‰€éœ€è¦çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆä¸Šä¸€å±‚èšåˆçš„ç»“æœï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            current_nodes </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> h</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # å‡è®¾håŒ…å«äº†å½“å‰å±‚éœ€è¦çš„æ‰€æœ‰èŠ‚ç‚¹çš„ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # 1. é‡‡æ ·é‚»å±…</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            sampled_neighbors </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">            for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> node_id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # éå†æ‰¹æ¬¡ä¸­çš„æ¯ä¸ªä¸­å¿ƒèŠ‚ç‚¹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                neighbors </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> adj_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">get</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">node_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                if</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> len</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_samples_per_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">l</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    sampled </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> random</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sample</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_samples_per_layer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">l</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                else</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    sampled </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbors </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ä¸è¶³åˆ™å…¨éƒ¨é‡‡æ ·</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                sampled_neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sampled</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # 2. è·å–é‚»å±…ç‰¹å¾å¹¶èšåˆï¼ˆè¿™é‡Œç®€åŒ–ä¸ºå¹³å‡èšåˆï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            neighbor_feats_list </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">            for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbors </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sampled_neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                if</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    neighbor_feats_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">                else</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # å¤„ç†å­¤ç«‹ç‚¹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    neighbor_feats_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">zeros_like</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            aggregated_neighbors </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">neighbor_feats_list</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # 3. èšåˆè‡ªèº«ä¸é‚»å±…ï¼Œé€šè¿‡SAGEConvå±‚æ›´æ–°</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # æ³¨æ„ï¼šè¿™é‡Œçš„ h éœ€è¦æ­£ç¡®å¯¹åº”ä¸Š</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            self_feats </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> full_feature_matrix</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">node_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # è·å–ä¸­å¿ƒèŠ‚ç‚¹å½“å‰å±‚çš„ç‰¹å¾</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            h </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">l</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">](</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self_feats</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> aggregated_neighbors</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            node_ids </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # ... æ›´æ–°ä¸‹ä¸€å±‚éœ€è¦è®¡ç®—çš„èŠ‚ç‚¹ ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> h</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<p>PinSageä¸ä»…æä¾›äº†ä¸€ä¸ªå¯æ‰©å±•çš„GNNæ¶æ„ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå±•ç¤ºäº†ä¸€æ•´å¥—å°†GNNåº”ç”¨äºçœŸå®ã€æµ·é‡ã€å¤æ‚å·¥ä¸šåœºæ™¯çš„<strong>å·¥ç¨‹èŒƒå¼</strong>ï¼ŒåŒ…æ‹¬é‡‡æ ·ã€è´Ÿé‡‡æ ·ã€æ¨¡å‹éƒ¨ç½²ç­‰ï¼Œå½±å“æ·±è¿œã€‚</p>\n<h2 id=\"ğŸŒˆ-han-æ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸŒˆ-han-æ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§\"><span>ğŸŒˆ HANï¼šæ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§</span></a></h2>\n<p>ç°å®ä¸–ç•Œçš„å›¾å¾ˆå°‘æ˜¯åŒè´¨çš„ã€‚ä¸€ä¸ªç”µå•†æ¨èåœºæ™¯çš„å›¾ï¼Œè‡³å°‘åŒ…å«ç”¨æˆ·ã€ç‰©å“ã€å“ç‰Œã€ç±»åˆ«ç­‰å¤šç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œä»¥åŠç‚¹å‡»ã€è´­ä¹°ã€å±äºï¼ˆç‰©å“å±äºæŸç±»åˆ«ï¼‰ç­‰å¤šç§ç±»å‹çš„è¾¹ã€‚è¿™ç§å›¾è¢«ç§°ä¸º<strong>å¼‚è´¨ä¿¡æ¯ç½‘ç»œï¼ˆHeterogeneous Information Network, HINï¼‰</strong>ã€‚</p>\n<p>ç”¨åŒè´¨å›¾æ¨¡å‹ï¼ˆå¦‚LightGCNï¼‰æ¥å¤„ç†HINï¼Œä¼šä¸¢å¤±æ‰èŠ‚ç‚¹å’Œè¾¹çš„ç±»å‹ä¿¡æ¯ï¼Œæ— æ³•åŒºåˆ†&quot;ç”¨æˆ·è´­ä¹°ç‰©å“&quot;å’Œ&quot;ç‰©å“å±äºæŸå“ç‰Œ&quot;è¿™ä¸¤ç§å…³ç³»çš„è¯­ä¹‰å·®å¼‚ã€‚<strong>HAN (Heterogeneous Graph Attention Network)</strong> å°±æ˜¯ä¸ºè§£å†³è¿™ä¸€é—®é¢˜è€Œè®¾è®¡çš„ã€‚</p>\n<h3 id=\"æ ¸å¿ƒæ€æƒ³-åŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#æ ¸å¿ƒæ€æƒ³-åŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›\"><span>æ ¸å¿ƒæ€æƒ³ï¼šåŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›</span></a></h3>\n<p>HANçš„ç²¾é«“åœ¨äºå…¶**å±‚æ¬¡åŒ–æ³¨æ„åŠ›ï¼ˆHierarchical Attentionï¼‰**æœºåˆ¶ï¼Œå®ƒåˆ†ä¸ºä¸¤ä¸ªå±‚çº§ï¼š</p>\n<ol>\n<li>\n<p><strong>èŠ‚ç‚¹çº§æ³¨æ„åŠ›ï¼ˆNode-level Attentionï¼‰</strong>ï¼šé¦–å…ˆï¼Œå®šä¹‰è‹¥å¹²æ¡<strong>å…ƒè·¯å¾„ï¼ˆMeta-pathï¼‰</strong>ã€‚å…ƒè·¯å¾„æ˜¯è¿æ¥ä¸åŒç±»å‹èŠ‚ç‚¹çš„è·¯å¾„ï¼Œä¾‹å¦‚ <code v-pre>ç”¨æˆ·-ç‰©å“-ç”¨æˆ·</code> (U-I-U) è¿™æ¡å…ƒè·¯å¾„å¯ä»¥æ•æ‰åˆ°&quot;è´­ä¹°äº†ç›¸åŒç‰©å“&quot;çš„ç›¸ä¼¼ç”¨æˆ·ã€‚æ²¿ç€æ¯ä¸€æ¡å…ƒè·¯å¾„ï¼ŒHANä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶èšåˆé‚»å±…èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆä¸€ä¸ªåŸºäºç‰¹å®šå…ƒè·¯å¾„çš„åµŒå…¥ã€‚</p>\n</li>\n<li>\n<p><strong>è¯­ä¹‰çº§æ³¨æ„åŠ›ï¼ˆSemantic-level Attentionï¼‰</strong>ï¼šä¸€ä¸ªèŠ‚ç‚¹é€šè¿‡ä¸åŒçš„å…ƒè·¯å¾„ï¼Œä¼šå¾—åˆ°å¤šä¸ªä¸åŒè¯­ä¹‰çš„åµŒå…¥ï¼ˆå¦‚åŸºäºU-I-Uçš„åµŒå…¥å’ŒåŸºäºU-C-Uçš„åµŒå…¥ï¼‰ã€‚è¿™äº›ä¸åŒè¯­ä¹‰çš„é‡è¦æ€§æ˜¾ç„¶æ˜¯ä¸åŒçš„ã€‚å› æ­¤ï¼ŒHANå¼•å…¥äº†ç¬¬äºŒå±‚æ³¨æ„åŠ›ï¼Œå³è¯­ä¹‰çº§æ³¨æ„åŠ›ï¼Œæ¥å­¦ä¹ ä¸åŒå…ƒè·¯å¾„çš„é‡è¦æ€§æƒé‡ï¼Œæœ€ç»ˆå°†å¤šä¸ªè¯­ä¹‰åµŒå…¥åŠ æƒèåˆæˆä¸€ä¸ªç»Ÿä¸€çš„èŠ‚ç‚¹è¡¨ç¤ºã€‚</p>\n</li>\n</ol>\n<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒHANèƒ½å¤Ÿæ™ºèƒ½åœ°è¯†åˆ«å¹¶èåˆæ¥è‡ªä¸åŒç±»å‹å…³ç³»çš„ä¿¡æ¯ï¼Œä»è€Œå­¦ä¹ åˆ°æ›´ä¸°å¯Œã€æ›´å…·è¡¨ç°åŠ›çš„èŠ‚ç‚¹è¡¨ç¤ºã€‚</p>\n<details class=\"hint-container details\"><summary>HAN æ ¸å¿ƒæ€æƒ³å®ç°</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">functional </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SemanticAttention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    HANä¸­çš„è¯­ä¹‰å±‚æ³¨æ„åŠ›ï¼Œç”¨äºèåˆä¸åŒå…ƒè·¯å¾„å¸¦æ¥çš„åµŒå…¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">    \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">128</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SemanticAttention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">project </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Sequential</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Tanh</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(),</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">hidden_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> bias</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        )</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # zæ˜¯ [num_nodes, num_metapaths, in_dim]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è®¡ç®—æ¯ä¸ªå…ƒè·¯å¾„çš„é‡è¦æ€§ w_phi = q^T * tanh(W*z_phi + b)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        w </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">project</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mean</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">                    # [num_metapaths, 1]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        beta </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">w</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">                 # [num_metapaths, 1]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        beta </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beta</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">expand</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">((</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">shape</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">],)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> beta</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">shape</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # [num_nodes, num_metapaths, 1]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # åŠ æƒæ±‚å’Œ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">beta </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sum</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">                       # [num_nodes, in_dim]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HANLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_metapaths</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> out_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_heads</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">HANLayer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # èŠ‚ç‚¹çº§æ³¨æ„åŠ›å±‚ (ä¸ºæ¯ç§å…ƒè·¯å¾„åˆ›å»ºä¸€ä¸ªGATå±‚)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gat_layers </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ModuleList</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">([</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # è¿™é‡Œçš„GATConvéœ€è¦èƒ½å¤„ç†å¼‚è´¨å›¾çš„è¾¹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # åœ¨å®è·µä¸­ä¼šç”¨PyGæˆ–DGLç­‰åº“ä¸­çš„HANConvæˆ–HGTConv</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # GraphAttentionLayer(in_dim, out_dim, num_heads) for _ in range(num_metapaths)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">        ])</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è¯­ä¹‰çº§æ³¨æ„åŠ›å±‚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_attention </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> SemanticAttention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">in_dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">out_dim </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> num_heads</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> g</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> h</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # gæ˜¯å¼‚è´¨å›¾, hæ˜¯èŠ‚ç‚¹ç‰¹å¾å­—å…¸</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        semantic_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> []</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å¯¹æ¯ä¸ªå…ƒè·¯å¾„ï¼ˆè¾¹ç±»å‹ï¼‰</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> i</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> gat_layer </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> enumerate</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">gat_layers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # ä½¿ç”¨å¯¹åº”çš„GATå±‚è¿›è¡ŒèŠ‚ç‚¹çº§èšåˆ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">            # semantic_embeddings.append(gat_layer(g.edge_type_subgraph([edge_type]), h))</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">            pass</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # ä¼ªä»£ç </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # å°†ä¸åŒå…ƒè·¯å¾„çš„åµŒå…¥å †å èµ·æ¥</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        semantic_embeddings </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">stack</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # [N, num_metapaths, D_out]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # é€šè¿‡è¯­ä¹‰æ³¨æ„åŠ›è¿›è¡Œèåˆ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_attention</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">semantic_embeddings</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h2 id=\"âš”ï¸-gnnçš„ç°ä»£è®­ç»ƒå¿ƒæ³•\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#âš”ï¸-gnnçš„ç°ä»£è®­ç»ƒå¿ƒæ³•\"><span>âš”ï¸ GNNçš„ç°ä»£è®­ç»ƒå¿ƒæ³•</span></a></h2>\n<p>é™¤äº†æ¨¡å‹æ¶æ„ï¼ŒGNNçš„è®­ç»ƒæ–¹å¼ä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ã€‚ç°ä»£çš„GNNè®­ç»ƒï¼Œå°¤å…¶æ˜¯è‡ªç›‘ç£å­¦ä¹ çš„å¼•å…¥ï¼Œæå¤§åœ°æå‡äº†æ¨¡å‹çš„æ€§èƒ½å’Œé²æ£’æ€§ã€‚</p>\n<h3 id=\"å›¾å¯¹æ¯”å­¦ä¹ -graph-contrastive-learning\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#å›¾å¯¹æ¯”å­¦ä¹ -graph-contrastive-learning\"><span>å›¾å¯¹æ¯”å­¦ä¹ ï¼ˆGraph Contrastive Learningï¼‰</span></a></h3>\n<p>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>åœ¨åµŒå…¥ç©ºé—´ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„&quot;å¢å¼ºè§†å›¾&quot;åº”è¯¥ä¸å®ƒè‡ªèº«çš„å…¶ä»–&quot;å¢å¼ºè§†å›¾&quot;å°½å¯èƒ½ç›¸ä¼¼ï¼Œè€Œä¸å…¶ä»–èŠ‚ç‚¹çš„è§†å›¾å°½å¯èƒ½è¿œç¦»ã€‚</strong></p>\n<ul>\n<li><strong>å›¾å¢å¼ºï¼ˆGraph Augmentationï¼‰</strong>ï¼šå¦‚ä½•åˆ›é€ &quot;å¢å¼ºè§†å›¾&quot;ï¼Ÿé€šå¸¸é€šè¿‡å¯¹åŸå›¾è¿›è¡Œéšæœºæ‰°åŠ¨ï¼Œå¦‚<strong>éšæœºåˆ è¾¹ï¼ˆEdge Droppingï¼‰</strong>ã€ <strong>éšæœºèŠ‚ç‚¹ä¸¢å¼ƒï¼ˆNode Droppingï¼‰</strong> æˆ– <strong>ç‰¹å¾æ©ç ï¼ˆFeature Maskingï¼‰</strong> æ¥ç”Ÿæˆä¸¤ä¸ªç›¸å…³çš„å­å›¾ã€‚</li>\n<li><strong>å¯¹æ¯”æŸå¤±ï¼ˆContrastive Lossï¼‰</strong> ï¼šå°†æ¥è‡ªåŒä¸€åŸå§‹èŠ‚ç‚¹çš„è¡¨ç¤ºä½œä¸º<strong>æ­£æ ·æœ¬å¯¹</strong>ï¼Œæ¥è‡ªä¸åŒèŠ‚ç‚¹çš„è¡¨ç¤ºä½œä¸º<strong>è´Ÿæ ·æœ¬å¯¹</strong>ã€‚ç„¶åä½¿ç”¨InfoNCEç­‰å¯¹æ¯”æŸå¤±å‡½æ•°ï¼Œåœ¨åµŒå…¥ç©ºé—´ä¸­æ‹‰è¿‘æ­£æ ·æœ¬ï¼Œæ¨å¼€è´Ÿæ ·æœ¬ã€‚</li>\n</ul>\n<p>è¿™ç§è‡ªç›‘ç£çš„è®­ç»ƒæ–¹å¼ï¼Œå¯ä»¥å¸®åŠ©GNNå­¦ä¹ åˆ°å¯¹å™ªå£°ä¸æ•æ„Ÿçš„ã€æ›´å…·æœ¬è´¨æ€§çš„ç»“æ„ä¿¡æ¯ï¼Œå³ä½¿åœ¨æ ‡ç­¾æ•°æ®ç¨€ç–çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å–å¾—ä¼˜å¼‚æ•ˆæœã€‚</p>\n<details class=\"hint-container details\"><summary>å›¾å¯¹æ¯”å­¦ä¹ æŸå¤± (InfoNCE)</summary>\n<div class=\"language-python line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"python\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-python\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> GraphContrastiveLoss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Module</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> temperature</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0.1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">        super</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">GraphContrastiveLoss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">__init__</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">temperature </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> temperature</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">criterion </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">CrossEntropyLoss</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> forward</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> z2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">):</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        Args:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">            z1, z2: ä¸¤ä¸ªå›¾å¢å¼ºè§†å›¾çš„èŠ‚ç‚¹åµŒå…¥, shape [N, D]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        sim </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mm</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">normalize</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">),</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> F</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">normalize</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">z2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">T</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> /</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">temperature</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # æ­£æ ·æœ¬åœ¨å¯¹è§’çº¿ä¸Š</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        labels </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">arange</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)).</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">to</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">device</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">        # è®¡ç®—æŸå¤±</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        loss </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">criterion</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sim</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> labels</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> loss</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<h2 id=\"ğŸ“–-å»¶ä¼¸é˜…è¯»\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#ğŸ“–-å»¶ä¼¸é˜…è¯»\"><span>ğŸ“– å»¶ä¼¸é˜…è¯»</span></a></h2>\n<p><strong>ç»å…¸è®ºæ–‡</strong>ï¼š</p>\n<ul>\n<li><a href=\"https://arxiv.org/abs/2002.02126\" target=\"_blank\" rel=\"noopener noreferrer\">LightGCN: Simplifying and Powering Graph Convolution Network for Recommendation (SIGIR'20)</a></li>\n<li><a href=\"https://arxiv.org/abs/1806.01973\" target=\"_blank\" rel=\"noopener noreferrer\">Graph Convolutional Neural Networks for Web-Scale Recommender Systems (KDD'18, PinSage)</a></li>\n<li><a href=\"https://arxiv.org/abs/1903.07293\" target=\"_blank\" rel=\"noopener noreferrer\">Heterogeneous Graph Attention Network (WWW'19, HAN)</a></li>\n<li><a href=\"https://arxiv.org/abs/2010.10783\" target=\"_blank\" rel=\"noopener noreferrer\">Self-supervised Graph Learning for Recommendation (SIGIR'21, SGL)</a></li>\n</ul>\n<p><strong>å¼€æºæ¡†æ¶</strong>ï¼š</p>\n<ul>\n<li><a href=\"https://github.com/pyg-team/pytorch_geometric\" target=\"_blank\" rel=\"noopener noreferrer\">PyTorch Geometric (PyG)</a>ï¼šæœ€æµè¡Œçš„GNNåº“ä¹‹ä¸€ï¼Œæä¾›äº†å¤§é‡GNNæ¨¡å‹å’Œå·¥å…·ã€‚</li>\n<li><a href=\"https://github.com/dmlc/dgl\" target=\"_blank\" rel=\"noopener noreferrer\">DGL (Deep Graph Library)</a>ï¼šå¦ä¸€ä¸ªå¼ºå¤§çš„å›¾å­¦ä¹ æ¡†æ¶ï¼Œæ”¯æŒå¤šç§åç«¯ã€‚</li>\n<li><a href=\"https://github.com/RUCAIBox/RecBole\" target=\"_blank\" rel=\"noopener noreferrer\">RecBole</a>ï¼šä¸€ä¸ªç»Ÿä¸€ã€å…¨é¢çš„æ¨èç®—æ³•å¤ç°åº“ï¼ŒåŒ…å«äº†å¤šç§GNNæ¨¡å‹ã€‚</li>\n</ul>\n<blockquote>\n<p>ğŸ§  <strong>æ€è€ƒé¢˜</strong></p>\n<ol>\n<li><strong>LightGCN vs. GCN</strong>ï¼šä½ è®¤ä¸ºLightGCNç§»é™¤çš„éçº¿æ€§å’Œç‰¹å¾å˜æ¢ï¼Œä¸ºä»€ä¹ˆåœ¨ååŒè¿‡æ»¤åœºæ™¯ä¸‹æ˜¯&quot;å¤šä½™&quot;çš„ï¼Ÿå®ƒå¯èƒ½åœ¨ä»€ä¹ˆç±»å‹çš„å›¾æ•°æ®ä¸Šè¡¨ç°ä¸ä½³ï¼Ÿ</li>\n<li><strong>é‡‡æ ·ç­–ç•¥çš„æƒè¡¡</strong>ï¼šPinSageçš„éšæœºæ¸¸èµ°é‡‡æ ·ç›¸æ¯”å‡åŒ€é‚»å±…é‡‡æ ·ï¼Œå…¶ä¼˜åŠ¿å’ŒåŠ£åŠ¿åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½ å¯èƒ½ä¼šé€‰æ‹©åè€…ï¼Ÿ</li>\n<li><strong>å†·å¯åŠ¨é—®é¢˜</strong>ï¼šå¯¹äºä¸€ä¸ªæ²¡æœ‰ä»»ä½•äº¤äº’çš„æ–°ç”¨æˆ·ï¼ˆ&quot;å†·å¯åŠ¨&quot;ç”¨æˆ·ï¼‰ï¼ŒGNNæ¨¡å‹ï¼ˆç‰¹åˆ«æ˜¯LightGCNï¼‰å°†å¦‚ä½•ä¸ºä»–ç”ŸæˆåµŒå…¥å¹¶è¿›è¡Œæ¨èï¼Ÿä½ æœ‰ä»€ä¹ˆæ”¹è¿›çš„æ€è·¯å—ï¼Ÿ</li>\n<li><strong>å…ƒè·¯å¾„çš„è®¾è®¡</strong>ï¼šåœ¨ä¸€ä¸ªåŒ…å«&quot;ç”¨æˆ·-æœç´¢-ç‰©å“-è´­ä¹°&quot;è¡Œä¸ºçš„ç”µå•†åœºæ™¯ä¸­ï¼Œè¯·ä½ è®¾è®¡è‡³å°‘ä¸‰æ¡æœ‰æ„ä¹‰çš„å…ƒè·¯å¾„ï¼Œå¹¶è¯´æ˜å®ƒä»¬å„è‡ªèƒ½æ•æ‰åˆ°ä»€ä¹ˆæ¨èä¿¡å·ã€‚</li>\n<li><strong>å›¾å¢å¼ºçš„é£é™©</strong>ï¼šå›¾å¯¹æ¯”å­¦ä¹ ä¸­çš„æ•°æ®å¢å¼ºï¼ˆå¦‚åˆ è¾¹ã€åˆ ç‚¹ï¼‰å¦‚æœæ“ä½œä¸å½“ï¼Œå¯èƒ½ä¼šç ´åå›¾çš„å…³é”®ç»“æ„ä¿¡æ¯ã€‚ä½ è®¤ä¸ºè¯¥å¦‚ä½•è®¾ç½®å¢å¼ºçš„å¼ºåº¦ï¼ˆæ¯”å¦‚åˆ é™¤æ¯”ä¾‹ï¼‰ï¼Œä»¥åœ¨&quot;åˆ›é€ å¤šæ ·æ€§&quot;å’Œ&quot;ä¿æŒç»“æ„&quot;ä¹‹é—´å–å¾—å¹³è¡¡ï¼Ÿ</li>\n</ol>\n</blockquote>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"åœ¨æ¨èç³»ç»Ÿçš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å¯»æ‰¾èƒ½æ›´æ·±åˆ»ç†è§£ç”¨æˆ·ä¸ç‰©å“ä¹‹é—´å¤æ‚å…³ç³»çš„æ–¹æ³•ã€‚ä¼ ç»Ÿçš„ååŒè¿‡æ»¤å…³æ³¨å…±ç°å…³ç³»ï¼Œè€Œæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆå¦‚DINã€BSTï¼‰åˆ™ç²¾äºæ•æ‰åºåˆ—ä¾èµ–ã€‚ç„¶è€Œï¼Œå®ƒä»¬åœ¨æŸç§ç¨‹åº¦ä¸Šéƒ½å°†ç”¨æˆ·å’Œç‰©å“è§†ä¸ºç‹¬ç«‹çš„ä¸ªä½“ï¼Œå¿½ç•¥äº†ä¸€ä¸ªè‡³å…³é‡è¦çš„ä¿¡æ¯ç»´åº¦â€”â€”**è¿æ¥ï¼ˆConnectionsï¼‰**ã€‚\n\n**å›¾ç¥ç»ç½‘ç»œï¼ˆGraph Neural Network, GNNï¼‰** ä¸ºæ¨èç³»ç»Ÿå¸¦æ¥äº†å…¨æ–°çš„ä¸–ç•Œè§‚ã€‚å®ƒä¸å†å°†ç³»ç»Ÿè§†ä¸ºç”¨æˆ·çš„é›†åˆå’Œç‰©å“çš„é›†åˆï¼Œè€Œæ˜¯çœ‹ä½œä¸€ä¸ªç”±ç”¨æˆ·ã€ç‰©å“ä»¥åŠå®ƒä»¬ä¹‹é—´çº·ç¹å¤æ‚çš„äº¤äº’å…³ç³»å…±åŒæ„æˆçš„å·¨å¤§**å›¾ï¼ˆGraphï¼‰**ã€‚åœ¨è¿™ä¸ªè§†è§’ä¸‹ï¼Œç”¨æˆ·çš„å…´è¶£ä¸å†ä»…ä»…ç”±å…¶å†å²è¡Œä¸ºåºåˆ—å®šä¹‰ï¼Œæ›´ç”±å…¶åœ¨æ•´ä¸ª\"ä¿¡æ¯ç”Ÿæ€\"ä¸­çš„ä½ç½®æ‰€å†³å®šã€‚\n\n### ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§ï¼Ÿ\n\n1.  **è¶…è¶Šä¸€é˜¶å…³ç³»**ï¼šä½ çš„å…´è¶£ä¸ä»…å’Œä½ ç›´æ¥ç‚¹å‡»è¿‡çš„ç‰©å“ï¼ˆä¸€é˜¶é‚»å±…ï¼‰æœ‰å…³ï¼Œä¹Ÿå’Œ\"ç‚¹å‡»è¿‡åŒæ ·ç‰©å“çš„å…¶ä»–äºº\"ï¼ˆäºŒé˜¶é‚»å±…ï¼‰ä»¥åŠ\"é‚£äº›äººè¿˜å–œæ¬¢çš„å…¶ä»–ç‰©å“\"ï¼ˆä¸‰é˜¶é‚»å±…ï¼‰æœ‰å…³ã€‚GNNé€šè¿‡åœ¨å›¾ä¸Šä¼ æ’­ä¿¡æ¯ï¼Œèƒ½å¤Ÿè‡ªç„¶åœ°æ•æ‰è¿™ç§**é«˜é˜¶ä¾èµ–ï¼ˆHigh-order Proximityï¼‰**ï¼Œå‘æ˜å‡ºæ›´æ·±å±‚æ¬¡çš„å…³è”ã€‚\n2.  **ç»“æ„åŒ–ä¿¡æ¯çš„åŠ›é‡**ï¼šå›¾æœ¬èº«å°±æ˜¯ä¸€ç§å¼ºå¤§çš„ç»“æ„åŒ–ä¿¡æ¯ã€‚èŠ‚ç‚¹çš„åº¦æ•°ã€èšç±»æƒ…å†µã€åœ¨å›¾ä¸­çš„ä¸­å¿ƒæ€§ç­‰æ‹“æ‰‘ç‰¹å¾ï¼Œéƒ½ä¸ºç†è§£èŠ‚ç‚¹ï¼ˆç”¨æˆ·/ç‰©å“ï¼‰çš„å±æ€§æä¾›äº†ä¸°å¯Œçº¿ç´¢ã€‚\n3.  **ç»Ÿä¸€çš„å»ºæ¨¡æ¡†æ¶**ï¼šæ— è®ºæ˜¯ç”¨æˆ·ä¸ç‰©å“çš„äº¤äº’ï¼ˆäºŒéƒ¨å›¾ï¼‰ã€ç‰©å“ä¸ç‰©å“çš„ç›¸ä¼¼å…³ç³»ï¼ˆåŒè´¨å›¾ï¼‰ï¼Œè¿˜æ˜¯ç”¨æˆ·ä¹‹é—´çš„ç¤¾äº¤å…³ç³»ï¼ˆç¤¾äº¤ç½‘ç»œï¼‰ï¼Œç”šè‡³æ˜¯åŒ…å«å“ç‰Œã€ç±»åˆ«ç­‰å¤šç§èŠ‚ç‚¹çš„å¤æ‚åœºæ™¯ï¼ˆå¼‚è´¨å›¾ï¼‰ï¼ŒGNNéƒ½èƒ½æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å»ºæ¨¡æ¡†æ¶ã€‚\n\n```mermaid\ngraph TD\n    subgraph \"æ¨èç³»ç»Ÿä¸­çš„å›¾ç»“æ„\"\n        A[\"ä¸‡ç‰©çš†å¯å›¾\"] --> B[\"ç”¨æˆ·-ç‰©å“äºŒéƒ¨å›¾<br>(User-Item Bipartite Graph)\"]\n        A --> C[\"ç‰©å“-ç‰©å“ç›¸ä¼¼å›¾<br>(Item-Item Graph)\"]\n        A --> D[\"ç”¨æˆ·-ç”¨æˆ·ç¤¾äº¤å›¾<br>(User-User Graph)\"]\n        A --> E[\"å¤šç±»å‹å¼‚è´¨å›¾<br>(Heterogeneous Graph)\"]\n    end\n    B -- \"æ ¸å¿ƒåœºæ™¯\" --> F(\"å»ºæ¨¡ç”¨æˆ·ä¸ç‰©å“çš„ç›´æ¥äº¤äº’\")\n    C -- \"è¡¥å……ä¿¡æ¯\" --> G(\"å¦‚'è´­ä¹°äº†Aä¹Ÿè´­ä¹°äº†B'\")\n    D -- \"è¡¥å……ä¿¡æ¯\" --> H(\"å¦‚'å¥½å‹çš„å…´è¶£å½±å“'\")\n    E -- \"å¤æ‚åœºæ™¯\" --> I(\"ç»Ÿä¸€å»ºæ¨¡User, Item, Category, Brandç­‰å¤šç§èŠ‚ç‚¹\")\n```\n\n## ğŸš€ LightGCNï¼šå¤§é“è‡³ç®€ï¼Œè¿”ç’å½’çœŸ\n\nåœ¨GNNçš„æ—©æœŸæ¢ç´¢ä¸­ï¼Œç ”ç©¶è€…ä»¬å€¾å‘äºå°†ç”¨äºè®¡ç®—æœºè§†è§‰æˆ–è‡ªç„¶è¯­è¨€å¤„ç†çš„å¤æ‚GNNæ¨¡å‹ï¼ˆå¦‚GCN, GATï¼‰ç›´æ¥è¿ç§»åˆ°æ¨èåœºæ™¯ã€‚è¿™äº›æ¨¡å‹é€šå¸¸åŒ…å«ä¸‰ä¸ªæ ¸å¿ƒæ“ä½œï¼š**ç‰¹å¾å˜æ¢**ï¼ˆé€šè¿‡æƒé‡çŸ©é˜µ`W`ï¼‰ã€**é‚»å±…èšåˆ**ï¼ˆå¦‚æ±‚å’Œæˆ–å–å¹³å‡ï¼‰å’Œ**éçº¿æ€§æ¿€æ´»**ï¼ˆå¦‚`ReLU`ï¼‰ã€‚\n\nç„¶è€Œï¼Œä½•å‘å—æ•™æˆå›¢é˜Ÿåœ¨2020å¹´æå‡ºçš„ **LightGCN** é¢ è¦†äº†è¿™ä¸€æ€è·¯ã€‚ä»–ä»¬é€šè¿‡å¤§é‡çš„å®éªŒæ•é”åœ°å‘ç°ï¼Œåœ¨æ¨èç³»ç»Ÿçš„ååŒè¿‡æ»¤åœºæ™¯ä¸‹ï¼Œç‰¹å¾å˜æ¢å’Œéçº¿æ€§æ¿€æ´»è¿™ä¸¤ä¸ªæ“ä½œå¯¹äºæ€§èƒ½çš„æå‡æ˜¯**éå¿…è¦ç”šè‡³æœ‰å®³çš„**ã€‚\n\n### æ ¸å¿ƒæ€æƒ³ï¼šå‡æ³•å³æ˜¯åŠ æ³•\n\nLightGCNçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨æ¨èçš„IDç±»ç‰¹å¾ä¸Šï¼Œæˆ‘ä»¬çœŸæ­£éœ€è¦çš„æ˜¯çº¯ç²¹çš„ã€æ— æŸçš„**ä¿¡æ¯ä¼ æ’­ï¼ˆInformation Propagationï¼‰**ï¼Œè€Œä¸æ˜¯å¤æ‚çš„ç‰¹å¾å˜æ¢ã€‚ç”¨æˆ·çš„æœ€ç»ˆåµŒå…¥ï¼Œåº”è¯¥æ˜¯å…¶è‡ªèº«åŸå§‹åµŒå…¥ä¸ä»é‚»å±…èŠ‚ç‚¹ï¼ˆå¦‚å…¶äº¤äº’è¿‡çš„ç‰©å“ï¼‰ä¼ æ’­è¿‡æ¥çš„ä¿¡æ¯çš„çº¿æ€§ç»„åˆã€‚\n\nå› æ­¤ï¼ŒLightGCNå¤§èƒ†åœ°å»é™¤äº†ç‰¹å¾å˜æ¢å’Œéçº¿æ€§æ¿€æ´»ï¼Œå…¶æ ¸å¿ƒä¼ æ’­å…¬å¼æå…¶ç®€æ´ï¼š\n\n$$ e_u^{(k+1)} = \\sum_{i \\in N_u} \\frac{1}{\\sqrt{|N_u||N_i|}} e_i^{(k)} \\quad \\text{å’Œ} \\quad e_i^{(k+1)} = \\sum_{u \\in N_i} \\frac{1}{\\sqrt{|N_i||N_u|}} e_u^{(k)} $$\n\nå…¶ä¸­ï¼Œ$e_u^{(k)}$ æ˜¯ç”¨æˆ· $u$ åœ¨ç¬¬ $k$ å±‚çš„åµŒå…¥ï¼Œ$\\mathcal{N}_u$ æ˜¯ç”¨æˆ· $u$ çš„é‚»å±…ï¼ˆç‰©å“ï¼‰é›†åˆã€‚è¿™ä¸ªå…¬å¼æœ¬è´¨ä¸Šå°±æ˜¯åœ¨åš**å½’ä¸€åŒ–åçš„é‚»å±…ä¿¡æ¯èšåˆ**ã€‚ç»è¿‡ $K$ å±‚ä¼ æ’­åï¼ŒLightGCNå°†æ¯ä¸€å±‚çš„åµŒå…¥è¿›è¡ŒåŠ æƒæ±‚å’Œï¼ˆé€šå¸¸æ˜¯ç®€å•å¹³å‡ï¼‰ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç”¨æˆ·å’Œç‰©å“è¡¨ç¤ºï¼Œç”¨äºè®¡ç®—æ¨èåˆ†æ•°ã€‚\n\n::: details LightGCN å®Œæ•´ PyTorch å®ç°\n```python\nimport torch\nimport torch.nn as nn\n\nclass LightGCN(nn.Module):\n    def __init__(self, num_users, num_items, adj_matrix, embed_dim=64, num_layers=3):\n        \"\"\"\n        Args:\n            num_users (int): ç”¨æˆ·æ•°é‡\n            num_items (int): ç‰©å“æ•°é‡\n            adj_matrix (torch.sparse.Tensor): æ ‡å‡†åŒ–çš„é‚»æ¥çŸ©é˜µ D^(-1/2)AD^(-1/2)\n            embed_dim (int): åµŒå…¥ç»´åº¦\n            num_layers (int): å›¾å·ç§¯å±‚æ•°\n        \"\"\"\n        super(LightGCN, self).__init__()\n        self.num_users = num_users\n        self.num_items = num_items\n        self.adj_matrix = adj_matrix\n        self.embed_dim = embed_dim\n        self.num_layers = num_layers\n        \n        # å®šä¹‰ç”¨æˆ·å’Œç‰©å“çš„åˆå§‹åµŒå…¥ E_0\n        self.user_embedding = nn.Embedding(num_users, embed_dim)\n        self.item_embedding = nn.Embedding(num_items, embed_dim)\n        \n        # åˆå§‹åŒ–åµŒå…¥æƒé‡\n        nn.init.xavier_uniform_(self.user_embedding.weight)\n        nn.init.xavier_uniform_(self.item_embedding.weight)\n        \n    def forward(self):\n        # è·å–æ‰€æœ‰èŠ‚ç‚¹çš„åˆå§‹åµŒå…¥\n        # E_0 = [E_U, E_I]\n        ego_embeddings = torch.cat([self.user_embedding.weight, self.item_embedding.weight], dim=0)\n        \n        # ç”¨äºå­˜å‚¨æ¯ä¸€å±‚ä¼ æ’­åçš„åµŒå…¥\n        all_layer_embeddings = [ego_embeddings]\n        \n        # è¿›è¡Œå¤šå±‚å›¾å·ç§¯ (ä¿¡æ¯ä¼ æ’­)\n        for layer in range(self.num_layers):\n            # E_k+1 = A_hat * E_k\n            ego_embeddings = torch.sparse.mm(self.adj_matrix, ego_embeddings)\n            all_layer_embeddings.append(ego_embeddings)\n        \n        # å°†æ‰€æœ‰å±‚çš„åµŒå…¥è¿›è¡ŒåŠ æƒæ±‚å’Œï¼ˆè¿™é‡Œæ˜¯å¹³å‡ï¼‰\n        # E_final = (1/K+1) * (E_0 + E_1 + ... + E_K)\n        final_embeddings = torch.mean(torch.stack(all_layer_embeddings, dim=1), dim=1)\n        \n        # ä»æœ€ç»ˆåµŒå…¥ä¸­åˆ†ç¦»å‡ºç”¨æˆ·å’Œç‰©å“çš„åµŒå…¥\n        users_emb, items_emb = torch.split(final_embeddings, [self.num_users, self.num_items])\n        \n        return users_emb, items_emb\n\n    def compute_loss(self, users_emb, items_emb, user_ids, pos_item_ids, neg_item_ids):\n        \"\"\"\n        è®¡ç®—BPRæŸå¤±\n        \"\"\"\n        u_embeds = users_emb[user_ids]\n        pos_i_embeds = items_emb[pos_item_ids]\n        neg_i_embeds = items_emb[neg_item_ids]\n        \n        pos_scores = torch.sum(u_embeds * pos_i_embeds, dim=1)\n        neg_scores = torch.sum(u_embeds * neg_i_embeds, dim=1)\n        \n        # BPR Loss\n        loss = -torch.mean(torch.log(torch.sigmoid(pos_scores - neg_scores)))\n        return loss\n```\n:::\n\nLightGCNçš„æˆåŠŸè¯æ˜äº†ï¼Œåœ¨ç‰¹å®šä»»åŠ¡ä¸­ï¼Œ**é’ˆå¯¹æ€§çš„ç®€åŒ–è¿œèƒœäºç›²ç›®çš„å †ç Œå¤æ‚æ¨¡å—**ã€‚å®ƒä¸ºæ¨èé¢†åŸŸçš„GNNè®¾è®¡æä¾›äº†ä¸€ä¸ªä¼˜é›…ã€é«˜æ•ˆä¸”å¼ºå¤§çš„åŸºçº¿ã€‚\n\n## ğŸ­ PinSageï¼šåº”å¯¹Web-ScaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº\n\nLightGCNè™½ç„¶å¼ºå¤§ï¼Œä½†å®ƒä¾èµ–äºå¯¹æ•´ä¸ªå›¾è¿›è¡Œå…¨é‡è®¡ç®—ï¼ˆfull-batch trainingï¼‰ï¼Œè¿™åœ¨åŠ¨è¾„æ•°åäº¿èŠ‚ç‚¹ã€æ•°ç™¾äº¿è¾¹çš„å·¥ä¸šçº§å¤§å›¾ï¼ˆå¦‚Pinterestã€æ·˜å®ã€å¾®ä¿¡ï¼‰é¢å‰æ˜¯å®Œå…¨ä¸å¯è¡Œçš„ã€‚\n\n**PinSage** æ˜¯ç”±Pinterestå›¢é˜Ÿåœ¨2018å¹´æå‡ºçš„ï¼Œæ˜¯ç¬¬ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸ŠæˆåŠŸåº”ç”¨åˆ°è¶…å¤§è§„æ¨¡å›¾ä¸Šçš„GNNæ¨èæ¨¡å‹ï¼Œæ˜¯GNNå·¥ä¸šè½åœ°çš„é‡è¦é‡Œç¨‹ç¢‘ã€‚å®ƒçš„ä¸€ç³»åˆ—è®¾è®¡ï¼Œæ ¸å¿ƒéƒ½æ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªé—®é¢˜ï¼š**å¯æ‰©å±•æ€§ï¼ˆScalabilityï¼‰**ã€‚\n\n### æ ¸å¿ƒæ€æƒ³ï¼šé‡‡æ ·ä¸èšåˆ\n\nPinSageçš„æ¶æ„å®Œå…¨æ‘’å¼ƒäº†å…¨å›¾è®¡ç®—çš„æ€è·¯ï¼Œè½¬è€Œé‡‡ç”¨**åŸºäºé‡‡æ ·çš„å°æ‰¹é‡ï¼ˆmini-batchï¼‰è®­ç»ƒ**æ¨¡å¼ã€‚å…¶æ ¸å¿ƒåˆ›æ–°å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼š\n\n1.  **é‚»å±…é‡‡æ ·ï¼ˆNeighbor Samplingï¼‰**ï¼šå¯¹äºä¸€ä¸ªä¸­å¿ƒèŠ‚ç‚¹ï¼Œä¸æ˜¯èšåˆå®ƒæ‰€æœ‰çš„é‚»å±…ä¿¡æ¯ï¼Œè€Œæ˜¯åª**é‡‡æ ·å›ºå®šæ•°é‡çš„é‚»å±…**ï¼ˆæ¯”å¦‚20ä¸ªï¼‰ã€‚è¿™æ ·ï¼Œæ— è®ºä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šå°‘é‚»å±…ï¼Œå®ƒçš„è®¡ç®—é‡éƒ½æ˜¯æ’å®šçš„ï¼Œä»è€Œè§£å†³äº†\"åº¦æ•°çˆ†ç‚¸\"é—®é¢˜ã€‚\n\n2.  **åŸºäºéšæœºæ¸¸èµ°çš„é‡‡æ ·ç­–ç•¥**ï¼šå¦‚ä½•é‡‡æ ·åˆ°\"é‡è¦\"çš„é‚»å±…ï¼ŸPinSageæ²¡æœ‰ä½¿ç”¨å‡åŒ€é‡‡æ ·ï¼Œè€Œæ˜¯è®¾è®¡äº†ä¸€ç§å·§å¦™çš„**åŸºäºéšæœºæ¸¸èµ°çš„é‡‡æ ·**ã€‚ä»ä¸­å¿ƒèŠ‚ç‚¹å‡ºå‘ï¼Œè¿›è¡Œå¤šæ¬¡çŸ­è·ç¦»çš„éšæœºæ¸¸èµ°ï¼Œå¹¶å°†æ¸¸èµ°ç»è¿‡çš„èŠ‚ç‚¹ä½œä¸ºé‚»å±…ã€‚è¿™ç§æ–¹æ³•èƒ½æ›´æœ‰æ•ˆåœ°é‡‡æ ·åˆ°ä¸ä¸­å¿ƒèŠ‚ç‚¹**ç»“æ„æ›´ç›¸ä¼¼ã€å…³ç³»æ›´ç´§å¯†**çš„èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ä»…ä»…æ˜¯ç›´æ¥ç›¸è¿çš„èŠ‚ç‚¹ã€‚\n\n3.  **å¤šå±‚èšåˆï¼ˆOn-the-fly Computationï¼‰**ï¼šPinSageçš„è®¡ç®—æ˜¯\"å³æ—¶\"çš„ã€‚å½“è®¡ç®—ä¸€ä¸ªèŠ‚ç‚¹çš„è¡¨ç¤ºæ—¶ï¼Œå®ƒä¼šå…ˆé‡‡æ ·å…¶ä¸€é˜¶é‚»å±…ï¼Œç„¶åä¸ºè¿™äº›é‚»å±…é‡‡æ ·å®ƒä»¬çš„é‚»å±…ï¼ˆå³ä¸­å¿ƒèŠ‚ç‚¹çš„äºŒé˜¶é‚»å±…ï¼‰ï¼Œå±‚å±‚é€’è¿›ã€‚æ•´ä¸ªè®¡ç®—å›¾æ˜¯åœ¨ä¸€ä¸ªæ‰¹æ¬¡ä¸­åŠ¨æ€æ„å»ºçš„ï¼Œè¿™è¢«ç§°ä¸º\"on-the-fly\"å·ç§¯ã€‚\n\n::: details PinSage æ ¸å¿ƒæ€æƒ³å®ç°\n```python\nimport torch\nimport torch.nn as nn\nimport torch.nn.functional as F\nimport random\n\n# æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„å®ç°ï¼Œæ—¨åœ¨è¯´æ˜PinSageçš„æ ¸å¿ƒæ€æƒ³ï¼Œ\n# å·¥ä¸šçº§çš„å®ç°ä¼šå¤æ‚å¾—å¤šï¼Œå¹¶éœ€è¦é«˜æ•ˆçš„å›¾æ•°æ®åº“æ”¯æŒã€‚\n\nclass SAGEConv(nn.Module):\n    \"\"\"\n    PinSageçš„æ ¸å¿ƒå·ç§¯å±‚ï¼Œèšåˆé‡‡æ ·åˆ°çš„é‚»å±…ä¿¡æ¯\n    \"\"\"\n    def __init__(self, in_dim, out_dim):\n        super(SAGEConv, self).__init__()\n        # èšåˆåçš„é‚»å±…ä¿¡æ¯å’ŒèŠ‚ç‚¹è‡ªèº«ä¿¡æ¯æ‹¼æ¥ï¼Œæ‰€ä»¥æ˜¯ in_dim * 2\n        self.agg_layer = nn.Linear(in_dim * 2, out_dim)\n        \n    def forward(self, self_feats, neighbor_feats):\n        \"\"\"\n        Args:\n            self_feats (Tensor): ä¸­å¿ƒèŠ‚ç‚¹è‡ªèº«çš„ç‰¹å¾ [batch_size, in_dim]\n            neighbor_feats (Tensor): é‡‡æ ·å¹¶èšåˆåçš„é‚»å±…ç‰¹å¾ [batch_size, in_dim]\n        \"\"\"\n        # æ‹¼æ¥\n        combined = torch.cat([self_feats, neighbor_feats], dim=1)\n        # æ›´æ–°\n        output = F.relu(self.agg_layer(combined))\n        # æ ‡å‡†åŒ–\n        return F.normalize(output, p=2, dim=1)\n\nclass PinSage(nn.Module):\n    def __init__(self, in_dim, hidden_dim, num_layers=2):\n        super(PinSage, self).__init__()\n        self.num_layers = num_layers\n        self.layers = nn.ModuleList()\n        # åˆ›å»ºå¤šå±‚SAGEConv\n        for i in range(num_layers):\n            layer_in_dim = in_dim if i == 0 else hidden_dim\n            self.layers.append(SAGEConv(layer_in_dim, hidden_dim))\n\n    def forward(self, node_ids, full_feature_matrix, adj_list, num_samples_per_layer):\n        \"\"\"\n        PinSageçš„å‰å‘ä¼ æ’­\n        Args:\n            node_ids (list): ä¸€ä¸ªmini-batchçš„ä¸­å¿ƒèŠ‚ç‚¹ID\n            full_feature_matrix (Tensor): åŒ…å«æ‰€æœ‰èŠ‚ç‚¹ç‰¹å¾çš„çŸ©é˜µ\n            adj_list (dict): å›¾çš„é‚»æ¥è¡¨è¡¨ç¤º {node_id: [neighbor1, neighbor2, ...]}\n            num_samples_per_layer (list): æ¯å±‚è¦é‡‡æ ·çš„é‚»å±…æ•°é‡, e.g., [20, 10] for 2 layers\n        \"\"\"\n        # h_l æ˜¯ç¬¬ l å±‚éœ€è¦çš„èŠ‚ç‚¹ç‰¹å¾\n        h = full_feature_matrix[node_ids]\n        \n        # ä»æœ€å¤–å±‚ (ç¬¬ k å±‚) å‘å†…å±‚ (ç¬¬ 1 å±‚) èšåˆ\n        for l in range(self.num_layers - 1, -1, -1):\n            # è·å–å½“å‰å±‚è®¡ç®—æ‰€éœ€è¦çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆä¸Šä¸€å±‚èšåˆçš„ç»“æœï¼‰\n            current_nodes = h.size(0) # å‡è®¾håŒ…å«äº†å½“å‰å±‚éœ€è¦çš„æ‰€æœ‰èŠ‚ç‚¹çš„ç‰¹å¾\n            \n            # 1. é‡‡æ ·é‚»å±…\n            sampled_neighbors = []\n            for node_id in node_ids: # éå†æ‰¹æ¬¡ä¸­çš„æ¯ä¸ªä¸­å¿ƒèŠ‚ç‚¹\n                neighbors = adj_list.get(node_id, [])\n                if len(neighbors) > num_samples_per_layer[l]:\n                    sampled = random.sample(neighbors, num_samples_per_layer[l])\n                else:\n                    sampled = neighbors # ä¸è¶³åˆ™å…¨éƒ¨é‡‡æ ·\n                sampled_neighbors.append(sampled)\n            \n            # 2. è·å–é‚»å±…ç‰¹å¾å¹¶èšåˆï¼ˆè¿™é‡Œç®€åŒ–ä¸ºå¹³å‡èšåˆï¼‰\n            neighbor_feats_list = []\n            for neighbors in sampled_neighbors:\n                if neighbors:\n                    neighbor_feats_list.append(torch.mean(full_feature_matrix[neighbors], dim=0))\n                else: # å¤„ç†å­¤ç«‹ç‚¹\n                    neighbor_feats_list.append(torch.zeros_like(full_feature_matrix[0]))\n            \n            aggregated_neighbors = torch.stack(neighbor_feats_list)\n\n            # 3. èšåˆè‡ªèº«ä¸é‚»å±…ï¼Œé€šè¿‡SAGEConvå±‚æ›´æ–°\n            # æ³¨æ„ï¼šè¿™é‡Œçš„ h éœ€è¦æ­£ç¡®å¯¹åº”ä¸Š\n            self_feats = full_feature_matrix[node_ids] # è·å–ä¸­å¿ƒèŠ‚ç‚¹å½“å‰å±‚çš„ç‰¹å¾\n            h = self.layers[l](self_feats, aggregated_neighbors)\n            node_ids = # ... æ›´æ–°ä¸‹ä¸€å±‚éœ€è¦è®¡ç®—çš„èŠ‚ç‚¹ ...\n        \n        return h\n```\n:::\n\nPinSageä¸ä»…æä¾›äº†ä¸€ä¸ªå¯æ‰©å±•çš„GNNæ¶æ„ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå±•ç¤ºäº†ä¸€æ•´å¥—å°†GNNåº”ç”¨äºçœŸå®ã€æµ·é‡ã€å¤æ‚å·¥ä¸šåœºæ™¯çš„**å·¥ç¨‹èŒƒå¼**ï¼ŒåŒ…æ‹¬é‡‡æ ·ã€è´Ÿé‡‡æ ·ã€æ¨¡å‹éƒ¨ç½²ç­‰ï¼Œå½±å“æ·±è¿œã€‚\n\n## ğŸŒˆ HANï¼šæ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§\n\nç°å®ä¸–ç•Œçš„å›¾å¾ˆå°‘æ˜¯åŒè´¨çš„ã€‚ä¸€ä¸ªç”µå•†æ¨èåœºæ™¯çš„å›¾ï¼Œè‡³å°‘åŒ…å«ç”¨æˆ·ã€ç‰©å“ã€å“ç‰Œã€ç±»åˆ«ç­‰å¤šç§ç±»å‹çš„èŠ‚ç‚¹ï¼Œä»¥åŠç‚¹å‡»ã€è´­ä¹°ã€å±äºï¼ˆç‰©å“å±äºæŸç±»åˆ«ï¼‰ç­‰å¤šç§ç±»å‹çš„è¾¹ã€‚è¿™ç§å›¾è¢«ç§°ä¸º**å¼‚è´¨ä¿¡æ¯ç½‘ç»œï¼ˆHeterogeneous Information Network, HINï¼‰**ã€‚\n\nç”¨åŒè´¨å›¾æ¨¡å‹ï¼ˆå¦‚LightGCNï¼‰æ¥å¤„ç†HINï¼Œä¼šä¸¢å¤±æ‰èŠ‚ç‚¹å’Œè¾¹çš„ç±»å‹ä¿¡æ¯ï¼Œæ— æ³•åŒºåˆ†\"ç”¨æˆ·è´­ä¹°ç‰©å“\"å’Œ\"ç‰©å“å±äºæŸå“ç‰Œ\"è¿™ä¸¤ç§å…³ç³»çš„è¯­ä¹‰å·®å¼‚ã€‚**HAN (Heterogeneous Graph Attention Network)** å°±æ˜¯ä¸ºè§£å†³è¿™ä¸€é—®é¢˜è€Œè®¾è®¡çš„ã€‚\n\n### æ ¸å¿ƒæ€æƒ³ï¼šåŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›\n\nHANçš„ç²¾é«“åœ¨äºå…¶**å±‚æ¬¡åŒ–æ³¨æ„åŠ›ï¼ˆHierarchical Attentionï¼‰**æœºåˆ¶ï¼Œå®ƒåˆ†ä¸ºä¸¤ä¸ªå±‚çº§ï¼š\n\n1.  **èŠ‚ç‚¹çº§æ³¨æ„åŠ›ï¼ˆNode-level Attentionï¼‰**ï¼šé¦–å…ˆï¼Œå®šä¹‰è‹¥å¹²æ¡**å…ƒè·¯å¾„ï¼ˆMeta-pathï¼‰**ã€‚å…ƒè·¯å¾„æ˜¯è¿æ¥ä¸åŒç±»å‹èŠ‚ç‚¹çš„è·¯å¾„ï¼Œä¾‹å¦‚ `ç”¨æˆ·-ç‰©å“-ç”¨æˆ·` (U-I-U) è¿™æ¡å…ƒè·¯å¾„å¯ä»¥æ•æ‰åˆ°\"è´­ä¹°äº†ç›¸åŒç‰©å“\"çš„ç›¸ä¼¼ç”¨æˆ·ã€‚æ²¿ç€æ¯ä¸€æ¡å…ƒè·¯å¾„ï¼ŒHANä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶èšåˆé‚»å±…èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆä¸€ä¸ªåŸºäºç‰¹å®šå…ƒè·¯å¾„çš„åµŒå…¥ã€‚\n\n2.  **è¯­ä¹‰çº§æ³¨æ„åŠ›ï¼ˆSemantic-level Attentionï¼‰**ï¼šä¸€ä¸ªèŠ‚ç‚¹é€šè¿‡ä¸åŒçš„å…ƒè·¯å¾„ï¼Œä¼šå¾—åˆ°å¤šä¸ªä¸åŒè¯­ä¹‰çš„åµŒå…¥ï¼ˆå¦‚åŸºäºU-I-Uçš„åµŒå…¥å’ŒåŸºäºU-C-Uçš„åµŒå…¥ï¼‰ã€‚è¿™äº›ä¸åŒè¯­ä¹‰çš„é‡è¦æ€§æ˜¾ç„¶æ˜¯ä¸åŒçš„ã€‚å› æ­¤ï¼ŒHANå¼•å…¥äº†ç¬¬äºŒå±‚æ³¨æ„åŠ›ï¼Œå³è¯­ä¹‰çº§æ³¨æ„åŠ›ï¼Œæ¥å­¦ä¹ ä¸åŒå…ƒè·¯å¾„çš„é‡è¦æ€§æƒé‡ï¼Œæœ€ç»ˆå°†å¤šä¸ªè¯­ä¹‰åµŒå…¥åŠ æƒèåˆæˆä¸€ä¸ªç»Ÿä¸€çš„èŠ‚ç‚¹è¡¨ç¤ºã€‚\n\né€šè¿‡è¿™ç§æ–¹å¼ï¼ŒHANèƒ½å¤Ÿæ™ºèƒ½åœ°è¯†åˆ«å¹¶èåˆæ¥è‡ªä¸åŒç±»å‹å…³ç³»çš„ä¿¡æ¯ï¼Œä»è€Œå­¦ä¹ åˆ°æ›´ä¸°å¯Œã€æ›´å…·è¡¨ç°åŠ›çš„èŠ‚ç‚¹è¡¨ç¤ºã€‚\n\n::: details HAN æ ¸å¿ƒæ€æƒ³å®ç°\n```python\nimport torch\nimport torch.nn as nn\nimport torch.nn.functional as F\n\nclass SemanticAttention(nn.Module):\n    \"\"\"\n    HANä¸­çš„è¯­ä¹‰å±‚æ³¨æ„åŠ›ï¼Œç”¨äºèåˆä¸åŒå…ƒè·¯å¾„å¸¦æ¥çš„åµŒå…¥\n    \"\"\"\n    def __init__(self, in_dim, hidden_dim=128):\n        super(SemanticAttention, self).__init__()\n        self.project = nn.Sequential(\n            nn.Linear(in_dim, hidden_dim),\n            nn.Tanh(),\n            nn.Linear(hidden_dim, 1, bias=False)\n        )\n\n    def forward(self, z): # zæ˜¯ [num_nodes, num_metapaths, in_dim]\n        # è®¡ç®—æ¯ä¸ªå…ƒè·¯å¾„çš„é‡è¦æ€§ w_phi = q^T * tanh(W*z_phi + b)\n        w = self.project(z).mean(0)                    # [num_metapaths, 1]\n        beta = torch.softmax(w, dim=0)                 # [num_metapaths, 1]\n        beta = beta.expand((z.shape[0],) + beta.shape) # [num_nodes, num_metapaths, 1]\n        \n        # åŠ æƒæ±‚å’Œ\n        return (beta * z).sum(1)                       # [num_nodes, in_dim]\n\nclass HANLayer(nn.Module):\n    def __init__(self, num_metapaths, in_dim, out_dim, num_heads):\n        super(HANLayer, self).__init__()\n        # èŠ‚ç‚¹çº§æ³¨æ„åŠ›å±‚ (ä¸ºæ¯ç§å…ƒè·¯å¾„åˆ›å»ºä¸€ä¸ªGATå±‚)\n        self.gat_layers = nn.ModuleList([\n            # è¿™é‡Œçš„GATConvéœ€è¦èƒ½å¤„ç†å¼‚è´¨å›¾çš„è¾¹\n            # åœ¨å®è·µä¸­ä¼šç”¨PyGæˆ–DGLç­‰åº“ä¸­çš„HANConvæˆ–HGTConv\n            # GraphAttentionLayer(in_dim, out_dim, num_heads) for _ in range(num_metapaths)\n        ])\n        # è¯­ä¹‰çº§æ³¨æ„åŠ›å±‚\n        self.semantic_attention = SemanticAttention(in_dim=out_dim * num_heads)\n\n    def forward(self, g, h): # gæ˜¯å¼‚è´¨å›¾, hæ˜¯èŠ‚ç‚¹ç‰¹å¾å­—å…¸\n        semantic_embeddings = []\n        # å¯¹æ¯ä¸ªå…ƒè·¯å¾„ï¼ˆè¾¹ç±»å‹ï¼‰\n        for i, gat_layer in enumerate(self.gat_layers):\n            # ä½¿ç”¨å¯¹åº”çš„GATå±‚è¿›è¡ŒèŠ‚ç‚¹çº§èšåˆ\n            # semantic_embeddings.append(gat_layer(g.edge_type_subgraph([edge_type]), h))\n            pass # ä¼ªä»£ç \n        \n        # å°†ä¸åŒå…ƒè·¯å¾„çš„åµŒå…¥å †å èµ·æ¥\n        semantic_embeddings = torch.stack(semantic_embeddings, dim=1) # [N, num_metapaths, D_out]\n        \n        # é€šè¿‡è¯­ä¹‰æ³¨æ„åŠ›è¿›è¡Œèåˆ\n        return self.semantic_attention(semantic_embeddings)\n```\n:::\n\n\n## âš”ï¸ GNNçš„ç°ä»£è®­ç»ƒå¿ƒæ³•\n\né™¤äº†æ¨¡å‹æ¶æ„ï¼ŒGNNçš„è®­ç»ƒæ–¹å¼ä¹Ÿåœ¨ä¸æ–­æ¼”è¿›ã€‚ç°ä»£çš„GNNè®­ç»ƒï¼Œå°¤å…¶æ˜¯è‡ªç›‘ç£å­¦ä¹ çš„å¼•å…¥ï¼Œæå¤§åœ°æå‡äº†æ¨¡å‹çš„æ€§èƒ½å’Œé²æ£’æ€§ã€‚\n\n### å›¾å¯¹æ¯”å­¦ä¹ ï¼ˆGraph Contrastive Learningï¼‰\n\nå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**åœ¨åµŒå…¥ç©ºé—´ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„\"å¢å¼ºè§†å›¾\"åº”è¯¥ä¸å®ƒè‡ªèº«çš„å…¶ä»–\"å¢å¼ºè§†å›¾\"å°½å¯èƒ½ç›¸ä¼¼ï¼Œè€Œä¸å…¶ä»–èŠ‚ç‚¹çš„è§†å›¾å°½å¯èƒ½è¿œç¦»ã€‚**\n\n-   **å›¾å¢å¼ºï¼ˆGraph Augmentationï¼‰**ï¼šå¦‚ä½•åˆ›é€ \"å¢å¼ºè§†å›¾\"ï¼Ÿé€šå¸¸é€šè¿‡å¯¹åŸå›¾è¿›è¡Œéšæœºæ‰°åŠ¨ï¼Œå¦‚**éšæœºåˆ è¾¹ï¼ˆEdge Droppingï¼‰**ã€ **éšæœºèŠ‚ç‚¹ä¸¢å¼ƒï¼ˆNode Droppingï¼‰** æˆ– **ç‰¹å¾æ©ç ï¼ˆFeature Maskingï¼‰** æ¥ç”Ÿæˆä¸¤ä¸ªç›¸å…³çš„å­å›¾ã€‚\n-   **å¯¹æ¯”æŸå¤±ï¼ˆContrastive Lossï¼‰** ï¼šå°†æ¥è‡ªåŒä¸€åŸå§‹èŠ‚ç‚¹çš„è¡¨ç¤ºä½œä¸º**æ­£æ ·æœ¬å¯¹**ï¼Œæ¥è‡ªä¸åŒèŠ‚ç‚¹çš„è¡¨ç¤ºä½œä¸º**è´Ÿæ ·æœ¬å¯¹**ã€‚ç„¶åä½¿ç”¨InfoNCEç­‰å¯¹æ¯”æŸå¤±å‡½æ•°ï¼Œåœ¨åµŒå…¥ç©ºé—´ä¸­æ‹‰è¿‘æ­£æ ·æœ¬ï¼Œæ¨å¼€è´Ÿæ ·æœ¬ã€‚\n\nè¿™ç§è‡ªç›‘ç£çš„è®­ç»ƒæ–¹å¼ï¼Œå¯ä»¥å¸®åŠ©GNNå­¦ä¹ åˆ°å¯¹å™ªå£°ä¸æ•æ„Ÿçš„ã€æ›´å…·æœ¬è´¨æ€§çš„ç»“æ„ä¿¡æ¯ï¼Œå³ä½¿åœ¨æ ‡ç­¾æ•°æ®ç¨€ç–çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å–å¾—ä¼˜å¼‚æ•ˆæœã€‚\n\n::: details å›¾å¯¹æ¯”å­¦ä¹ æŸå¤± (InfoNCE)\n```python\nclass GraphContrastiveLoss(nn.Module):\n    def __init__(self, temperature=0.1):\n        super(GraphContrastiveLoss, self).__init__()\n        self.temperature = temperature\n        self.criterion = nn.CrossEntropyLoss()\n\n    def forward(self, z1, z2):\n        \"\"\"\n        Args:\n            z1, z2: ä¸¤ä¸ªå›¾å¢å¼ºè§†å›¾çš„èŠ‚ç‚¹åµŒå…¥, shape [N, D]\n        \"\"\"\n        # è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ\n        sim = torch.mm(F.normalize(z1), F.normalize(z2).T) / self.temperature\n        \n        # æ­£æ ·æœ¬åœ¨å¯¹è§’çº¿ä¸Š\n        labels = torch.arange(sim.size(0)).to(sim.device)\n        \n        # è®¡ç®—æŸå¤±\n        loss = self.criterion(sim, labels)\n        return loss\n```\n:::\n\n## ğŸ“– å»¶ä¼¸é˜…è¯»\n\n**ç»å…¸è®ºæ–‡**ï¼š\n- [LightGCN: Simplifying and Powering Graph Convolution Network for Recommendation (SIGIR'20)](https://arxiv.org/abs/2002.02126)\n- [Graph Convolutional Neural Networks for Web-Scale Recommender Systems (KDD'18, PinSage)](https://arxiv.org/abs/1806.01973)\n- [Heterogeneous Graph Attention Network (WWW'19, HAN)](https://arxiv.org/abs/1903.07293)\n- [Self-supervised Graph Learning for Recommendation (SIGIR'21, SGL)](https://arxiv.org/abs/2010.10783)\n\n**å¼€æºæ¡†æ¶**ï¼š\n- [PyTorch Geometric (PyG)](https://github.com/pyg-team/pytorch_geometric)ï¼šæœ€æµè¡Œçš„GNNåº“ä¹‹ä¸€ï¼Œæä¾›äº†å¤§é‡GNNæ¨¡å‹å’Œå·¥å…·ã€‚\n- [DGL (Deep Graph Library)](https://github.com/dmlc/dgl)ï¼šå¦ä¸€ä¸ªå¼ºå¤§çš„å›¾å­¦ä¹ æ¡†æ¶ï¼Œæ”¯æŒå¤šç§åç«¯ã€‚\n- [RecBole](https://github.com/RUCAIBox/RecBole)ï¼šä¸€ä¸ªç»Ÿä¸€ã€å…¨é¢çš„æ¨èç®—æ³•å¤ç°åº“ï¼ŒåŒ…å«äº†å¤šç§GNNæ¨¡å‹ã€‚\n\n> ğŸ§  **æ€è€ƒé¢˜**\n> \n> 1. **LightGCN vs. GCN**ï¼šä½ è®¤ä¸ºLightGCNç§»é™¤çš„éçº¿æ€§å’Œç‰¹å¾å˜æ¢ï¼Œä¸ºä»€ä¹ˆåœ¨ååŒè¿‡æ»¤åœºæ™¯ä¸‹æ˜¯\"å¤šä½™\"çš„ï¼Ÿå®ƒå¯èƒ½åœ¨ä»€ä¹ˆç±»å‹çš„å›¾æ•°æ®ä¸Šè¡¨ç°ä¸ä½³ï¼Ÿ\n> 2. **é‡‡æ ·ç­–ç•¥çš„æƒè¡¡**ï¼šPinSageçš„éšæœºæ¸¸èµ°é‡‡æ ·ç›¸æ¯”å‡åŒ€é‚»å±…é‡‡æ ·ï¼Œå…¶ä¼˜åŠ¿å’ŒåŠ£åŠ¿åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½ å¯èƒ½ä¼šé€‰æ‹©åè€…ï¼Ÿ\n> 3. **å†·å¯åŠ¨é—®é¢˜**ï¼šå¯¹äºä¸€ä¸ªæ²¡æœ‰ä»»ä½•äº¤äº’çš„æ–°ç”¨æˆ·ï¼ˆ\"å†·å¯åŠ¨\"ç”¨æˆ·ï¼‰ï¼ŒGNNæ¨¡å‹ï¼ˆç‰¹åˆ«æ˜¯LightGCNï¼‰å°†å¦‚ä½•ä¸ºä»–ç”ŸæˆåµŒå…¥å¹¶è¿›è¡Œæ¨èï¼Ÿä½ æœ‰ä»€ä¹ˆæ”¹è¿›çš„æ€è·¯å—ï¼Ÿ\n> 4. **å…ƒè·¯å¾„çš„è®¾è®¡**ï¼šåœ¨ä¸€ä¸ªåŒ…å«\"ç”¨æˆ·-æœç´¢-ç‰©å“-è´­ä¹°\"è¡Œä¸ºçš„ç”µå•†åœºæ™¯ä¸­ï¼Œè¯·ä½ è®¾è®¡è‡³å°‘ä¸‰æ¡æœ‰æ„ä¹‰çš„å…ƒè·¯å¾„ï¼Œå¹¶è¯´æ˜å®ƒä»¬å„è‡ªèƒ½æ•æ‰åˆ°ä»€ä¹ˆæ¨èä¿¡å·ã€‚\n> 5. **å›¾å¢å¼ºçš„é£é™©**ï¼šå›¾å¯¹æ¯”å­¦ä¹ ä¸­çš„æ•°æ®å¢å¼ºï¼ˆå¦‚åˆ è¾¹ã€åˆ ç‚¹ï¼‰å¦‚æœæ“ä½œä¸å½“ï¼Œå¯èƒ½ä¼šç ´åå›¾çš„å…³é”®ç»“æ„ä¿¡æ¯ã€‚ä½ è®¤ä¸ºè¯¥å¦‚ä½•è®¾ç½®å¢å¼ºçš„å¼ºåº¦ï¼ˆæ¯”å¦‚åˆ é™¤æ¯”ä¾‹ï¼‰ï¼Œä»¥åœ¨\"åˆ›é€ å¤šæ ·æ€§\"å’Œ\"ä¿æŒç»“æ„\"ä¹‹é—´å–å¾—å¹³è¡¡ï¼Ÿ","excerpt":"","includedFiles":[],"tasklistId":0,"title":"","headers":[{"level":3,"title":"ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§ï¼Ÿ","slug":"ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§","link":"#ä¸ºä»€ä¹ˆå›¾è§†è§’å¦‚æ­¤å¼ºå¤§","children":[]},{"level":2,"title":"ğŸš€ LightGCNï¼šå¤§é“è‡³ç®€ï¼Œè¿”ç’å½’çœŸ","slug":"ğŸš€-lightgcn-å¤§é“è‡³ç®€-è¿”ç’å½’çœŸ","link":"#ğŸš€-lightgcn-å¤§é“è‡³ç®€-è¿”ç’å½’çœŸ","children":[{"level":3,"title":"æ ¸å¿ƒæ€æƒ³ï¼šå‡æ³•å³æ˜¯åŠ æ³•","slug":"æ ¸å¿ƒæ€æƒ³-å‡æ³•å³æ˜¯åŠ æ³•","link":"#æ ¸å¿ƒæ€æƒ³-å‡æ³•å³æ˜¯åŠ æ³•","children":[]}]},{"level":2,"title":"ğŸ­ PinSageï¼šåº”å¯¹Web-ScaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº","slug":"ğŸ­-pinsage-åº”å¯¹web-scaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº","link":"#ğŸ­-pinsage-åº”å¯¹web-scaleæŒ‘æˆ˜çš„å·¥ä¸šå·¨äºº","children":[{"level":3,"title":"æ ¸å¿ƒæ€æƒ³ï¼šé‡‡æ ·ä¸èšåˆ","slug":"æ ¸å¿ƒæ€æƒ³-é‡‡æ ·ä¸èšåˆ","link":"#æ ¸å¿ƒæ€æƒ³-é‡‡æ ·ä¸èšåˆ","children":[]}]},{"level":2,"title":"ğŸŒˆ HANï¼šæ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§","slug":"ğŸŒˆ-han-æ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§","link":"#ğŸŒˆ-han-æ‹¥æŠ±ä¸–ç•Œçš„å¼‚è´¨æ€§","children":[{"level":3,"title":"æ ¸å¿ƒæ€æƒ³ï¼šåŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›","slug":"æ ¸å¿ƒæ€æƒ³-åŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›","link":"#æ ¸å¿ƒæ€æƒ³-åŸºäºå…ƒè·¯å¾„çš„å±‚æ¬¡åŒ–æ³¨æ„åŠ›","children":[]}]},{"level":2,"title":"âš”ï¸ GNNçš„ç°ä»£è®­ç»ƒå¿ƒæ³•","slug":"âš”ï¸-gnnçš„ç°ä»£è®­ç»ƒå¿ƒæ³•","link":"#âš”ï¸-gnnçš„ç°ä»£è®­ç»ƒå¿ƒæ³•","children":[{"level":3,"title":"å›¾å¯¹æ¯”å­¦ä¹ ï¼ˆGraph Contrastive Learningï¼‰","slug":"å›¾å¯¹æ¯”å­¦ä¹ -graph-contrastive-learning","link":"#å›¾å¯¹æ¯”å­¦ä¹ -graph-contrastive-learning","children":[]}]},{"level":2,"title":"ğŸ“– å»¶ä¼¸é˜…è¯»","slug":"ğŸ“–-å»¶ä¼¸é˜…è¯»","link":"#ğŸ“–-å»¶ä¼¸é˜…è¯»","children":[]}]}}
